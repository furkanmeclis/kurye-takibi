import{r as u,u as G,R as j,j as a,c as L,B as g,Y as w,a as E}from"./app-CuVmns39.js";import{P as K,M as A}from"./PageContainer-BYZvhDvV.js";import{T as q}from"./toast.esm-CbGwSEwS.js";import{C as F,D as z,a as B,T as H}from"./checkbox.esm-BqBWTLoT.js";import{D as Y,M as C}from"./message.esm-C59qgk3X.js";import{O as M}from"./overlaypanel.esm-36jLLX1w.js";import{T as D}from"./tristatecheckbox.esm-B0_3v1au.js";import"./PersonalInformation-C9966OF1.js";import"./inputmask.esm-613eZuuv.js";import"./PersonalInformation-BhvqWmBC.js";import"./styleclass.esm-C4wrtk2V.js";import"./index.esm-Dvyb0Cy_.js";const I=async d=>{if(d){let i=route("admin.orders.listCancellationRequests"),r=new Headers;return r.append("X-CSRF-TOKEN",d),await(await fetch(i,{method:"POST",headers:r})).json()}else return!1},V=async(d,i)=>{if(i){let r=route("admin.orders.approveCancellation",d),o=new Headers;return o.append("X-CSRF-TOKEN",i),await(await fetch(r,{method:"POST",headers:o,body:JSON.stringify({_method:"PUT"})})).json()}else return!1},ne=({auth:d,csrfToken:i,flash:r})=>{const[o,s]=u.useState(!0),[f,S]=u.useState([]);u.useState([]);const[l,v]=G(["name","email","phone","created_at","actions"],"adminOrdersCancellationColumns"),[y,x]=u.useState(null),b=j.useRef(null),[O,T]=u.useState(""),_=()=>{s(!0),I(i).then(e=>{e.status?(S(e.orders.map(t=>({...t,cancellation_accepted:t.cancellation_accepted===1}))),s(!1),x(null)):(x(e.message),s(!1))}).catch(e=>{x(e.message),s(!1)}).finally(()=>s(!1))};u.useEffect(()=>{var e;_(),r!=null&&r.message&&((e=p.current)==null||e.show({severity:(r==null?void 0:r.type)??"info",summary:r.title,detail:r.message??""}))},[]);const k=(e,t)=>{E({target:e.currentTarget,message:"Sipariş İptalini Onaylamak İstediğinize Emin Misiniz?",acceptLabel:"Onayla",acceptClassName:"p-button-success",rejectLabel:"Vazgeç",accept(){s(!0),V(t,i).then(({status:c,message:n})=>{var m,h;c?(_(),(m=p.current)==null||m.show({severity:"success",summary:"Başarılı",detail:n})):(h=p.current)==null||h.show({severity:"error",summary:"Hata",detail:n})}).catch(c=>{var n;(n=p.current)==null||n.show({severity:"error",summary:"Hata",detail:c.message})}).finally(()=>s(!1))}})};let P=[{field:"business.name",header:"Ad(İşletme)",hidden:!l.includes("business.name"),sortable:!0,filter:!0,filterPlaceholder:"Ad(İşletme)'a Göre"},{field:"business.phone",header:"İşletme Telefon Numarası",hidden:!l.includes("business.phone"),sortable:!0,filter:!0,filterPlaceholder:"İşletme Telefon Numarası'na Göre"},{field:"customer.name",header:"Ad(Müşteri)",hidden:!l.includes("customer.name"),sortable:!0,filter:!0,filterPlaceholder:"Ad(Müşteri)'a Göre"},{field:"customer.phone",header:"Müşteri Telefon Numarası",hidden:!l.includes("customer.phone"),sortable:!0,filter:!0,filterPlaceholder:"Müşteri Telefon Numarası'na Göre"},{field:"courier.name",header:"Ad(Kurye)",hidden:!l.includes("courier.name"),sortable:!0,filter:!0,filterPlaceholder:"Ad(Kurye)'a Göre",body:e=>a.jsx("span",{children:e.courier?e.courier.name:a.jsxs("span",{children:[a.jsx("i",{className:"pi pi-exclamation-circle text-red-400"})," Kurye Atanmamış"]})})},{field:"courier.phone",header:"Kurye Telefon Numarası",hidden:!l.includes("courier.phone"),sortable:!0,filter:!0,filterPlaceholder:"Kurye Telefon Numarası'na Göre",body:e=>a.jsx("span",{children:e.courier?e.courier.phone:a.jsxs("span",{children:[a.jsx("i",{className:"pi pi-exclamation-circle text-red-400"})," Kurye Atanmamış"]})})},{field:"price",header:"Paket Ücreti",hidden:!l.includes("price"),sortable:!0,filter:!0,filterPlaceholder:"Fiyata'a Göre",body:e=>a.jsxs("span",{children:[e.price," ₺"]})},{field:"cancellation_accepted",header:"İptal Durumu",hidden:!l.includes("cancellation_accepted"),sortable:!0,filter:!0,dataType:"boolean",filterElement:e=>a.jsx(D,{value:e.value,onChange:t=>e.filterApplyCallback(t.value)}),body:e=>a.jsxs("span",{children:[a.jsx("i",{className:L("pi",{"pi-check-circle text-green-400":e.cancellation_accepted,"pi-times-circle text-red-400":!e.cancellation_accepted})})," ",e.cancellation_accepted?"Onaylandı":"Onay Bekliyor"]})},{field:"cancellation_accepted_by.name",header:"İptali Onaylayan Yetkili",hidden:!l.includes("cancellation_accepted_by.name"),sortable:!0,filter:!0,filterPlaceholder:"İptali Onaylayan Yetkili'ye Göre",body:e=>a.jsx("span",{children:e.cancellation_accepted_by?e.cancellation_accepted_by.name:a.jsxs("span",{children:[a.jsx("i",{className:"pi pi-exclamation-circle text-red-400"})," Onay Bekliyor"]})})},{field:"cancellation_reason",header:"İptal Nedeni",hidden:!l.includes("cancellation_reason"),sortable:!0,filter:!0,filterPlaceholder:"İptal Nedeni'ne Göre",body:e=>a.jsxs("span",{className:"cursor-pointer",onMouseEnter:t=>{var c;T(e.cancellation_reason),(c=b.current)==null||c.toggle(t)},onMouseLeave:()=>{var t;T(""),(t=b.current)==null||t.hide()},children:[String(e.cancellation_reason).substring(0,20),String(e.cancellation_reason).length>20&&"..."]})},{field:"cancellation_requested_by",header:"İptal Talep Eden",hidden:!l.includes("cancellation_requested_by"),sortable:!0,filter:!0,filterElement:e=>a.jsx(Y,{value:e.value,options:[{label:"Kurye",value:"courier"},{label:"İşletme",value:"business"}],onChange:t=>e.filterApplyCallback(t.value),placeholder:"İptal Talep Eden"}),body:e=>a.jsx("span",{children:e.cancellation_requested_by==="courier"?"Kurye":"İşletme"})},{field:"created_at",header:"Kayıt Tarihi",hidden:!l.includes("created_at"),sortable:!0,filter:!0,filterPlaceholder:"Kayıt Tarihine Göre",filterType:"date",body:e=>a.jsx("span",{children:new Date(e.created_at).toLocaleString()})},{field:"updated_at",header:"Güncelleme Tarihi",hidden:!l.includes("updated_at"),sortable:!0,filter:!0,filterPlaceholder:"Güncellenme Tarihine Göre",filterType:"date",body:e=>a.jsx("span",{children:new Date(e.updated_at).toLocaleString()})},{field:"courier_accepted_at",header:"Kurye Teslim Alma Tarihi",hidden:!l.includes("courier_accepted_at"),sortable:!0,filter:!0,filterPlaceholder:"Kurye Teslim Alma Tarihine Göre",filterType:"date",body:e=>e.courier_accepted_at?a.jsx("span",{children:new Date(e.courier_accepted_at).toLocaleString()}):a.jsxs("span",{children:[a.jsx("i",{className:"pi pi-ban text-red-400"})," Teslim Alınmadı"]})},{field:"delivered_at",header:"Teslim Tarihi",hidden:!l.includes("delivered_at"),sortable:!0,filter:!0,filterPlaceholder:"Teslim Tarihine Göre",filterType:"date",body:e=>e.delivered_at?a.jsx("span",{children:new Date(e.delivered_at).toLocaleString()}):a.jsxs("span",{children:[a.jsx("i",{className:"pi pi-ban text-red-400"})," Teslim Edilmedi"]})},{field:"canceled_at",header:"İptal Tarihi",hidden:!l.includes("canceled_at"),sortable:!0,filter:!0,filterPlaceholder:"Aktifleştirme Tarihine Göre",filterType:"date",body:e=>a.jsx("span",{children:e.canceled_at===null?a.jsx("i",{className:"pi pi-times-circle text-red-400"}):new Date(e.canceled_at).toLocaleString()})},{field:"actions",header:"İşlemler",hidden:!l.includes("actions"),body:e=>a.jsx("div",{className:"flex gap-2",children:a.jsx(g,{visible:!e.cancellation_accepted,size:"small",icon:"pi pi-check-circle",severity:"success",tooltip:"İptali Onayla",tooltipOptions:{position:"top"},onClick:t=>{k(t,e.id)}})})}];const N=j.useRef(null),R=()=>a.jsx(a.Fragment,{children:a.jsx(H,{end:a.jsxs(a.Fragment,{children:[a.jsx(g,{size:"small",icon:"pi pi-sync",severity:"help",className:"mr-2",tooltip:"Verileri Yenile",tooltipOptions:{position:"top"},onClick:()=>{_()}}),a.jsx(g,{size:"small",icon:"pi pi-bars",onClick:e=>{var t;(t=N.current)==null||t.toggle(e)}})]})})}),p=j.useRef(null);return a.jsx(K,{auth:d,csrfToken:i,children:a.jsxs(A,{children:[a.jsx(w,{title:"İptal Edilen Siparişler"}),a.jsx(q,{ref:p}),a.jsxs(M,{ref:N,showCloseIcon:!0,style:{width:"300px"},children:[a.jsx("div",{className:"flex align-items-center justify-content-start mb-3",children:a.jsxs("span",{className:"text-900 text-lg font-bold",children:["Sütunlar (",l.length,")"]})}),a.jsx("div",{className:"flex flex-column justify-content-center gap-2",children:P.map((e,t)=>{if(e.selectionMode==="multiple")return null;let c=e.header,n=e.field;return a.jsxs("div",{className:"flex align-items-center",children:[a.jsx(F,{inputId:`column${t}`,checked:l.includes(n),onChange:m=>{m.checked?v([...l,n]):v(l.filter(h=>h!==n))}}),a.jsx("label",{htmlFor:`column${t}`,className:"ml-2",children:c})]},t)})})]}),a.jsx(M,{ref:b,style:{width:"300px"},children:a.jsx("p",{children:O})}),a.jsxs("div",{className:"card",children:[a.jsx("span",{className:"text-900 text-xl font-bold mb-4 block",children:"İptal Edilen Siparişler"}),y!==null&&a.jsx(C,{className:"w-full",severity:"error",text:y}),!o&&f.length===0&&a.jsx(C,{className:"w-full",severity:"info",text:"Sipariş bulunamadı."}),a.jsx(z,{hidden:!o&&f.length===0||y!==null,loading:o,value:f,removableSort:!0,paginator:!0,filterDisplay:"row",paginatorTemplate:"RowsPerPageDropdown FirstPageLink PrevPageLink CurrentPageReport NextPageLink LastPageLink",rowsPerPageOptions:[5,10,25,50],rows:10,dataKey:"id",header:R,filters:{"customer.name":{value:null,matchMode:"contains"},"customer.phone":{value:null,matchMode:"contains"},"business.name":{value:null,matchMode:"contains"},"business.phone":{value:null,matchMode:"contains"},"courier.name":{value:null,matchMode:"contains"},"courier.phone":{value:null,matchMode:"contains"},cancellation_accepted:{value:null,matchMode:"equals"},cancellation_reason:{value:null,matchMode:"contains"},cancellation_requested_by:{value:null,matchMode:"equals"},created_at:{value:null,matchMode:"contains"},updated_at:{value:null,matchMode:"contains"},courier_accepted_at:{value:null,matchMode:"contains"},delivered_at:{value:null,matchMode:"contains"},canceled_at:{value:null,matchMode:"contains"},price:{value:null,matchMode:"contains"}},emptyMessage:"Sipariş bulunamadı.",currentPageReportTemplate:"{first}. ile {last}. arası toplam {totalRecords} kayıttan",children:P.map((e,t)=>a.jsx(B,{...e},t))})]})]})})};export{ne as default};
