import{r as c,L as I,j as e,T as H,B as _,d as Z}from"./app-RB4L5HeC.js";import{q as g,r as G,P,M as U}from"./PageContainer-DYVxY7D-.js";import{l as v,b as w}from"./globalHelper-CI6ox7ZK.js";import{T as q}from"./toast.esm-CRBGU4XJ.js";import{L as m,s as W,f as F,r as R,W as Y,M as S,b as k,c as z,P as A,A as i,T as J,d as Q}from"./ActiveOrder-CRQ_tfr6.js";import{b as M,m as B,c as L}from"./car-BnQ5UupV.js";import"./PersonalInformation-DgwUYLID.js";import"./inputtext.esm-Bx5zzKwk.js";import"./inputmask.esm-Bb2c1uh8.js";import"./message.esm-BEa4-Sjy.js";import"./index.esm-C_3l1P-V.js";import"./PersonalInformation-DhQIT7R6.js";import"./styleclass.esm-_hJvuxpR.js";import"./sidebar.esm-C0m_hCns.js";import"./inputswitch.esm-DXPEr3dx.js";const T=new m.Icon({iconUrl:W,iconSize:[32,32],iconAnchor:[12,41],popupAnchor:[1,-34],shadowSize:[41,41]}),V=new m.Icon({iconUrl:F,iconSize:[32,32],iconAnchor:[12,41],popupAnchor:[1,-34],shadowSize:[41,41]}),y=new m.Icon({iconUrl:R,iconSize:[16,16],iconAnchor:[12,41],popupAnchor:[1,-34],shadowSize:[41,41]}),X=new m.Icon({iconUrl:M,iconSize:[32,32],iconAnchor:[12,41],popupAnchor:[1,-34],shadowSize:[41,41]}),ee=new m.Icon({iconUrl:B,iconSize:[32,32],iconAnchor:[12,41],popupAnchor:[1,-34],shadowSize:[41,41]}),le=new m.Icon({iconUrl:L,iconSize:[32,32],iconAnchor:[12,41],popupAnchor:[1,-34],shadowSize:[41,41]}),fe=({page:d=!0,order:E={},orderId:h=0,csrfToken:p="",auth:D={}})=>{const n=c.useRef(null),[l,x]=c.useState({id:0,price:0,business_id:0,customer_id:0,courier_id:null,address_id:0,customer_note:"",status:"opened",courier:!1,start_location:{latitude:0,longitude:0},end_location:{latitude:0,longitude:0},cancellation_accepted:0,cancellation_accepted_by:null,cancellation_requested_by:null,cancellation_reason:null,marketplace:"web",marketplace_order_id:null,marketplace_order_details:null,marketplace_transactions:null,marketplace_customer:null,delivered_at:null,canceled_at:null,courier_accepted_at:null,created_at:"1970-01-01T00:00:00.000Z",updated_at:"1970-01-01T00:00:00.000Z",customer:{id:0,business_id:0,name:"",phone:"",note:null,created_at:"1970-01-01T00:00:00.000Z",updated_at:"1970-01-01T00:00:00.000Z"},address:{id:0,customer_id:0,phone:"",title:"",city:"",district:"",address:"",notes:"",created_at:"1970-01-01T00:00:00.000Z",updated_at:"1970-01-01T00:00:00.000Z"}}),[o,$]=c.useState([]),[f,C]=c.useState(!1),[se,j]=c.useState(!1),{setBreadcrumbs:K}=c.useContext(I);c.useEffect(()=>{d&&K(s=>[...s,{labels:["Siparişler","Siparişi Görüntüle"],to:window.location.href}])},[]),c.useEffect(()=>{d?(j(!0),g(h,p).then(s=>{var a;if(s.status){let t=s.order;x(t)}else(a=n.current)==null||a.show({severity:"error",summary:"Hata",detail:s.message})}).catch(s=>{var a;console.log(s),(a=n.current)==null||a.show({severity:"error",summary:"Hata",detail:"Bir hata oluştu."})}).finally(()=>j(!1))):x(E)},[]),c.useEffect(()=>{if(l.id!==0&&d){let s=v(a=>{console.log(a),a.orderId===l.id&&a!=null&&a.reload&&g(h,p).then(t=>{var r;t.status?x(t.order):(r=n.current)==null||r.show({severity:"error",summary:"Hata",detail:t.message})}).catch(t=>{var r;console.log(t),(r=n.current)==null||r.show({severity:"error",summary:"Hata",detail:"Bir hata oluştu."})})});return()=>s()}},[l]),c.useEffect(()=>{if(l.courier!==!1&&l.courier!==null&&(G(h,p).then(s=>{var a;s.status?$(s.locations.map(t=>({latitude:t.latitude,longitude:t.longitude}))):(a=n.current)==null||a.show({severity:"error",summary:"Hata",detail:s.message})}).catch(s=>{var a;console.log(s),(a=n.current)==null||a.show({severity:"error",summary:"Hata",detail:"Bir hata oluştu."})}),l.status==="transporting")){C(!0);let s=v(a=>{a.orderId===l.id&&a!=null&&a.onlyLocation&&g(h,p).then(t=>{var r;t.status?x(t.order):(r=n.current)==null||r.show({severity:"error",summary:"Hata",detail:t.message})}).catch(t=>{var r;console.log(t),(r=n.current)==null||r.show({severity:"error",summary:"Hata",detail:"Bir hata oluştu."})})});return()=>{s()}}},[l]);const O=c.useMemo(()=>{let s=l,a=new Date(s.created_at),t=s.courier_accepted_at!==null?new Date(s.courier_accepted_at):null,r=s.delivered_at!==null?new Date(s.delivered_at):null,N=s.canceled_at!==null?new Date(s.canceled_at):null,u=[];return N!==null&&u.push({date:N,status:"Sipariş İptal Edildi",icon:"pi pi-times-circle",bg:"red-500"}),r!==null&&u.push({date:r,status:"Sipariş Teslim Edildi",icon:"pi pi-send",bg:"green-500"}),t!==null&&u.push({date:t,status:"Kurye Kabul Etti",icon:"pi pi-check-square",bg:"teal-500"}),u.push({date:a,status:"Sipariş Oluşturuldu",icon:"pi pi-file-import",bg:"yellow-500"}),u},[l]),b=()=>e.jsxs("div",{className:`grid ${!d&&"bg-primary-50 py-2 px-3"}`,children:[e.jsx("div",{className:"col-12 lg:col-9 md:col-8",children:e.jsxs("div",{className:`${!d&&"bg-primary-50 py-2 px-3"}`,children:[e.jsx(H,{target:"[data-pr-tooltip]",position:"bottom",className:"zoomin"}),e.jsxs("div",{className:"grid row-gap-2",children:[l.status==="transporting"&&l.courier!==!1&&l.courier!==null&&o.length>0&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"col-12",children:e.jsxs("span",{className:"text-xl font-semibold",children:["Kurye Konumu",l.status==="transporting"&&e.jsx(Y,{speed:"fast",connected:f,text:"Kurye Konumu İzleniyor"})]})}),e.jsx("div",{className:"col-12",children:l.status==="transporting"&&o.length>0&&e.jsxs(S,{center:[o[0].latitude,o[0].longitude],zoom:17,zoomControl:!0,attributionControl:!1,style:{height:"350px",borderRadius:"10px"},scrollWheelZoom:!1,children:[e.jsx(k,{url:"https://{s}.tile.openstreetmap.fr/hot/{z}/{x}/{y}.png"}),o.map((s,a)=>e.jsx(z,{position:[s.latitude,s.longitude],icon:a===0?T:a===o.length-1?l.courier.details.vehicle_type==="bicycle"?X:l.courier.details.vehicle_type==="motorcycle"?ee:le:y,children:e.jsxs(A,{children:[e.jsx("span",{className:"font-semibold flex justify-content-center text-lg",children:a===0?"Başlangıç":a===o.length-1&&l.status==="delivered"?"Bitiş":"Güzergah-"+a}),e.jsx(_,{label:"Google Maps'te Aç",size:"small",icon:"pi pi-external-link",severity:"help",className:"w-full mt-2",onClick:()=>{window.open(`https://www.google.com/maps/search/?api=1&query=${s.latitude},${s.longitude}`,"_blank")}})]})},a))]})})]}),e.jsx("div",{className:"col-12",children:e.jsx("span",{className:"text-xl font-semibold",children:"Sipariş Detayları"})}),e.jsxs("div",{className:"lg:col-3 md:col-4 col-6 cursor-pointer","data-pr-tooltip":"Müşteri Adı Soyadı",children:[e.jsx(i,{icon:"pi pi-user",shape:"circle",className:"bg-primary-300 font-semibold text-primary-800"}),e.jsx(Z,{className:"font-semibold ml-2 text-color dark: text-decoration-none",href:route("business.customers.edit",l.customer.id),children:l.customer.name})]}),e.jsxs("div",{className:"lg:col-3 md:col-4 col-6 cursor-pointer","data-pr-tooltip":"Müşteri Telefon Numarası",children:[e.jsx(i,{icon:"pi pi-phone",shape:"circle",className:"bg-primary-300 font-semibold text-primary-800"}),e.jsx("a",{className:"font-semibold ml-2 text-color text-decoration-none",href:`tel:${l.customer.phone}`,children:l.customer.phone})]}),e.jsxs("div",{className:"lg:col-3 md:col-4 col-6 cursor-pointer","data-pr-tooltip":"Paket Ücreti",children:[e.jsx(i,{icon:"pi pi-turkish-lira",shape:"circle",className:"bg-primary-300 font-semibold text-primary-800"}),e.jsxs("span",{className:"font-semibold ml-2",children:[l.price," ₺"]})]}),e.jsxs("div",{className:"lg:col-3 md:col-4 col-6 cursor-pointer","data-pr-tooltip":"Sipariş Durumu",children:[e.jsx(i,{icon:"pi pi-check",shape:"circle",className:"bg-primary-300 font-semibold text-primary-800"}),e.jsx(J,{className:"ml-2",value:w(l.status,!1,l.cancellation_accepted===1,l.cancellation_rejected===1).label,severity:w(l.status,!1,l.cancellation_accepted===1,l.cancellation_rejected===1).severity})]}),l.status==="canceled"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"col-12",children:e.jsx("span",{className:"text-xl font-semibold",children:"İptal Bilgileri"})}),e.jsxs("div",{className:"lg:col-3 md:col-4 col-6 cursor-pointer","data-pr-tooltip":"İptal Edilme Sebebi",children:[e.jsx(i,{icon:"pi pi-file",shape:"circle",className:"bg-primary-300 font-semibold text-primary-800"}),e.jsx("span",{className:"font-semibold ml-2",children:l.cancellation_reason})]}),e.jsxs("div",{className:"lg:col-3 md:col-4 col-6 cursor-pointer","data-pr-tooltip":"İptal Edilme Sebebi",children:[e.jsx(i,{icon:`pi pi-${l.cancellation_accepted===1?"check":"times"}-circle`,shape:"circle",className:"bg-primary-300 font-semibold text-primary-800"}),e.jsx("span",{className:"font-semibold ml-2",children:l.cancellation_accepted===1?"İptal Onaylandı":"İptal İşlemi Onay Bekliyor"})]}),e.jsxs("div",{className:"lg:col-3 md:col-4 col-6 cursor-pointer","data-pr-tooltip":"İptal Edilme Tarihi",children:[e.jsx(i,{icon:"pi pi-clock",shape:"circle",className:"bg-primary-300 font-semibold text-primary-800"}),e.jsx("span",{className:"font-semibold ml-2",children:new Date(String(l.canceled_at)).toLocaleString()})]}),e.jsxs("div",{className:"lg:col-3 md:col-4 col-6 cursor-pointer","data-pr-tooltip":"Onaylayan Yetkili",children:[e.jsx(i,{icon:"pi pi-user",shape:"circle",className:"bg-primary-300 font-semibold text-primary-800"}),e.jsx("span",{className:"font-semibold ml-2",children:l.cancellation_accepted_by!==null?l.cancellation_accepted_by.name:"Onaylanmadı"})]})]}),e.jsx("div",{className:"col-12",children:e.jsx("span",{className:"text-xl font-semibold",children:"Adres Bilgileri"})}),e.jsxs("div",{className:"lg:col-3 md:col-4 col-6 cursor-pointer","data-pr-tooltip":"Adres Başlığı",children:[e.jsx(i,{icon:"pi pi-tag",shape:"circle",className:"bg-primary-300 font-semibold text-primary-800"}),e.jsx("span",{className:"font-semibold ml-2",children:l.address.title})]}),e.jsxs("div",{className:"lg:col-3 md:col-4 col-6 cursor-pointer","data-pr-tooltip":"Adres Telefon Numarası",children:[e.jsx(i,{icon:"pi pi-phone",shape:"circle",className:"bg-primary-300 font-semibold text-primary-800"}),e.jsx("a",{className:"font-semibold ml-2 text-color text-decoration-none",href:`tel:${l.address.phone}`,children:l.address.phone})]}),e.jsxs("div",{className:"lg:col-3 md:col-4 col-6 cursor-pointer","data-pr-tooltip":"İl/İlçe",children:[e.jsx(i,{icon:"pi pi-map",shape:"circle",className:"bg-primary-300 font-semibold text-primary-800"}),e.jsxs("span",{className:"font-semibold ml-2",children:[l.address.city," / ",l.address.district]})]}),e.jsxs("div",{className:"lg:col-6 md:col-6 col-12 cursor-pointer","data-pr-tooltip":"Adres",children:[e.jsx(i,{icon:"pi pi-home",shape:"circle",className:"bg-primary-300 font-semibold text-primary-800"}),e.jsx("span",{"data-pr-position":"bottom",className:"font-semibold ml-2",children:l.address.address})]}),l.address.notes!==null&&e.jsxs("div",{className:"lg:col-6 md:col-6 col-12 cursor-pointer","data-pr-tooltip":"Notlar",children:[e.jsx(i,{icon:"pi pi-info",shape:"circle",className:"bg-primary-300 font-semibold text-primary-800"}),e.jsx("span",{className:"font-semibold ml-2",children:l.address.notes})]}),l.courier!==!1&&l.courier!==null&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"col-12",children:e.jsx("span",{className:"text-xl font-semibold",children:"Kurye Bilgileri"})}),e.jsxs("div",{className:"lg:col-3 md:col-4 col-6 cursor-pointer","data-pr-tooltip":"Kurye Adı Soyadı",children:[e.jsx(i,{icon:"pi pi-user",shape:"circle",className:"bg-primary-300 font-semibold text-primary-800"}),e.jsx("span",{className:"font-semibold ml-2",children:l.courier.name})]}),e.jsxs("div",{className:"lg:col-3 md:col-4 col-6 cursor-pointer","data-pr-tooltip":"Kurye Telefon Numarası",children:[e.jsx(i,{icon:"pi pi-phone",shape:"circle",className:"bg-primary-300 font-semibold text-primary-800"}),e.jsx("a",{className:"font-semibold ml-2 text-color text-decoration-none",href:`tel:${l.courier.phone}`,children:l.courier.phone})]}),e.jsxs("div",{className:"lg:col-3 md:col-4 col-6 cursor-pointer","data-pr-tooltip":"Kurye Email Adresi",children:[e.jsx(i,{icon:"pi pi-envelope",shape:"circle",className:"bg-primary-300 font-semibold text-primary-800"}),e.jsx("a",{className:"font-semibold ml-2 text-color text-decoration-none",href:`mailto:${l.courier.email}`,children:l.courier.email})]}),e.jsxs("div",{className:"lg:col-3 md:col-4 col-6 cursor-pointer flex align-items-center","data-pr-tooltip":"Teslimat Tipi",children:[e.jsx(i,{image:l.courier.details.vehicle_type==="bicycle"?M:l.courier.details.vehicle_type==="motorcycle"?B:L,className:"bg-primary-300 font-semibold text-primary-800 p-1"}),e.jsx("span",{className:"ml-2 font-semibold",children:l.courier.details.vehicle_type==="bicycle"?"Bisiklet":l.courier.details.vehicle_type==="motorcycle"?"Motosiklet":"Araba"})]}),e.jsxs("div",{className:"lg:col-3 md:col-4 col-6 cursor-pointer","data-pr-tooltip":"Siparişi Teslim Alma Tarihi",children:[e.jsx(i,{icon:"pi pi-clock",shape:"circle",className:"bg-primary-300 font-semibold text-primary-800"}),e.jsx("span",{className:"font-semibold ml-2",children:l.courier_accepted_at!==null?new Date(l.courier_accepted_at).toLocaleString():"-"})]}),l.delivered_at!==null&&e.jsxs("div",{className:"lg:col-3 md:col-4 col-6 cursor-pointer","data-pr-tooltip":"Siparişi Teslim Etme Tarihi",children:[e.jsx(i,{icon:"pi pi-stop-circle",shape:"circle",className:"bg-primary-300 font-semibold text-primary-800"}),e.jsx("span",{className:"font-semibold ml-2",children:new Date(l.delivered_at).toLocaleString()})]}),!f&&o.length>0&&e.jsx("div",{className:"col-12",children:e.jsxs(S,{center:[o[0].latitude,o[0].longitude],zoom:15,zoomControl:!0,attributionControl:!1,style:{height:"400px",borderRadius:"10px"},scrollWheelZoom:!1,children:[e.jsx(k,{url:"https://{s}.tile.openstreetmap.fr/hot/{z}/{x}/{y}.png"}),o.map((s,a)=>e.jsx(z,{position:[s.latitude,s.longitude],icon:a===0?T:a===o.length-1&&l.status==="delivered"?V:y,children:e.jsxs(A,{children:[e.jsx("span",{className:"font-semibold flex justify-content-center text-lg",children:a===0?"Başlangıç":a===o.length-1&&l.status==="delivered"?"Bitiş":"Güzergah-"+a}),e.jsx(_,{label:"Google Maps'te Aç",size:"small",icon:"pi pi-external-link",severity:"help",className:"w-full mt-2 zoomindown",onClick:()=>{window.open(`https://www.google.com/maps/search/?api=1&query=${s.latitude},${s.longitude}`,"_blank")}})]})},a))]})})]})]})]})}),e.jsx("div",{className:"col-12 lg:col-3 md:col-4",children:e.jsx(Q,{layout:"vertical",marker:s=>e.jsx("span",{className:`bg-${s.bg} flex w-2rem h-2rem align-items-center justify-content-center text-white border-circle z-1 shadow-1`,children:e.jsx("i",{className:s.icon})}),value:O,opposite:s=>s.status,content:s=>e.jsx("small",{className:"text-color-secondary",children:s.date.toLocaleString()})})})]});return e.jsxs(e.Fragment,{children:[e.jsx(q,{ref:n}),d?e.jsx(P,{auth:D,csrfToken:p,children:e.jsx(U,{children:e.jsx("div",{className:"card",children:e.jsx(b,{})})})}):e.jsx(b,{})]})};export{fe as default};
