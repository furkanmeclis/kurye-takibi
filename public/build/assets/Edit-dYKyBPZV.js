import{r as c,L,R as $,j as e,Y as H,c as s,B}from"./app-BEdu34N4.js";import{P as T,M as V}from"./PageContainer-DIby2w7y.js";import{c as G,a as M,b as m,d as P,u as Z,T as K,I as b}from"./toast.esm-C3ENF9BI.js";import{I as U}from"./inputmask.esm-Ka7Xp-v2.js";import{I as S}from"./inputswitch.esm-_LPlMiue.js";import{c as Y,u as J}from"./businesses-Co-zBRaF.js";import{B as Q}from"./blockui.esm-WjKUSYbO.js";import"./PersonalInformation-y7N6oU8i.js";const ne=({auth:E,csrfToken:g,businessId:w=0})=>{const{setBreadcrumbs:F}=c.useContext(L);c.useEffect(()=>{F(t=>[...t,{labels:["İşletmeler","Düzenle"],to:window.location.href}])},[]);const[l,O]=c.useState({id:"",name:"",email:"",phone:"",password_change:!1,password:"",password_confirmation:"",account_verification:!1,verified_at:""}),p=$.useRef(null),[u,v]=c.useState(!0),[y,D]=c.useState(!1),q=G().shape({id:M().required("İşletme ID bilgisi bulunamadı"),email:m().email("Geçerli bir email adresi giriniz").required("Email adresinizi giriniz"),name:m().required("Ad soyad giriniz").min(3,"Ad Soyad en az 3 karakter olmalıdır"),phone:m().required("Telefon numarası giriniz").matches(/^\(\d{3}\)-\d{3}-\d{4}$/,"Geçerli bir telefon numarası giriniz"),password:m().when("password_change",{is:!0,then:()=>m().required("Şifre giriniz").min(6,"Şifre en az 6 karakter olmalıdır").matches(/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)[a-zA-Z\d]{6,}$/,"Şifreniz en az bir büyük harf, bir küçük harf ve bir rakam içermelidir"),otherwise:()=>m().notRequired()}),password_confirmation:m().when("password_change",{is:!0,then:()=>m().required("Şifreyi tekrar giriniz").oneOf([P("password"),""],"Şifreler uyuşmuyor"),otherwise:()=>m().notRequired()})}),[j,N]=c.useState(!1),k=Z({initialValues:l,validationSchema:q,validateOnChange:y,validateOnBlur:y,enableReinitialize:!0,onSubmit:t=>{v(!0);let o={name:t.name,email:t.email,phone:t.phone,password:t.password,password_confirmation:t.password_confirmation,account_verification:t.account_verification?1:0};t.password_change===!0&&(o={...o,password_change:1}),J(w,o,g).then(a=>{var h,x;if(a.status){(h=p.current)==null||h.show({severity:"success",summary:"Başarılı",detail:a.message});let d={id:a.business.id,name:a.business.name,email:a.business.email,phone:a.business.phone,password_change:!1,password:"",password_confirmation:"",account_verification:a.business.verified===1,verified_at:a.business.verified_at===null?!1:new Date(a.business.verified_at).toLocaleString()};C({values:d})}else{let d={};a!=null&&a.emailExists&&(a==null?void 0:a.emailExists)===!0&&(d={...d,email:"Bu email adresi zaten kullanılmakta"}),a!=null&&a.phoneExists&&(a==null?void 0:a.phoneExists)===!0&&(d={...d,phone:"Bu telefon numarası zaten kullanılmakta"}),_(d),(x=p.current)==null||x.show({severity:"error",summary:"Hata",detail:a.message})}}).catch(()=>{var a;(a=p.current)==null||a.show({severity:"error",summary:"Hata",detail:"Bir hata oluştu lütfen tekrar deneyiniz."})}).finally(()=>{v(!1)})}});let{values:r,setFieldValue:z,resetForm:C,submitCount:n,setErrors:_,handleChange:f,handleSubmit:A,isValid:R,dirty:I}=k,i=k.errors;return c.useEffect(()=>{w!==void 0&&Y(w,g).then(t=>{var h;let{status:o}=t,a=t.business;if(o){let x={id:a.id,name:a.name,email:a.email,phone:a.phone,password_change:!1,password:"",password_confirmation:"",account_verification:a.verified===1,verified_at:a.verified_at===null?!1:new Date(a.verified_at).toLocaleString()};O(x),C({values:x,errors:{}})}else N(!0),_({id:"İşletme bilgileri alınamadı"}),(h=p.current)==null||h.show({severity:"error",summary:"Hata",detail:"İşletme bilgileri alınamadı"})}).catch(t=>{var o;console.error(t),N(!0),_({id:"İşletme bilgileri alınamadı"}),(o=p.current)==null||o.show({severity:"error",summary:"Hata",detail:"İşletme bilgileri alınamadı"})}).finally(()=>{v(!1)})},[g,w]),c.useEffect(()=>{n>0&&D(!0)},[n]),e.jsx(T,{auth:E,csrfToken:g,children:e.jsxs(V,{children:[e.jsx(H,{title:(l==null?void 0:l.name)!==""?"'"+(l==null?void 0:l.name)+"' Adlı İşletmeyi Düzenle":""}),e.jsx(K,{ref:p}),e.jsxs("div",{className:"card",children:[e.jsxs("span",{className:"text-900 text-xl font-bold mb-4 block",children:[(l==null?void 0:l.name)!==""?"'"+(l==null?void 0:l.name)+"' Adlı İşletmeyi Düzenle":""," "]}),e.jsxs("div",{className:"grid",children:[e.jsxs("div",{className:"col-12 lg:col-2",children:[e.jsx("div",{className:"text-900 font-medium text-xl mb-3",children:"İşletme Bilgileri"}),e.jsxs("p",{className:"m-0 p-0 text-600 line-height-3 mr-3",children:["Bu Ekranda İşletme Sahibinin bilgilerini düzenleyebilirsiniz.",i&&Object.keys(i).length>0&&e.jsx(e.Fragment,{children:e.jsx("ul",{className:"mt-3",children:Object.keys(i).map((t,o)=>e.jsx("li",{className:"text-red-500 text-sm",children:i[t]},o))})})]})]}),e.jsx("div",{className:"col-12 lg:col-10",children:e.jsx(Q,{blocked:j,template:e.jsx("i",{className:"pi pi-exclamation-circle text-red-400",style:{fontSize:"3rem"}}),containerClassName:s("",{"p-3":j,"p-0":!j}),children:e.jsxs("form",{onSubmit:A,className:"grid formgrid p-fluid",children:[e.jsxs("div",{className:"field mb-4 col-12 md:col-6 p-input-icon-right",children:[e.jsxs("label",{htmlFor:"name",className:s("font-medium text-900",{"text-red-500":!!i.name,"text-green-500":!i.name&&n>0}),children:[e.jsx("i",{className:s("pi",{"pi-times-circle text-red-500 text-sm":!!i.name,"pi-check-circle text-green-500 text-sm":!i.name&&n>0})})," Ad Soyad (İşletme Sahibi)"]}),e.jsx(b,{id:"name",type:"text",autoComplete:"off",name:"name",tooltip:i.name,tooltipOptions:{position:"top"},disabled:u,onChange:f,value:r.name,className:s("w-full",{"p-invalid":!!i.name})})]}),e.jsxs("div",{className:"field mb-4 col-12 md:col-6 p-input-icon-right",children:[e.jsxs("label",{htmlFor:"email",className:s("font-medium text-900",{"text-red-500":!!i.email,"text-green-500":!i.email&&n>0}),children:[e.jsx("i",{className:s("pi",{"pi-times-circle text-red-500 text-sm":!!i.email,"pi-check-circle text-green-500 text-sm":!i.email&&n>0})})," Email Adresi"]}),e.jsx(b,{id:"email",type:"email",autoComplete:"off",name:"email",tooltip:i==null?void 0:i.email,tooltipOptions:{position:"top"},disabled:u,onChange:f,value:r.email,className:s("w-full",{"p-invalid":!!i.email})})]}),e.jsxs("div",{className:"field mb-4 col-12 md:col-6 p-input-icon-right",children:[e.jsxs("label",{htmlFor:"phone",className:s("font-medium text-900",{"text-red-500":!!i.phone,"text-green-500":!i.phone&&n>0}),children:[e.jsx("i",{className:s("pi",{"pi-times-circle text-red-500 text-sm":!!i.phone,"pi-check-circle text-green-500 text-sm":!i.phone&&n>0})})," Telefon Numarası"]}),e.jsx(U,{autoComplete:"off",name:"phone",tooltip:i==null?void 0:i.phone,tooltipOptions:{position:"top",event:"focus",className:"text-red-500"},disabled:u,onChange:f,value:r.phone,mask:"(999)-999-9999",className:s("w-full",{"p-invalid":!!i.phone})})]}),e.jsxs("div",{className:"field mb-4 col-12 p-input-icon-right",children:[e.jsx("label",{htmlFor:"password_change",className:s("font-medium text-900 cursor-pointer select-none"),children:"Şifre Değişikliği"}),e.jsx("br",{}),e.jsx(S,{inputId:"password_change",checked:r.password_change,onChange:t=>z("password_change",t.value??!1)})]}),r.password_change&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"field mb-4 col-12 md:col-6 p-input-icon-right",children:[e.jsxs("label",{htmlFor:"password",className:s("font-medium text-900",{"text-red-500":!!i.password,"text-green-500":!i.password&&n>0}),children:[e.jsx("i",{className:s("pi",{"pi-times-circle text-red-500 text-sm":!!i.password,"pi-check-circle text-green-500 text-sm":!i.password&&n>0})})," Şifre"]}),e.jsx(b,{id:"password",type:"password",autoComplete:"off",name:"password",tooltip:i==null?void 0:i.password,tooltipOptions:{position:"top"},disabled:u,onChange:f,value:r.password,className:s("w-full",{"p-invalid":!!i.password})})]}),e.jsxs("div",{className:"field mb-4 col-12 md:col-6 p-input-icon-right",children:[e.jsxs("label",{htmlFor:"password_confirmation",className:s("font-medium text-900",{"text-red-500":!!i.password_confirmation,"text-green-500":!i.password_confirmation&&n>0}),children:[e.jsx("i",{className:s("pi",{"pi-times-circle text-red-500 text-sm":!!i.password_confirmation,"pi-check-circle text-green-500 text-sm":!i.password_confirmation&&n>0})})," Şifre Tekrarı"]}),e.jsx(b,{id:"password_confirmation",type:"password",autoComplete:"off",name:"password_confirmation",tooltip:i==null?void 0:i.password_confirmation,tooltipOptions:{position:"top"},disabled:u,onChange:f,value:r.password_confirmation,className:s("w-full",{"p-invalid":!!i.password_confirmation})})]})]}),e.jsxs("div",{className:"field mb-4 col-12 md:col-6 p-input-icon-right",children:[e.jsxs("label",{htmlFor:"account_verification",className:s("font-medium text-900 cursor-pointer select-none"),children:["Hesap Onayı ",r.account_verification&&r.verified_at!==!1&&e.jsxs("span",{className:"text-green-500",children:["Onaylandı : ",r.verified_at]})]}),e.jsx("br",{}),e.jsx(S,{inputId:"account_verification",checked:r.account_verification,onChange:t=>z("account_verification",t.value??!1)})]}),e.jsxs("div",{className:"col-12",children:[e.jsx(B,{label:"Geri",icon:"pi pi-arrow-left",type:"button",severity:"secondary",size:"small",onClick:()=>{window.history.back()},className:"w-auto mt-3 mr-2"}),e.jsx(B,{label:"İşletmeyi Kaydet",disabled:!R||!I,loading:u,size:"small",type:"submit",className:"w-auto mt-3"})]})]})})})]})]})]})})};export{ne as default};
