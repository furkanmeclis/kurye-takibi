import{C as Y,r as u,P as $,b as V,m as N,I as J,c as H,u as X,j as t,B as g,R as q,Y as Q,a as W}from"./app-DnzU3dgP.js";import{P as Z,M as ee}from"./PageContainer-D0f9e6Hu.js";import{T as te,I as re}from"./toast.esm-DRshub8x.js";import ae from"./Show-Ezr4ywji.js";import{O as z,C as se,D as le,a as ne,T as ie}from"./checkbox.esm-T-P1Igsi.js";import{D as oe,M as B}from"./message.esm-AnJ8ZL0Q.js";import{s as ce,g as w,a as de,d as ue,u as G}from"./orders-mx7ecZeU.js";import"./PersonalInformation-DIHyVNPE.js";import"./inputmask.esm-4aE0P5S6.js";import"./PersonalInformation-C13_j9Tq.js";import"./styleclass.esm-woUnVz_q.js";import"./index.esm-p1L-kKDB.js";function P(a){"@babel/helpers - typeof";return P=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(r){return typeof r}:function(r){return r&&typeof Symbol=="function"&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r},P(a)}function pe(a,r){if(P(a)!=="object"||a===null)return a;var s=a[Symbol.toPrimitive];if(s!==void 0){var l=s.call(a,r||"default");if(P(l)!=="object")return l;throw new TypeError("@@toPrimitive must return a primitive value.")}return(r==="string"?String:Number)(a)}function me(a){var r=pe(a,"string");return P(r)==="symbol"?r:String(r)}function C(a,r,s){return r=me(r),r in a?Object.defineProperty(a,r,{value:s,enumerable:!0,configurable:!0,writable:!0}):a[r]=s,a}var fe={value:"p-tag-value",icon:"p-tag-icon",root:function(r){var s=r.props;return H("p-tag p-component",C(C({},"p-tag-".concat(s.severity),s.severity!==null),"p-tag-rounded",s.rounded))}},he=`
@layer primereact {
    .p-tag {
        display: inline-flex;
        align-items: center;
        justify-content: center;
    }
    
    .p-tag-icon,
    .p-tag-value,
    .p-tag-icon.pi {
        line-height: 1.5;
    }
    
    .p-tag.p-tag-rounded {
        border-radius: 10rem;
    }
}
`,O=Y.extend({defaultProps:{__TYPE:"Tag",value:null,severity:null,rounded:!1,icon:null,style:null,className:null,children:void 0},css:{classes:fe,styles:he}});function A(a,r){var s=Object.keys(a);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(a);r&&(l=l.filter(function(c){return Object.getOwnPropertyDescriptor(a,c).enumerable})),s.push.apply(s,l)}return s}function ye(a){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?A(Object(s),!0).forEach(function(l){C(a,l,s[l])}):Object.getOwnPropertyDescriptors?Object.defineProperties(a,Object.getOwnPropertyDescriptors(s)):A(Object(s)).forEach(function(l){Object.defineProperty(a,l,Object.getOwnPropertyDescriptor(s,l))})}return a}var E=u.forwardRef(function(a,r){var s=u.useContext($),l=O.getProps(a,s),c=O.setMetaData({props:l}),f=c.ptm,v=c.cx,d=c.isUnstyled;V(O.css.styles,d,{name:"tag"});var b=u.useRef(null),x=N({className:v("icon")},f("icon")),j=J.getJSXIcon(l.icon,ye({},x),{props:l});u.useImperativeHandle(r,function(){return{props:l,getElement:function(){return b.current}}});var S=N({ref:b,className:H(l.className,v("root")),style:l.style},O.getOtherProps(l),f("root")),T=N({className:v("value")},f("value"));return u.createElement("span",S,j,u.createElement("span",T,l.value),u.createElement("span",null,l.children))});E.displayName="Tag";const Ce=({auth:a,csrfToken:r,flash:s})=>{const[l,c]=u.useState(!0),[f,v]=u.useState([]);u.useState([]);const[d,b]=X(["name","phone","created_at","actions"],"BusinessesOrdersAllTableColumns"),[x,j]=u.useState(null),S=u.useRef(null),[T,M]=u.useState([]),[_,R]=u.useState({orderId:0,reason:""}),y=()=>{c(!0),de(r).then(e=>{e.status?(v(e.orders),c(!1),j(null)):(j(e.message),c(!1))}).catch(e=>{j(e.message),c(!1)}).finally(()=>c(!1))};u.useEffect(()=>{var e,n,i;if(y(),s!=null&&s.message&&((e=m.current)==null||e.show({severity:(s==null?void 0:s.type)??"info",summary:s.title,detail:s.message??""})),(n=a==null?void 0:a.user)!=null&&n.id){let o=ce((i=a==null?void 0:a.user)==null?void 0:i.id,p=>{p!=null&&p.reload&&y()});return()=>{o.unbind()}}},[]);const D=(e,n)=>{W({target:e.currentTarget,message:"Siparişi silmek istediğinize emin misiniz?",acceptLabel:"Sil",acceptClassName:"p-button-danger",rejectLabel:"Vazgeç",accept(){c(!0),ue(n,r).then(({status:i,message:o})=>{var p,h;i?(y(),(p=m.current)==null||p.show({severity:"success",summary:"Başarılı",detail:o})):(h=m.current)==null||h.show({severity:"error",summary:"Hata",detail:o})}).catch(i=>{var o;(o=m.current)==null||o.show({severity:"error",summary:"Hata",detail:i.message})}).finally(()=>c(!1))}})},K=e=>{c(!0),G(e,"opened",r).then(({status:n,message:i})=>{var o,p;n?(y(),(o=m.current)==null||o.show({severity:"success",summary:"Başarılı",detail:i})):(p=m.current)==null||p.show({severity:"error",summary:"Hata",detail:i})}).catch(n=>{var i;(i=m.current)==null||i.show({severity:"error",summary:"Hata",detail:n.message})}).finally(()=>c(!1))},F=(e,n)=>{c(!0),G(e,"canceled",r,n).then(({status:i,message:o})=>{var p,h,I;i?(y(),(p=m.current)==null||p.show({severity:"success",summary:"Başarılı",detail:o}),(h=S.current)==null||h.hide()):(I=m.current)==null||I.show({severity:"error",summary:"Hata",detail:o})}).catch(i=>{var o;(o=m.current)==null||o.show({severity:"error",summary:"Hata",detail:i.message})}).finally(()=>c(!1))};let L=[{expander:!0,style:{width:"3rem"}},{field:"customer.name",header:"Müşteri Adı Soyadı",hidden:!d.includes("customer.name"),sortable:!0,filter:!0,filterPlaceholder:"Ad'a Göre"},{field:"customer.phone",header:"Müşteri Telefon Numarası",hidden:!d.includes("customer.phone"),sortable:!0,filter:!0,filterPlaceholder:"Müşteri Telefon Numarası'na Göre"},{field:"customer_note",header:"Sipariş Notu",hidden:!d.includes("customer_note"),sortable:!0,filter:!0,filterPlaceholder:"Sipariş Notu'na Göre",body:e=>e.customer_note?t.jsx("span",{children:e.customer_note}):t.jsx("span",{children:t.jsx("i",{className:"pi pi-ban text-red-400"})})},{field:"status",header:"Sipariş Durumu",hidden:!d.includes("status"),sortable:!0,filter:!0,filterElement:e=>t.jsx(oe,{options:w("draft",!0),value:e.value,filter:!0,filterBy:"label,value",onChange:n=>e.filterApplyCallback(n.value),itemTemplate:n=>t.jsx(E,{value:n.label,severity:n.severity}),placeholder:"Sipariş Durumu",className:"p-column-filter w-full",showClear:!0}),body:e=>t.jsx(E,{value:String(w(e.status).label),severity:String(w(e.status).severity)})},{field:"courier_accepted_at",header:"Kurye Teslim Alma Tarihi",hidden:!d.includes("courier_accepted_at"),sortable:!0,filter:!0,filterPlaceholder:"Kurye Teslim Alma Tarihine Göre",filterType:"date",body:e=>e.courier_accepted_at?t.jsx("span",{children:new Date(e.courier_accepted_at).toLocaleString()}):t.jsxs("span",{children:[t.jsx("i",{className:"pi pi-ban text-red-400"})," Teslim Alınmadı"]})},{field:"delivered_at",header:"Teslim Tarihi",hidden:!d.includes("delivered_at"),sortable:!0,filter:!0,filterPlaceholder:"Teslim Tarihine Göre",filterType:"date",body:e=>e.delivered_at?t.jsx("span",{children:new Date(e.delivered_at).toLocaleString()}):t.jsxs("span",{children:[t.jsx("i",{className:"pi pi-ban text-red-400"})," Teslim Edilmedi"]})},{field:"cancellation_reason",header:"İptal Nedeni",hidden:!d.includes("cancellation_reason"),sortable:!0,filter:!0,filterPlaceholder:"İptal Nedeni'ne Göre",body:e=>e.cancellation_reason?t.jsx("span",{children:e.cancellation_reason}):t.jsxs("span",{children:[t.jsx("i",{className:"pi pi-ban text-red-400"})," İptal Edilmedi"]})},{field:"canceled_at",header:"İptal Tarihi",hidden:!d.includes("canceled_at"),sortable:!0,filter:!0,filterPlaceholder:"İptal Tarihine Göre",filterType:"date",body:e=>e.canceled_at?t.jsx("span",{children:new Date(e.canceled_at).toLocaleString()}):t.jsxs("span",{children:[t.jsx("i",{className:"pi pi-ban text-red-400"})," İptal Edilmedi"]})},{field:"created_at",header:"Eklenme Tarihi",hidden:!d.includes("created_at"),sortable:!0,filter:!0,filterPlaceholder:"Eklenme Tarihine Göre",filterType:"date",body:e=>t.jsx("span",{children:new Date(e.created_at).toLocaleString()})},{field:"updated_at",header:"Güncelleme Tarihi",hidden:!d.includes("updated_at"),sortable:!0,filter:!0,filterPlaceholder:"Güncellenme Tarihine Göre",filterType:"date",body:e=>t.jsx("span",{children:new Date(e.updated_at).toLocaleString()})},{field:"actions",header:"İşlemler",hidden:!d.includes("actions"),body:e=>t.jsxs("div",{className:"flex gap-2",children:[e.status==="draft"&&t.jsx(g,{size:"small",icon:"pi pi-check-circle",severity:"success",tooltip:"Yayınla",loading:l,tooltipOptions:{position:"top"},disabled:e.status!=="draft",onClick:()=>{K(e.id)}}),e.status==="draft"&&t.jsx(g,{size:"small",icon:"pi pi-trash",severity:"danger",tooltip:"Sil",tooltipOptions:{position:"top"},loading:l,onClick:n=>{D(n,e.id)}}),e.status!=="draft"&&e.status!=="deleted"&&e.status!=="canceled"&&t.jsx(g,{size:"small",icon:"pi pi-ban",severity:"danger",tooltip:"Siparişi İptal Et",tooltipOptions:{position:"top"},loading:l,onClick:n=>{var i;R({orderId:e.id,reason:""}),(i=S.current)==null||i.toggle(n)}})]})}];const k=u.useRef(null),U=()=>t.jsx(t.Fragment,{children:t.jsx(ie,{end:t.jsxs(t.Fragment,{children:[t.jsx(g,{size:"small",icon:"pi pi-sync",severity:"help",className:"mr-2",tooltip:"Verileri Yenile",tooltipOptions:{position:"top"},onClick:()=>{y()}}),t.jsx(g,{size:"small",icon:"pi pi-bars",onClick:e=>{var n;(n=k.current)==null||n.toggle(e)}})]})})}),m=q.useRef(null);return t.jsx(Z,{auth:a,csrfToken:r,children:t.jsxs(ee,{children:[t.jsx(Q,{title:"Siparişler"}),t.jsx(te,{ref:m}),t.jsxs(z,{ref:k,showCloseIcon:!0,style:{width:"300px"},children:[t.jsx("div",{className:"flex align-items-center justify-content-start mb-3",children:t.jsxs("span",{className:"text-900 text-lg font-bold",children:["Sütunlar (",d.length,")"]})}),t.jsx("div",{className:"flex flex-column justify-content-center gap-2",children:L.map((e,n)=>{if(e.selectionMode==="multiple"||(e==null?void 0:e.expander)!==void 0)return null;let i=e.header,o=e.field;return t.jsxs("div",{className:"flex align-items-center",children:[t.jsx(se,{inputId:`column${n}`,checked:d.includes(o),onChange:p=>{p.checked?b([...d,o]):b(d.filter(h=>h!==o))}}),t.jsx("label",{htmlFor:`column${n}`,className:"ml-2",children:i})]},n)})})]}),t.jsxs(z,{ref:S,showCloseIcon:!0,style:{width:"300px"},children:[t.jsx("h6",{children:"İptal Sebebinizi Belirterek Siparişi İptal Edebilirsiniz"}),t.jsx(re,{value:_.reason,onChange:e=>{R({..._,reason:e.target.value})},placeholder:"İptal Sebebi",className:"w-full mb-2"}),t.jsx(g,{label:"İptal Et",size:"small",className:"mt-2",severity:"danger",icon:"pi pi-ban",onClick:()=>{F(_.orderId,_.reason)}})]}),t.jsxs("div",{className:"card",children:[t.jsx("span",{className:"text-900 text-xl font-bold mb-4 block",children:"Siparişler"}),x!==null&&t.jsx(B,{className:"w-full",severity:"error",text:x}),!l&&f.length===0&&t.jsx(B,{className:"w-full",severity:"info",text:"Sipariş bulunamadı."}),t.jsx(le,{hidden:!l&&f.length===0||x!==null,loading:l,value:f,removableSort:!0,paginator:!0,filterDisplay:"row",paginatorTemplate:"RowsPerPageDropdown FirstPageLink PrevPageLink CurrentPageReport NextPageLink LastPageLink",rowsPerPageOptions:[5,10,25,50],rows:10,dataKey:"id",header:U,expandedRows:T,onRowToggle:e=>M(e==null?void 0:e.data),rowExpansionTemplate:e=>t.jsx(ae,{page:!1,order:e,orderId:e.id,csrfToken:r,auth:a}),filters:{"customer.name":{value:null,matchMode:"contains"},"customer.phone":{value:null,matchMode:"contains"},created_at:{value:null,matchMode:"contains"},updated_at:{value:null,matchMode:"contains"},status:{value:null,matchMode:"contains"},courier_accepted_at:{value:null,matchMode:"contains"},delivered_at:{value:null,matchMode:"contains"},canceled_at:{value:null,matchMode:"contains"},cancellation_reason:{value:null,matchMode:"contains"},customer_note:{value:null,matchMode:"contains"}},emptyMessage:"Sipariş bulunamadı.",currentPageReportTemplate:"{first}. ile {last}. arası toplam {totalRecords} kayıttan",children:L.map((e,n)=>t.jsx(ne,{...e},n))})]})]})})};export{Ce as default};
