import{R as L,r as n,j as e,Y as V,B as f,c as o}from"./app-rTocBdX6.js";import{P as Y,M as I}from"./PageContainer-hvsvC_1A.js";import{c as R,a as C,b as q,u as T,T as Z}from"./toast.esm-D2zVde1g.js";import{g as G,b as U}from"./customer-CjbiwGLN.js";import{D as S,I as k}from"./message.esm-CpfBJrYs.js";import J from"./Create-BCTc2ubH.js";import{D as Q}from"./dialog.esm-C4iS-gnr.js";import{b as W}from"./orders-BZT0rZSC.js";import"./PersonalInformation-RKrmWs6q.js";import"./inputmask.esm-CmU3ILfg.js";import"./PersonalInformation-C1UDdiEn.js";import"./styleclass.esm-MLMHqxm8.js";import"./index.esm-CwfZ2Ckd.js";const pe=({auth:g,csrfToken:u})=>{const c=L.useRef(null),[y,m]=n.useState(!1),[A,z]=n.useState([]),[w,x]=n.useState(!1),[h,v]=n.useState([]),[_,M]=n.useState(!1),O=R().shape({customer_id:C().required("Müşteri Seçimi Zorunludur"),address_id:C().required("Adres Seçimi Zorunludur"),customer_note:q().nullable().min(3,"Müşteri Notu En Az 3 Karakter Olmalıdır").max(255,"Müşteri Notu En Fazla 255 Karakter Olmalıdır")}),j=()=>{m(!0),G(u).then(t=>{t.status&&z(t.customers.map(s=>({...s,namePhone:`${s.name} - ${s.phone}`})))}).catch(t=>{var s;console.error(t),(s=c.current)==null||s.show({severity:"error",summary:"Hata",detail:"Bir hata oluştu lütfen tekrar deneyiniz."})}).finally(()=>m(!1))},B=t=>{m(!0),U(t,u).then(s=>{s.status&&v(s.addresses.map(r=>({...r,titleCityDistrict:`${r.title} - ${r.city} - ${r.district}`})))}).catch(s=>{var r;console.error(s),(r=c.current)==null||r.show({severity:"error",summary:"Hata",detail:"Bir hata oluştu lütfen tekrar deneyiniz."})}).finally(()=>m(!1))},{values:l,setFieldValue:a,resetForm:b,submitCount:d,setErrors:X,handleChange:$,handleSubmit:E,errors:i,isValid:F,dirty:P}=T({initialValues:{customer_note:"",selectedCustomer:null,customer_id:null,selectedAddress:null,address_id:null,location:null},validationSchema:O,validateOnBlur:_,validateOnChange:_,onSubmit:t=>{m(!0),W({customer_id:t.customer_id,address_id:t.address_id,customer_note:t.customer_note,location:t.location!==null?t.location:null},u).then(s=>{var r,N;s.status?((r=c.current)==null||r.show({severity:"success",summary:"Başarılı",detail:s.message}),b()):(N=c.current)==null||N.show({severity:"error",summary:"Hata",detail:s.message})}).catch(()=>{var s;(s=c.current)==null||s.show({severity:"error",summary:"Hata",detail:"Bir hata oluştu lütfen tekrar deneyiniz."})}).finally(()=>{m(!1)})}}),[D,p]=n.useState(!1),H=()=>{var t;p(!0),navigator.geolocation?navigator.geolocation.getCurrentPosition(s=>{console.log(s),p(!1),b({values:{...l,location:{latitude:s.coords.latitude,longitude:s.coords.longitude}}})},s=>{console.error(s),p(!1)},{enableHighAccuracy:!0,timeout:5e3,maximumAge:0}):(p(!1),(t=c.current)==null||t.show({severity:"error",summary:"Hata",detail:"Tarayıcınız konum servislerini desteklemiyor."}))};n.useEffect(()=>{j()},[]),n.useEffect(()=>{d>0&&M(!0)},[d]);const K=t=>`${t.city} - ${t.district} - ${t.phone} - ${t.address}`;return e.jsx(Y,{auth:g,csrfToken:u,children:e.jsxs(I,{children:[e.jsx(V,{title:"Yeni Sipariş Ekle"}),e.jsx(Z,{ref:c}),e.jsxs("div",{className:"card",children:[e.jsx("span",{className:"text-900 text-xl font-bold mb-4 block",children:"Yeni Sipariş Ekle"}),e.jsxs("div",{className:"grid",children:[e.jsxs("div",{className:"col-12 lg:col-2",children:[e.jsx("div",{className:"text-900 font-medium text-xl mb-3",children:"Sipariş Bilgileri"}),e.jsxs("p",{className:"m-0 p-0 text-600 line-height-3 mr-3",children:["Konumunuza en yakın kuryeyi bulmak için lütfen sipariş bilgilerini eksiksiz doldurunuz.",e.jsxs("div",{className:"flex gap-2",children:[e.jsx(f,{icon:"pi pi-map-marker",size:"small",severity:l.location!==null?"success":"info",tooltipOptions:{position:"top"},onClick:H,loading:D,disabled:l.location!==null,tooltip:l.location!==null?"Konum Kullanılıyor":"Konumumu Kullan",className:"mt-3"}),e.jsx(f,{icon:"pi pi-user-plus",size:"small",onClick:()=>x(!0),tooltipOptions:{position:"top"},tooltip:"Yeni Müşteri Ekle",className:"mt-3"})]}),i&&Object.keys(i).length>0&&e.jsx(e.Fragment,{children:e.jsx("ul",{className:"mt-3",children:Object.keys(i).map((t,s)=>e.jsx("li",{className:"text-red-500 text-sm",children:i[t]},s))})})]})]}),e.jsx("div",{className:"col-12 lg:col-10",children:e.jsxs("form",{onSubmit:E,className:"grid formgrid p-fluid",children:[e.jsxs("div",{className:"field mb-4 col-12 md:col-6 p-input-icon-right",children:[e.jsxs("label",{htmlFor:"customer_id",className:o("font-medium text-900",{"text-red-500":!!i.customer_id,"text-green-500":!i.customer_id&&d>0}),children:[e.jsx("i",{className:o("pi",{"pi-times-circle text-red-500 text-sm":!!i.customer_id,"pi-check-circle text-green-500 text-sm":!i.customer_id&&d>0})})," Müşteri Seçimi"]}),e.jsx(S,{value:l.selectedCustomer,onChange:t=>{t.value===void 0?(a("selectedCustomer",null),a("customer_id",null),a("selectedAddress",null),a("address_id",null),v([])):(a("selectedCustomer",t.value),a("customer_id",t.value.id),a("selectedAddress",null),a("address_id",null),B(t.value.id))},options:A,optionLabel:"namePhone",inputId:"customer_id",placeholder:"Müşteri Seçiniz",className:o("w-full",{"p-invalid":!!i.customer_id}),filter:!0,virtualScrollerOptions:{itemSize:38},emptyMessage:"Müşteri Bulunamadı",emptyFilterMessage:"Müşteri Bulunamadı",filterBy:"namePhone"})]}),e.jsxs("div",{className:"field mb-4 col-12 md:col-6 p-input-icon-right",children:[e.jsxs("label",{htmlFor:"address_id",className:o("font-medium text-900",{"text-red-500":!!i.address_id,"text-green-500":!i.address_id&&d>0}),children:[e.jsx("i",{className:o("pi",{"pi-times-circle text-red-500 text-sm":!!i.address_id,"pi-check-circle text-green-500 text-sm":!i.address_id&&d>0})})," Adres Seçimi ",l.selectedCustomer!==null&&h.length===0&&e.jsx("span",{className:"text-red-400",children:"(Müşteriye ait adres bulunamadı)"})]}),e.jsx(S,{value:l.selectedAddress,onChange:t=>{t.value===void 0?(a("selectedAddress",null),a("address_id",null)):(a("selectedAddress",t.value),a("address_id",t.value.id))},disabled:l.selectedCustomer===null||h.length===0,options:h,optionLabel:"titleCityDistrict",inputId:"address_id",placeholder:"Adres Seçiniz",className:o("w-full",{"p-invalid":!!i.address_id}),filter:!0,virtualScrollerOptions:{itemSize:38},emptyMessage:"Adres Bulunamadı",emptyFilterMessage:"Adres Bulunamadı",filterBy:"titleCityDistrict"})]}),l.selectedAddress!==null&&e.jsxs("div",{className:"field mb-4 col-12 p-input-icon-right",children:[e.jsx("label",{htmlFor:"address",className:o("font-medium text-900"),children:"Seçilen Adres"}),e.jsx(k,{disabled:!0,readOnly:!0,value:l.address_id!==null?K(l.selectedAddress):""})]}),e.jsxs("div",{className:"field mb-4 col-12 p-input-icon-right",children:[e.jsxs("label",{htmlFor:"customer_note",className:o("font-medium text-900",{"text-red-500":!!i.customer_note,"text-green-500":!i.customer_note&&d>0}),children:[e.jsx("i",{className:o("pi",{"pi-times-circle text-red-500 text-sm":!!i.customer_note,"pi-check-circle text-green-500 text-sm":!i.customer_note&&d>0})})," Sipariş Notu"]}),e.jsx(k,{autoComplete:"off",name:"customer_note",id:"customer_note",tooltip:i==null?void 0:i.customer_note,tooltipOptions:{position:"top"},disabled:y,onChange:$,value:l.customer_note,className:o("w-full",{"p-invalid":!!i.customer_note})})]}),e.jsx("div",{className:"col-12",children:e.jsx(f,{label:"Sipariş Oluştur",disabled:!F||!P,loading:y,type:"submit",size:"small",className:"w-auto mt-3"})})]})})]})]}),e.jsx(Q,{onHide:()=>x(!1),visible:w,header:"Yeni Müşteri Ekle",style:{width:"60vw"},draggable:!1,resizable:!1,className:"mx-3 sm:mx-0 sm:w-full md:w-8 lg:w-8 p-fluid",modal:!0,children:e.jsx(J,{auth:g,csrfToken:u,page:!1,onComplete:()=>{x(!1),j()}})})]})})};export{pe as default};
