import{r as i,u as J,j as e,B as d,c as Q,y as U,R as W,Y as X}from"./app-DfiApva1.js";import{P as Z,M as B}from"./PageContainer-CItWAE-M.js";import{T as G}from"./toast.esm-BUIr6eRr.js";import{b as j}from"./globalHelper-B-s3UrsJ.js";import{T as L,O as b,a as ee}from"./ActiveOrder-BV8Zpnbj.js";import{D as le,M as E}from"./message.esm-DXuI6qyr.js";import{C as te,D as se,a as ae,T as re}from"./checkbox.esm-CGOh0n92.js";import{T as ie}from"./tristatecheckbox.esm-Bquk81Dv.js";import ne from"./Show-EoGOF-Rd.js";import"./PersonalInformation-C0LAfeiM.js";import"./inputtext.esm-BJSyEN0I.js";import"./inputmask.esm-D7RyYABS.js";import"./PersonalInformation-D6nBh7q9.js";import"./styleclass.esm-BYWQmj5w.js";import"./index.esm-CF5HdvGh.js";import"./sidebar.esm-DYHP3OPq.js";import"./index.esm-CUcG1_9S.js";import"./orders-BQDg4cK4.js";const Me=({auth:g,csrfToken:u,courierIsTransporting:F=!1})=>{var S,M,P,w,k,C,O,R,A;const[c,o]=i.useState(!0),[m,z]=i.useState([]),[r,y]=J(["customer.name","business.name","price","delivered_at","actions"],"CourierOrdersAllTableColumns"),[p,h]=i.useState(null),[D,I]=i.useState([]),v=()=>{o(!0),ee(u).then(l=>{l.status?(z(l.orders.map(t=>({...t,cancellation_accepted:t.cancellation_accepted===1}))),o(!1),h(null)):(h(l.message),o(!1))}).catch(l=>{h(l.message),o(!1)}).finally(()=>o(!1))};i.useEffect(()=>{v()},[]);const f=i.useRef(null),$=i.useRef(null),[s,K]=i.useState(null),[a,q]=i.useState(null);let _=[{expander:!0,style:{width:"3rem"}},{field:"customer.name",header:"Müşteri",hidden:!r.includes("customer.name"),sortable:!0,filter:!0,filterPlaceholder:"Ad'a Göre",body:l=>e.jsx(d,{label:l.customer.name,link:!0,size:"small",severity:"info",onClick:t=>{var n;q(l.customer),(n=f.current)==null||n.toggle(t)}})},{field:"business.name",header:"İşletme",hidden:!r.includes("business.name"),sortable:!0,filter:!0,filterPlaceholder:"İşletmeye'a Göre",body:l=>e.jsx(d,{label:l.business.name,link:!0,size:"small",severity:"help",onClick:t=>{var n;K(l.business),(n=f.current)==null||n.toggle(t)}})},{field:"customer_note",header:"Sipariş Notu",hidden:!r.includes("customer_note"),sortable:!0,filter:!0,filterPlaceholder:"Sipariş Notu'na Göre",body:l=>l.customer_note?e.jsx("span",{children:l.customer_note}):e.jsx("span",{children:e.jsx("i",{className:"pi pi-ban text-red-400"})})},{field:"price",header:"Paket Ücreti",hidden:!r.includes("price"),sortable:!0,filter:!0,filterPlaceholder:"Fiyata'a Göre",body:l=>e.jsxs("span",{children:[l.price," ₺"]})},{field:"status",header:"Sipariş Durumu",hidden:!r.includes("status"),sortable:!0,filter:!0,filterElement:l=>e.jsx(le,{options:j("draft",!0),value:l.value,filter:!0,filterBy:"label,value",onChange:t=>l.filterApplyCallback(t.value),itemTemplate:t=>e.jsx(L,{value:t.label,severity:t.severity}),placeholder:"Sipariş Durumu",className:"p-column-filter w-full",showClear:!0}),body:l=>e.jsx(L,{value:String(j(l.status).label),severity:String(j(l.status).severity)})},{field:"courier_accepted_at",header:"Kurye Teslim Alma Tarihi",hidden:!r.includes("courier_accepted_at"),sortable:!0,filter:!0,filterPlaceholder:"Kurye Teslim Alma Tarihine Göre",filterType:"date",body:l=>l.courier_accepted_at?e.jsx("span",{children:new Date(l.courier_accepted_at).toLocaleString()}):e.jsxs("span",{children:[e.jsx("i",{className:"pi pi-ban text-red-400"})," Teslim Alınmadı"]})},{field:"delivered_at",header:"Teslim Tarihi",hidden:!r.includes("delivered_at"),sortable:!0,filter:!0,filterPlaceholder:"Teslim Tarihine Göre",filterType:"date",body:l=>l.delivered_at?e.jsx("span",{children:new Date(l.delivered_at).toLocaleString()}):e.jsxs("span",{children:[e.jsx("i",{className:"pi pi-ban text-red-400"})," Teslim Edilmedi"]})},{field:"cancellation_accepted",header:"İptal Onayı",hidden:!r.includes("cancellation_accepted"),sortable:!0,filter:!0,dataType:"boolean",filterElement:l=>e.jsx(ie,{value:l.value,onChange:t=>l.filterApplyCallback(t.value)}),body:l=>e.jsx("i",{className:Q("pi",{"pi-check-circle text-green-400":l.cancellation_accepted,"pi-times-circle text-red-400":!l.cancellation_accepted})})},{field:"canceled_at",header:"İptal Tarihi",hidden:!r.includes("canceled_at"),sortable:!0,filter:!0,filterPlaceholder:"İptal Tarihine Göre",filterType:"date",body:l=>l.canceled_at?e.jsx("span",{children:new Date(l.canceled_at).toLocaleString()}):e.jsxs("span",{children:[e.jsx("i",{className:"pi pi-ban text-red-400"})," İptal Edilmedi"]})},{field:"created_at",header:"Eklenme Tarihi",hidden:!r.includes("created_at"),sortable:!0,filter:!0,filterPlaceholder:"Eklenme Tarihine Göre",filterType:"date",body:l=>e.jsx("span",{children:new Date(l.created_at).toLocaleString()})},{field:"updated_at",header:"Güncelleme Tarihi",hidden:!r.includes("updated_at"),sortable:!0,filter:!0,filterPlaceholder:"Güncellenme Tarihine Göre",filterType:"date",body:l=>e.jsx("span",{children:new Date(l.updated_at).toLocaleString()})},{field:"actions",header:"İşlemler",hidden:!r.includes("actions"),body:l=>e.jsx("div",{className:"flex gap-2",children:e.jsx(d,{size:"small",icon:"pi pi-eye",severity:"info",tooltip:"Görüntüle",loading:c,tooltipOptions:{position:"top"},onClick:()=>{U.visit(route("business.orders.show",l.id))}})})}];const N=i.useRef(null),Y=()=>e.jsx(e.Fragment,{children:e.jsx(re,{end:e.jsxs(e.Fragment,{children:[e.jsx(d,{size:"small",icon:"pi pi-sync",severity:"help",className:"mr-2",tooltip:"Verileri Yenile",tooltipOptions:{position:"top"},onClick:()=>{v()}}),e.jsx(d,{size:"small",icon:"pi pi-bars",onClick:l=>{var t;(t=N.current)==null||t.toggle(l)}})]})})}),T=W.useRef(null);return e.jsxs(Z,{auth:g,csrfToken:u,courierIsTransporting:F,children:[e.jsx(G,{ref:T}),e.jsxs(B,{children:[e.jsx(X,{title:"Siparişler"}),e.jsx(G,{ref:T}),e.jsxs(b,{ref:N,showCloseIcon:!0,style:{width:"300px"},children:[e.jsx("div",{className:"flex align-items-center justify-content-start mb-3",children:e.jsxs("span",{className:"text-900 text-lg font-bold",children:["Sütunlar (",r.length,")"]})}),e.jsx("div",{className:"flex flex-column justify-content-center gap-2",children:_.map((l,t)=>{if(l.selectionMode==="multiple"||(l==null?void 0:l.expander)!==void 0)return null;let n=l.header,x=l.field;return e.jsxs("div",{className:"flex align-items-center",children:[e.jsx(te,{inputId:`column${t}`,checked:r.includes(x),onChange:H=>{H.checked?y([...r,x]):y(r.filter(V=>V!==x))}}),e.jsx("label",{htmlFor:`column${t}`,className:"ml-2",children:n})]},t)})})]}),e.jsx(b,{ref:f,showCloseIcon:!0,style:{width:300},children:s!==null&&e.jsxs(e.Fragment,{children:[e.jsxs("ul",{className:"m-0 px-3 list-none",children:[e.jsxs("li",{children:["İşletme Adı: ",e.jsx("span",{className:"font-semibold",children:s==null?void 0:s.name})]}),e.jsxs("li",{children:["İşletme Telefon No: ",e.jsx("span",{className:"font-semibold",children:s==null?void 0:s.phone})]}),e.jsxs("li",{children:["İşletme İl: ",e.jsx("span",{className:"font-semibold",children:(S=s==null?void 0:s.details)==null?void 0:S.city})]}),e.jsxs("li",{children:["İşletme İlçe: ",e.jsx("span",{className:"font-semibold",children:(M=s==null?void 0:s.details)==null?void 0:M.state})]}),e.jsxs("li",{children:["İşletme Adres: ",e.jsx("span",{className:"font-semibold",children:(P=s==null?void 0:s.details)==null?void 0:P.address})]})]}),e.jsx(d,{label:"Google Maps'te Aç",size:"small",icon:"pi pi-external-link",severity:"help",className:"w-full mt-2",onClick:()=>{var l,t;window.open(`https://www.google.com/maps/search/?api=1&query=${(l=s==null?void 0:s.details)==null?void 0:l.latitude},${(t=s==null?void 0:s.details)==null?void 0:t.longitude}`,"_blank")}})]})}),e.jsx(b,{ref:$,showCloseIcon:!0,style:{width:300},children:a!==null&&e.jsx(e.Fragment,{children:e.jsxs("ul",{className:"m-0 px-3 list-none",children:[e.jsxs("li",{children:["Müşteri Adı: ",e.jsx("span",{className:"font-semibold",children:(w=a==null?void 0:a.customer)==null?void 0:w.name})]}),e.jsxs("li",{children:["Müşteri Telefon No: ",e.jsx("span",{className:"font-semibold",children:(k=a==null?void 0:a.address)==null?void 0:k.phone})]}),e.jsxs("li",{children:["Müşteri İl: ",e.jsx("span",{className:"font-semibold",children:(C=a==null?void 0:a.address)==null?void 0:C.city})]}),e.jsxs("li",{children:["Müşteri İlçe: ",e.jsx("span",{className:"font-semibold",children:(O=a==null?void 0:a.address)==null?void 0:O.district})]}),e.jsxs("li",{children:["Müşteri Adres: ",e.jsx("span",{className:"font-semibold",children:(R=a==null?void 0:a.address)==null?void 0:R.address})]}),e.jsxs("li",{children:["Müşteri Adres Notu: ",e.jsx("span",{className:"font-semibold",children:(A=a==null?void 0:a.address)==null?void 0:A.notes})]})]})})}),e.jsxs("div",{className:"card",children:[e.jsx("span",{className:"text-900 text-xl font-bold mb-4 block",children:"Siparişler"}),p!==null&&e.jsx(E,{className:"w-full",severity:"error",text:p}),!c&&m.length===0&&e.jsx(E,{className:"w-full",severity:"info",text:"Sipariş bulunamadı."}),e.jsx(se,{hidden:!c&&m.length===0||p!==null,loading:c,value:m,removableSort:!0,paginator:!0,filterDisplay:"row",paginatorTemplate:"RowsPerPageDropdown FirstPageLink PrevPageLink CurrentPageReport NextPageLink LastPageLink",rowsPerPageOptions:[5,10,25,50],rows:10,dataKey:"id",header:Y,expandedRows:D,onRowToggle:l=>I(l==null?void 0:l.data),rowExpansionTemplate:l=>e.jsx(ne,{page:!1,order:l,orderId:l.id,csrfToken:u,auth:g}),filters:{"customer.name":{value:null,matchMode:"contains"},"customer.phone":{value:null,matchMode:"contains"},created_at:{value:null,matchMode:"contains"},updated_at:{value:null,matchMode:"contains"},"business.name":{value:null,matchMode:"contains"},status:{value:null,matchMode:"contains"},courier_accepted_at:{value:null,matchMode:"contains"},delivered_at:{value:null,matchMode:"contains"},canceled_at:{value:null,matchMode:"contains"},cancellation_reason:{value:null,matchMode:"contains"},price:{value:null,matchMode:"contains"},customer_note:{value:null,matchMode:"contains"},cancellation_accepted:{value:null,matchMode:"equals"}},emptyMessage:"Sipariş bulunamadı.",currentPageReportTemplate:"{first}. ile {last}. arası toplam {totalRecords} kayıttan",children:_.map((l,t)=>e.jsx(ae,{...l},t))})]})]})]})};export{Me as default};
