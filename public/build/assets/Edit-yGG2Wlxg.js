import{r as c,L as $,R as L,j as e,Y as T,c as s,B}from"./app-j6PEhqpP.js";import{P as H,M as V}from"./PageContainer-CNKbsat-.js";import{c as G,a as M,b as m,d as P,u as Z,I as b}from"./inputtext.esm-DVoroEiL.js";import{T as K}from"./toast.esm-wwTx3ct0.js";import{I as U}from"./inputmask.esm-Dm9AOoXZ.js";import{I as S}from"./inputswitch.esm-DWu5y5pa.js";import{c as Y,u as J}from"./businesses-B8cWdWWF.js";import{B as Q}from"./ActiveOrder-D2ZjGFlE.js";import"./PersonalInformation-BfZYf5oV.js";import"./message.esm-6Xok8xo0.js";import"./index.esm-fbcK3nX0.js";import"./PersonalInformation-DkiGRzm-.js";import"./globalHelper-DC93hlCg.js";import"./styleclass.esm-ChhZHvQm.js";import"./sidebar.esm-fF8ZoMoc.js";const ue=({auth:E,csrfToken:g,businessId:w=0})=>{const{setBreadcrumbs:F}=c.useContext($);c.useEffect(()=>{F(t=>[...t,{labels:["İşletmeler","Düzenle"],to:window.location.href}])},[]);const[l,A]=c.useState({id:"",name:"",email:"",phone:"",password_change:!1,password:"",password_confirmation:"",account_verification:!1,activated_at:""}),p=L.useRef(null),[u,v]=c.useState(!0),[N,D]=c.useState(!1),O=G().shape({id:M().required("İşletme ID bilgisi bulunamadı"),email:m().email("Geçerli bir email adresi giriniz").required("Email adresinizi giriniz"),name:m().required("Ad soyad giriniz").min(3,"Ad Soyad en az 3 karakter olmalıdır"),phone:m().required("Telefon numarası giriniz").matches(/^\(\d{3}\)-\d{3}-\d{4}$/,"Geçerli bir telefon numarası giriniz"),password:m().when("password_change",{is:!0,then:()=>m().required("Şifrenizi giriniz").min(6,"Şifreniz en az 6 karakter olmalıdır").matches(/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)[a-zA-Z\d!@#$%^&*(),.?":{}|<>]{6,}$/,"Şifreniz en az bir büyük harf, bir küçük harf ve bir rakam içermelidir"),otherwise:()=>m().notRequired()}),password_confirmation:m().when("password_change",{is:!0,then:()=>m().required("Şifreyi tekrar giriniz").oneOf([P("password"),""],"Şifreler uyuşmuyor"),otherwise:()=>m().notRequired()})}),[j,y]=c.useState(!1),k=Z({initialValues:l,validationSchema:O,validateOnChange:N,validateOnBlur:N,enableReinitialize:!0,onSubmit:t=>{v(!0);let o={name:t.name,email:t.email,phone:t.phone,password:t.password,password_confirmation:t.password_confirmation,account_verification:t.account_verification?1:0};t.password_change===!0&&(o={...o,password_change:1}),J(w,o,g).then(i=>{var f,x;if(i.status){(f=p.current)==null||f.show({severity:"success",summary:"Başarılı",detail:i.message});let d={id:i.business.id,name:i.business.name,email:i.business.email,phone:i.business.phone,password_change:!1,password:"",password_confirmation:"",account_verification:i.business.activated===1,activated_at:i.business.activated_at===null?!1:new Date(i.business.activated_at).toLocaleString()};C({values:d})}else{let d={};i!=null&&i.emailExists&&(i==null?void 0:i.emailExists)===!0&&(d={...d,email:"Bu email adresi zaten kullanılmakta"}),i!=null&&i.phoneExists&&(i==null?void 0:i.phoneExists)===!0&&(d={...d,phone:"Bu telefon numarası zaten kullanılmakta"}),_(d),(x=p.current)==null||x.show({severity:"error",summary:"Hata",detail:i.message})}}).catch(()=>{var i;(i=p.current)==null||i.show({severity:"error",summary:"Hata",detail:"Bir hata oluştu lütfen tekrar deneyiniz."})}).finally(()=>{v(!1)})}});let{values:r,setFieldValue:z,resetForm:C,submitCount:n,setErrors:_,handleChange:h,handleSubmit:q,isValid:R,dirty:I}=k,a=k.errors;return c.useEffect(()=>{w!==void 0&&Y(w,g).then(t=>{var f;let{status:o}=t,i=t.business;if(o){let x={id:i.id,name:i.name,email:i.email,phone:i.phone,password_change:!1,password:"",password_confirmation:"",account_verification:i.activated===1,activated_at:i.activated_at===null?!1:new Date(i.activated_at).toLocaleString()};A(x),C({values:x,errors:{}})}else y(!0),_({id:"İşletme bilgileri alınamadı"}),(f=p.current)==null||f.show({severity:"error",summary:"Hata",detail:"İşletme bilgileri alınamadı"})}).catch(t=>{var o;console.error(t),y(!0),_({id:"İşletme bilgileri alınamadı"}),(o=p.current)==null||o.show({severity:"error",summary:"Hata",detail:"İşletme bilgileri alınamadı"})}).finally(()=>{v(!1)})},[g,w]),c.useEffect(()=>{n>0&&D(!0)},[n]),e.jsx(H,{auth:E,csrfToken:g,children:e.jsxs(V,{children:[e.jsx(T,{title:(l==null?void 0:l.name)!==""?"'"+(l==null?void 0:l.name)+"' Adlı İşletmeyi Düzenle":""}),e.jsx(K,{ref:p}),e.jsxs("div",{className:"card",children:[e.jsxs("span",{className:"text-900 text-xl font-bold mb-4 block",children:[(l==null?void 0:l.name)!==""?"'"+(l==null?void 0:l.name)+"' Adlı İşletmeyi Düzenle":""," "]}),e.jsxs("div",{className:"grid",children:[e.jsxs("div",{className:"col-12 lg:col-2",children:[e.jsx("div",{className:"text-900 font-medium text-xl mb-3",children:"İşletme Bilgileri"}),e.jsxs("p",{className:"m-0 p-0 text-600 line-height-3 mr-3",children:["Bu Ekranda İşletme Sahibinin bilgilerini düzenleyebilirsiniz.",a&&Object.keys(a).length>0&&e.jsx(e.Fragment,{children:e.jsx("ul",{className:"mt-3",children:Object.keys(a).map((t,o)=>e.jsx("li",{className:"text-red-500 text-sm",children:a[t]},o))})})]})]}),e.jsx("div",{className:"col-12 lg:col-10",children:e.jsx(Q,{blocked:j,template:e.jsx("i",{className:"pi pi-exclamation-circle text-red-400",style:{fontSize:"3rem"}}),containerClassName:s("",{"p-3":j,"p-0":!j}),children:e.jsxs("form",{onSubmit:q,className:"grid formgrid p-fluid",children:[e.jsxs("div",{className:"field mb-4 col-12 md:col-6 p-input-icon-right",children:[e.jsxs("label",{htmlFor:"name",className:s("font-medium text-900",{"text-red-500":!!a.name,"text-green-500":!a.name&&n>0}),children:[e.jsx("i",{className:s("pi",{"pi-times-circle text-red-500 text-sm":!!a.name,"pi-check-circle text-green-500 text-sm":!a.name&&n>0})})," Ad Soyad (İşletme Sahibi)"]}),e.jsx(b,{id:"name",type:"text",autoComplete:"off",name:"name",tooltip:a.name,tooltipOptions:{position:"top"},disabled:u,onChange:h,value:r.name,className:s("w-full",{"p-invalid":!!a.name})})]}),e.jsxs("div",{className:"field mb-4 col-12 md:col-6 p-input-icon-right",children:[e.jsxs("label",{htmlFor:"email",className:s("font-medium text-900",{"text-red-500":!!a.email,"text-green-500":!a.email&&n>0}),children:[e.jsx("i",{className:s("pi",{"pi-times-circle text-red-500 text-sm":!!a.email,"pi-check-circle text-green-500 text-sm":!a.email&&n>0})})," Email Adresi"]}),e.jsx(b,{id:"email",type:"email",autoComplete:"off",name:"email",tooltip:a==null?void 0:a.email,tooltipOptions:{position:"top"},disabled:u,onChange:h,value:r.email,className:s("w-full",{"p-invalid":!!a.email})})]}),e.jsxs("div",{className:"field mb-4 col-12 md:col-6 p-input-icon-right",children:[e.jsxs("label",{htmlFor:"phone",className:s("font-medium text-900",{"text-red-500":!!a.phone,"text-green-500":!a.phone&&n>0}),children:[e.jsx("i",{className:s("pi",{"pi-times-circle text-red-500 text-sm":!!a.phone,"pi-check-circle text-green-500 text-sm":!a.phone&&n>0})})," Telefon Numarası"]}),e.jsx(U,{autoComplete:"off",name:"phone",tooltip:a==null?void 0:a.phone,tooltipOptions:{position:"top",event:"focus",className:"text-red-500"},disabled:u,onChange:h,value:r.phone,mask:"(999)-999-9999",className:s("w-full",{"p-invalid":!!a.phone})})]}),e.jsxs("div",{className:"field mb-4 col-12 p-input-icon-right",children:[e.jsx("label",{htmlFor:"password_change",className:s("font-medium text-900 cursor-pointer select-none"),children:"Şifre Değişikliği"}),e.jsx("br",{}),e.jsx(S,{inputId:"password_change",checked:r.password_change,onChange:t=>z("password_change",t.value??!1)})]}),r.password_change&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"field mb-4 col-12 md:col-6 p-input-icon-right",children:[e.jsxs("label",{htmlFor:"password",className:s("font-medium text-900",{"text-red-500":!!a.password,"text-green-500":!a.password&&n>0}),children:[e.jsx("i",{className:s("pi",{"pi-times-circle text-red-500 text-sm":!!a.password,"pi-check-circle text-green-500 text-sm":!a.password&&n>0})})," Şifre"]}),e.jsx(b,{id:"password",type:"password",autoComplete:"off",name:"password",tooltip:a==null?void 0:a.password,tooltipOptions:{position:"top"},disabled:u,onChange:h,value:r.password,className:s("w-full",{"p-invalid":!!a.password})})]}),e.jsxs("div",{className:"field mb-4 col-12 md:col-6 p-input-icon-right",children:[e.jsxs("label",{htmlFor:"password_confirmation",className:s("font-medium text-900",{"text-red-500":!!a.password_confirmation,"text-green-500":!a.password_confirmation&&n>0}),children:[e.jsx("i",{className:s("pi",{"pi-times-circle text-red-500 text-sm":!!a.password_confirmation,"pi-check-circle text-green-500 text-sm":!a.password_confirmation&&n>0})})," Şifre Tekrarı"]}),e.jsx(b,{id:"password_confirmation",type:"password",autoComplete:"off",name:"password_confirmation",tooltip:a==null?void 0:a.password_confirmation,tooltipOptions:{position:"top"},disabled:u,onChange:h,value:r.password_confirmation,className:s("w-full",{"p-invalid":!!a.password_confirmation})})]})]}),e.jsxs("div",{className:"field mb-4 col-12 md:col-6 p-input-icon-right",children:[e.jsxs("label",{htmlFor:"account_verification",className:s("font-medium text-900 cursor-pointer select-none"),children:["Hesap Aktifliği ",r.account_verification&&r.activated_at!==!1&&e.jsxs("span",{className:"text-green-500",children:["Aktifleştirme Tarihi : ",r.activated_at]})]}),e.jsx("br",{}),e.jsx(S,{inputId:"account_verification",checked:r.account_verification,onChange:t=>z("account_verification",t.value??!1)})]}),e.jsxs("div",{className:"col-12",children:[e.jsx(B,{label:"Geri",icon:"pi pi-arrow-left",type:"button",severity:"secondary",size:"small",onClick:()=>{window.history.back()},className:"w-auto mt-3 mr-2"}),e.jsx(B,{label:"İşletmeyi Kaydet",disabled:!R||!I,loading:u,size:"small",type:"submit",className:"w-auto mt-3"})]})]})})})]})]})]})})};export{ue as default};
