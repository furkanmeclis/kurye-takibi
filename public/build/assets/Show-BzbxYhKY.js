import{r as o,L as A,j as e,T as z,b as L,B}from"./app-C7KCH85h.js";import{P as M,M as E}from"./PageContainer-cZa-KtPx.js";import{L as x,s as D,f as $,r as O,l as C,m as P,A as s,T as Z,M as K,a as I,b as G,P as H,c as q}from"./ActiveOrder-BzF7Xial.js";import{b as f}from"./globalHelper-DC93hlCg.js";import{T as F}from"./toast.esm-ChJ7o9Yf.js";import{b as R,m as U,c as W}from"./PersonalInformation-CFPCs-iQ.js";import"./PersonalInformation-korKsWPp.js";import"./inputtext.esm-KLIqssz8.js";import"./inputmask.esm-CPoZMXYd.js";import"./message.esm-Can9Yc15.js";import"./index.esm-BtriMSeC.js";import"./styleclass.esm-BpUyAfSu.js";import"./sidebar.esm-t1zv9ION.js";const Y=new x.Icon({iconUrl:D,iconSize:[32,32],iconAnchor:[12,41],popupAnchor:[1,-34],shadowSize:[41,41]}),J=new x.Icon({iconUrl:$,iconSize:[32,32],iconAnchor:[12,41],popupAnchor:[1,-34],shadowSize:[41,41]}),y=new x.Icon({iconUrl:O,iconSize:[16,16],iconAnchor:[12,41],popupAnchor:[1,-34],shadowSize:[41,41]}),pe=({page:u=!0,orderId:b=0,csrfToken:h="",auth:N={},courierIsTransporting:_=!1})=>{const d=o.useRef(null),[a,v]=o.useState({id:0,price:0,business_id:0,business:null,customer_id:0,courier_id:null,address_id:0,customer_note:"",status:"opened",courier:!1,start_location:{latitude:0,longitude:0},end_location:{latitude:0,longitude:0},cancellation_accepted:0,cancellation_accepted_by:null,cancellation_requested_by:null,cancellation_reason:null,marketplace:"web",marketplace_order_id:null,marketplace_order_details:null,marketplace_transactions:null,marketplace_customer:null,delivered_at:null,canceled_at:null,courier_accepted_at:null,created_at:"1970-01-01T00:00:00.000Z",updated_at:"1970-01-01T00:00:00.000Z",customer:{id:0,business_id:0,name:"",phone:"",note:null,created_at:"1970-01-01T00:00:00.000Z",updated_at:"1970-01-01T00:00:00.000Z"},address:{id:0,customer_id:0,phone:"",title:"",city:"",district:"",address:"",notes:"",created_at:"1970-01-01T00:00:00.000Z",updated_at:"1970-01-01T00:00:00.000Z"}}),[n,w]=o.useState([]),[S,Q]=o.useState(!1),[V,j]=o.useState(!1),{setBreadcrumbs:k}=o.useContext(A);o.useEffect(()=>{u&&k(l=>[...l,{labels:["Siparişler","Siparişi Görüntüle"],to:window.location.href}])},[]),o.useEffect(()=>{j(!0),C(b,h).then(l=>{var t;if(l.status){let r=l.order;v(r)}else(t=d.current)==null||t.show({severity:"error",summary:"Hata",detail:l.message})}).catch(l=>{var t;console.log(l),(t=d.current)==null||t.show({severity:"error",summary:"Hata",detail:"Bir hata oluştu."})}).finally(()=>j(!1))},[]),o.useEffect(()=>{a.courier!==!1&&a.courier!==null&&P(b,h).then(l=>{var t;l.status?w(l.locations.map(r=>({latitude:r.latitude,longitude:r.longitude}))):(t=d.current)==null||t.show({severity:"error",summary:"Hata",detail:l.message})}).catch(l=>{var t;console.log(l),(t=d.current)==null||t.show({severity:"error",summary:"Hata",detail:"Bir hata oluştu."})})},[a]);const T=l=>{let t=new Date(l.created_at),r=l.courier_accepted_at!==null?new Date(l.courier_accepted_at):null,m=l.delivered_at!==null?new Date(l.delivered_at):null,p=l.canceled_at!==null?new Date(l.canceled_at):null,i=[];return p!==null&&i.push({date:p,status:"Sipariş İptal Edildi",icon:"pi pi-times-circle",bg:"red-500"}),m!==null&&i.push({date:m,status:"Sipariş Teslim Edildi",icon:"pi pi-send",bg:"green-500"}),r!==null&&i.push({date:r,status:"Kurye Kabul Etti",icon:"pi pi-check-square",bg:"teal-500"}),i.push({date:t,status:"Sipariş Oluşturuldu",icon:"pi pi-file-import",bg:"yellow-500"}),i},g=()=>{var l,t,r,m,p;return e.jsxs("div",{className:`grid ${!u&&"bg-primary-50 py-2 px-3"}`,children:[e.jsx("div",{className:"col-12 lg:col-9 md:col-8",children:e.jsxs("div",{className:`${!u&&"bg-primary-50 py-2 px-3"}`,children:[e.jsx(z,{target:"[data-pr-tooltip]",position:"bottom",className:"zoomin"}),e.jsxs("div",{className:"grid row-gap-2",children:[e.jsx("div",{className:"col-12",children:e.jsx("span",{className:"text-xl font-semibold",children:"Sipariş Detayları"})}),e.jsxs("div",{className:"lg:col-3 md:col-4 col-6 cursor-pointer","data-pr-tooltip":"Müşteri Adı Soyadı",children:[e.jsx(s,{icon:"pi pi-user",shape:"circle",className:"bg-primary-300 font-semibold text-primary-800"}),e.jsx(L,{className:"font-semibold ml-2 text-color dark: text-decoration-none",href:route("business.customers.edit",a.customer.id),children:a.customer.name})]}),e.jsxs("div",{className:"lg:col-3 md:col-4 col-6 cursor-pointer","data-pr-tooltip":"Müşteri Telefon Numarası",children:[e.jsx(s,{icon:"pi pi-phone",shape:"circle",className:"bg-primary-300 font-semibold text-primary-800"}),e.jsx("a",{className:"font-semibold ml-2 text-color text-decoration-none",href:`tel:${a.customer.phone}`,children:a.customer.phone})]}),e.jsxs("div",{className:"lg:col-3 md:col-4 col-6 cursor-pointer","data-pr-tooltip":"Paket Ücreti",children:[e.jsx(s,{icon:"pi pi-turkish-lira",shape:"circle",className:"bg-primary-300 font-semibold text-primary-800"}),e.jsxs("span",{className:"font-semibold ml-2",children:[a.price," ₺"]})]}),e.jsxs("div",{className:"lg:col-3 md:col-4 col-6 cursor-pointer","data-pr-tooltip":"Sipariş Durumu",children:[e.jsx(s,{icon:"pi pi-check",shape:"circle",className:"bg-primary-300 font-semibold text-primary-800"}),e.jsx(Z,{className:"ml-2",value:f(a.statusfalse,a.cancellation_accepted===1,a.cancellation_rejected===1).label,severity:f(a.statusfalse,a.cancellation_accepted===1,a.cancellation_rejected===1).severity})]}),a.status==="canceled"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"col-12",children:e.jsx("span",{className:"text-xl font-semibold",children:"İptal Bilgileri"})}),e.jsxs("div",{className:"lg:col-3 md:col-4 col-6 cursor-pointer","data-pr-tooltip":"İptal Edilme Sebebi",children:[e.jsx(s,{icon:"pi pi-file",shape:"circle",className:"bg-primary-300 font-semibold text-primary-800"}),e.jsx("span",{className:"font-semibold ml-2",children:a.cancellation_reason})]}),e.jsxs("div",{className:"lg:col-3 md:col-4 col-6 cursor-pointer","data-pr-tooltip":"İptal Edilme Sebebi",children:[e.jsx(s,{icon:`pi pi-${a.cancellation_accepted===1?"check":"times"}-circle`,shape:"circle",className:"bg-primary-300 font-semibold text-primary-800"}),e.jsx("span",{className:"font-semibold ml-2",children:a.cancellation_accepted===1?"İptal Onaylandı":"İptal İşlemi Onay Bekliyor"})]}),e.jsxs("div",{className:"lg:col-3 md:col-4 col-6 cursor-pointer","data-pr-tooltip":"İptal Edilme Tarihi",children:[e.jsx(s,{icon:"pi pi-clock",shape:"circle",className:"bg-primary-300 font-semibold text-primary-800"}),e.jsx("span",{className:"font-semibold ml-2",children:new Date(String(a.canceled_at)).toLocaleString()})]}),e.jsxs("div",{className:"lg:col-3 md:col-4 col-6 cursor-pointer","data-pr-tooltip":"Onaylayan Yetkili",children:[e.jsx(s,{icon:"pi pi-user",shape:"circle",className:"bg-primary-300 font-semibold text-primary-800"}),e.jsx("span",{className:"font-semibold ml-2",children:a.cancellation_accepted_by!==null?a.cancellation_accepted_by.name:"Onaylanmadı"})]})]}),e.jsx("div",{className:"col-12",children:e.jsx("span",{className:"text-xl font-semibold",children:"Adres Bilgileri"})}),e.jsxs("div",{className:"lg:col-3 md:col-4 col-6 cursor-pointer","data-pr-tooltip":"Adres Başlığı",children:[e.jsx(s,{icon:"pi pi-tag",shape:"circle",className:"bg-primary-300 font-semibold text-primary-800"}),e.jsx("span",{className:"font-semibold ml-2",children:a.address.title})]}),e.jsxs("div",{className:"lg:col-3 md:col-4 col-6 cursor-pointer","data-pr-tooltip":"Adres Telefon Numarası",children:[e.jsx(s,{icon:"pi pi-phone",shape:"circle",className:"bg-primary-300 font-semibold text-primary-800"}),e.jsx("a",{className:"font-semibold ml-2 text-color text-decoration-none",href:`tel:${a.address.phone}`,children:a.address.phone})]}),e.jsxs("div",{className:"lg:col-3 md:col-4 col-6 cursor-pointer","data-pr-tooltip":"İl/İlçe",children:[e.jsx(s,{icon:"pi pi-map",shape:"circle",className:"bg-primary-300 font-semibold text-primary-800"}),e.jsxs("span",{className:"font-semibold ml-2",children:[a.address.city," / ",a.address.district]})]}),e.jsxs("div",{className:"lg:col-6 md:col-6 col-12 cursor-pointer","data-pr-tooltip":"Adres",children:[e.jsx(s,{icon:"pi pi-home",shape:"circle",className:"bg-primary-300 font-semibold text-primary-800"}),e.jsx("span",{"data-pr-position":"bottom",className:"font-semibold ml-2",children:a.address.address})]}),a.address.notes!==null&&e.jsxs("div",{className:"lg:col-6 md:col-6 col-12 cursor-pointer","data-pr-tooltip":"Notlar",children:[e.jsx(s,{icon:"pi pi-info",shape:"circle",className:"bg-primary-300 font-semibold text-primary-800"}),e.jsx("span",{className:"font-semibold ml-2",children:a.address.notes})]}),a.courier!==!1&&a.courier!==null&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"col-12",children:e.jsx("span",{className:"text-xl font-semibold",children:"Kurye Bilgileri"})}),e.jsxs("div",{className:"lg:col-3 md:col-4 col-6 cursor-pointer","data-pr-tooltip":"Kurye Adı Soyadı",children:[e.jsx(s,{icon:"pi pi-user",shape:"circle",className:"bg-primary-300 font-semibold text-primary-800"}),e.jsx("span",{className:"font-semibold ml-2",children:a.courier.name})]}),e.jsxs("div",{className:"lg:col-3 md:col-4 col-6 cursor-pointer","data-pr-tooltip":"Kurye Telefon Numarası",children:[e.jsx(s,{icon:"pi pi-phone",shape:"circle",className:"bg-primary-300 font-semibold text-primary-800"}),e.jsx("a",{className:"font-semibold ml-2 text-color text-decoration-none",href:`tel:${a.courier.phone}`,children:a.courier.phone})]}),e.jsxs("div",{className:"lg:col-3 md:col-4 col-6 cursor-pointer","data-pr-tooltip":"Kurye Email Adresi",children:[e.jsx(s,{icon:"pi pi-envelope",shape:"circle",className:"bg-primary-300 font-semibold text-primary-800"}),e.jsx("a",{className:"font-semibold ml-2 text-color text-decoration-none",href:`mailto:${a.courier.email}`,children:a.courier.email})]}),e.jsxs("div",{className:"lg:col-3 md:col-4 col-6 cursor-pointer flex align-items-center","data-pr-tooltip":"Teslimat Tipi",children:[e.jsx(s,{image:a.courier.details.vehicle_type==="bicycle"?R:a.courier.details.vehicle_type==="motorcycle"?U:W,className:"bg-primary-300 font-semibold text-primary-800 p-1"}),e.jsx("span",{className:"ml-2 font-semibold",children:a.courier.details.vehicle_type==="bicycle"?"Bisiklet":a.courier.details.vehicle_type==="motorcycle"?"Motosiklet":"Araba"})]}),e.jsxs("div",{className:"lg:col-3 md:col-4 col-6 cursor-pointer","data-pr-tooltip":"Siparişi Teslim Alma Tarihi",children:[e.jsx(s,{icon:"pi pi-clock",shape:"circle",className:"bg-primary-300 font-semibold text-primary-800"}),e.jsx("span",{className:"font-semibold ml-2",children:a.courier_accepted_at!==null?new Date(a.courier_accepted_at).toLocaleString():"-"})]}),a.delivered_at!==null&&e.jsxs("div",{className:"lg:col-3 md:col-4 col-6 cursor-pointer","data-pr-tooltip":"Siparişi Teslim Etme Tarihi",children:[e.jsx(s,{icon:"pi pi-stop-circle",shape:"circle",className:"bg-primary-300 font-semibold text-primary-800"}),e.jsx("span",{className:"font-semibold ml-2",children:new Date(a.delivered_at).toLocaleString()})]}),!S&&n.length>0&&e.jsx("div",{className:"col-12",children:e.jsxs(K,{center:[n[0].latitude,n[0].longitude],zoom:15,zoomControl:!0,attributionControl:!1,style:{height:"400px",borderRadius:"10px"},scrollWheelZoom:!1,children:[e.jsx(I,{url:"https://{s}.tile.openstreetmap.fr/hot/{z}/{x}/{y}.png"}),n.map((i,c)=>e.jsx(G,{position:[i.latitude,i.longitude],icon:c===0?Y:c===n.length-1&&a.status==="delivered"?J:y,children:e.jsxs(H,{children:[e.jsx("span",{className:"font-semibold flex justify-content-center text-lg",children:c===0?"Başlangıç":c===n.length-1&&a.status==="delivered"?"Bitiş":"Güzergah-"+c}),e.jsx(B,{label:"Google Maps'te Aç",size:"small",icon:"pi pi-external-link",severity:"help",className:"w-full mt-2 zoomindown",onClick:()=>{window.open(`https://www.google.com/maps/search/?api=1&query=${i.latitude},${i.longitude}`,"_blank")}})]})},c))]})})]}),e.jsx("div",{className:"col-12",children:e.jsx("span",{className:"text-xl font-semibold",children:"İşletme Bilgileri"})}),e.jsxs("div",{className:"lg:col-3 md:col-4 col-6 cursor-pointer","data-pr-tooltip":"İşletme Adı",children:[e.jsx(s,{icon:"pi pi-user",shape:"circle",className:"bg-primary-300 font-semibold text-primary-800"}),e.jsx("span",{className:"font-semibold ml-2",children:(l=a.business)==null?void 0:l.name})]}),e.jsxs("div",{className:"lg:col-3 md:col-4 col-6 cursor-pointer","data-pr-tooltip":"İşletme Telefon Numarası",children:[e.jsx(s,{icon:"pi pi-phone",shape:"circle",className:"bg-primary-300 font-semibold text-primary-800"}),e.jsx("a",{className:"font-semibold ml-2 text-color text-decoration-none",href:`tel:${(t=a.business)==null?void 0:t.phone}`,children:(r=a.business)==null?void 0:r.phone})]}),e.jsxs("div",{className:"lg:col-6 md:col-6 col-12 cursor-pointer","data-pr-tooltip":"İşletme Adresi",children:[e.jsx(s,{icon:"pi pi-home",shape:"circle",className:"bg-primary-300 font-semibold text-primary-800"}),e.jsx("span",{"data-pr-position":"bottom",className:"font-semibold ml-2",children:(p=(m=a.business)==null?void 0:m.details)==null?void 0:p.address})]})]})]})}),e.jsx("div",{className:"col-12 lg:col-3 md:col-4",children:e.jsx(q,{layout:"vertical",marker:i=>e.jsx("span",{className:`bg-${i.bg} flex w-2rem h-2rem align-items-center justify-content-center text-white border-circle z-1 shadow-1`,children:e.jsx("i",{className:i.icon})}),value:T(a),opposite:i=>i.status,content:i=>e.jsx("small",{className:"text-color-secondary",children:i.date.toLocaleString()})})})]})};return e.jsxs(e.Fragment,{children:[e.jsx(F,{ref:d}),u?e.jsx(M,{auth:N,csrfToken:h,courierIsTransporting:_,children:e.jsx(E,{children:e.jsx("div",{className:"card",children:e.jsx(g,{})})})}):e.jsx(g,{})]})};export{pe as default};
