import{r as n,L as A,R,j as e,Y as T,c as t,B as D}from"./app-CtBuySPm.js";import{P as $,M as L}from"./PageContainer-CNTqnO-9.js";import{c as V,a as M,b as o,d as G,u as H,T as U,I as x}from"./toast.esm-pY_r55P2.js";import{I as Z}from"./inputmask.esm-DRhN5-yE.js";import{I as K}from"./inputswitch.esm-DU6h03l0.js";import{B as Y}from"./blockui.esm-BES2J1Mz.js";import{u as J}from"./globalHelper-Bh-Mc7es.js";import{P as Q}from"./PersonalInformation-4kilmj6M.js";const me=({auth:s,csrfToken:h,courierId:W=0})=>{var N;const{setBreadcrumbs:y}=n.useContext(A);n.useEffect(()=>{y(l=>[...l,{labels:["Profil"],to:window.location.href}])},[]);const[z,w]=n.useState(!0),[C,X]=n.useState({id:s.user.id,name:s.user.name,email:s.user.email,phone:s.user.phone,password_change:!1,password:"",password_confirmation:"",account_verification:s.user.verified===1,verified_at:""}),u=R.useRef(null),[c,j]=n.useState(!1),[b,S]=n.useState(!1),E=V().shape({id:M().required("ID bilgisi bulunamadı"),email:o().email("Geçerli bir email adresi giriniz").required("Email adresinizi giriniz"),name:o().required("Ad soyad giriniz").min(3,"Ad Soyad en az 3 karakter olmalıdır"),phone:o().required("Telefon numarası giriniz").matches(/^\(\d{3}\)-\d{3}-\d{4}$/,"Geçerli bir telefon numarası giriniz"),password:o().when("password_change",{is:!0,then:()=>o().required("Şifre giriniz").min(6,"Şifre en az 6 karakter olmalıdır").matches(/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)[a-zA-Z\d]{6,}$/,"Şifreniz en az bir büyük harf, bir küçük harf ve bir rakam içermelidir"),otherwise:()=>o().notRequired()}),password_confirmation:o().when("password_change",{is:!0,then:()=>o().required("Şifreyi tekrar giriniz").oneOf([G("password"),""],"Şifreler uyuşmuyor"),otherwise:()=>o().notRequired()})}),[g,ee]=n.useState(!1),v=H({initialValues:C,validationSchema:E,validateOnChange:b,validateOnBlur:b,enableReinitialize:!0,onSubmit:l=>{j(!0);let f={name:l.name,email:l.email,phone:l.phone,password:l.password,password_confirmation:l.password_confirmation};l.password_change===!0&&(f={...f,password_change:1}),J(f,h).then(a=>{var _,k;if(a.status){(_=u.current)==null||_.show({severity:"success",summary:"Başarılı",detail:a.message});let d={id:a.user.id,name:a.user.name,email:a.user.email,phone:a.user.phone,password_change:!1,password:"",password_confirmation:"",account_verification:a.user.verified===1,verified_at:a.user.verified_at===null?!1:new Date(a.user.verified_at).toLocaleString()};a.updatePersonalInformation&&(w(!1),setTimeout(()=>{w(!0)},1)),P({values:d})}else{let d={};a!=null&&a.emailExists&&(a==null?void 0:a.emailExists)===!0&&(d={...d,email:"Bu email adresi zaten kullanılmakta"}),a!=null&&a.phoneExists&&(a==null?void 0:a.phoneExists)===!0&&(d={...d,phone:"Bu telefon numarası zaten kullanılmakta"}),B(d),(k=u.current)==null||k.show({severity:"error",summary:"Hata",detail:a.message})}}).catch(()=>{var a;(a=u.current)==null||a.show({severity:"error",summary:"Hata",detail:"Bir hata oluştu lütfen tekrar deneyiniz."})}).finally(()=>{j(!1)})}});let{values:m,setFieldValue:I,resetForm:P,submitCount:r,setErrors:B,handleChange:p,handleSubmit:F,isValid:O,dirty:q}=v,i=v.errors;return n.useEffect(()=>{r>0&&S(!0)},[r]),e.jsx($,{auth:s,csrfToken:h,profilePage:!0,children:e.jsxs(L,{children:[e.jsx(T,{title:"Profil"}),e.jsx(U,{ref:u}),e.jsx("div",{className:"card",children:e.jsxs("div",{className:"grid",children:[e.jsxs("div",{className:"col-12 lg:col-2",children:[e.jsx("div",{className:"text-900 font-medium text-xl mb-3",children:"Bilgileriniz"}),e.jsxs("p",{className:"m-0 p-0 text-600 line-height-3 mr-3",children:["Düzenlemek istediğiniz bilgilerinizi aşağıdaki formu kullanarak güncelleyebilirsiniz.",i&&Object.keys(i).length>0&&e.jsx(e.Fragment,{children:e.jsx("ul",{className:"mt-3",children:Object.keys(i).map((l,f)=>e.jsx("li",{className:"text-red-500 text-sm",children:i[l]},f))})})]})]}),e.jsx("div",{className:"col-12 lg:col-10",children:e.jsx(Y,{blocked:g,template:e.jsx("i",{className:"pi pi-exclamation-circle text-red-400",style:{fontSize:"3rem"}}),containerClassName:t("",{"p-3":g,"p-0":!g}),children:e.jsxs("form",{onSubmit:F,className:"grid formgrid p-fluid",children:[e.jsxs("div",{className:"field mb-4 col-12 md:col-6 p-input-icon-right",children:[e.jsxs("label",{htmlFor:"name",className:t("font-medium text-900",{"text-red-500":!!i.name,"text-green-500":!i.name&&r>0}),children:[e.jsx("i",{className:t("pi",{"pi-times-circle text-red-500 text-sm":!!i.name,"pi-check-circle text-green-500 text-sm":!i.name&&r>0})})," Ad Soyad"]}),e.jsx(x,{id:"name",type:"text",autoComplete:"off",name:"name",tooltip:i.name,tooltipOptions:{position:"top"},disabled:c,onChange:p,value:m.name,className:t("w-full",{"p-invalid":!!i.name})})]}),e.jsxs("div",{className:"field mb-4 col-12 md:col-6 p-input-icon-right",children:[e.jsxs("label",{htmlFor:"email",className:t("font-medium text-900",{"text-red-500":!!i.email,"text-green-500":!i.email&&r>0}),children:[e.jsx("i",{className:t("pi",{"pi-times-circle text-red-500 text-sm":!!i.email,"pi-check-circle text-green-500 text-sm":!i.email&&r>0})})," Email Adresi"]}),e.jsx(x,{id:"email",type:"email",autoComplete:"off",name:"email",tooltip:i==null?void 0:i.email,tooltipOptions:{position:"top"},disabled:c,onChange:p,value:m.email,className:t("w-full",{"p-invalid":!!i.email})})]}),e.jsxs("div",{className:"field mb-4 col-12 md:col-6 p-input-icon-right",children:[e.jsxs("label",{htmlFor:"phone",className:t("font-medium text-900",{"text-red-500":!!i.phone,"text-green-500":!i.phone&&r>0}),children:[e.jsx("i",{className:t("pi",{"pi-times-circle text-red-500 text-sm":!!i.phone,"pi-check-circle text-green-500 text-sm":!i.phone&&r>0})})," Telefon Numarası"]}),e.jsx(Z,{autoComplete:"off",name:"phone",tooltip:i==null?void 0:i.phone,tooltipOptions:{position:"top",event:"focus",className:"text-red-500"},disabled:c,onChange:p,value:m.phone,mask:"(999)-999-9999",className:t("w-full",{"p-invalid":!!i.phone})})]}),e.jsxs("div",{className:"field mb-4 col-12 p-input-icon-right",children:[e.jsx("label",{htmlFor:"password_change",className:t("font-medium text-900 cursor-pointer select-none"),children:"Şifre Değişikliği"}),e.jsx("br",{}),e.jsx(K,{inputId:"password_change",checked:m.password_change,onChange:l=>I("password_change",l.value??!1)})]}),m.password_change&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"field mb-4 col-12 md:col-6 p-input-icon-right",children:[e.jsxs("label",{htmlFor:"password",className:t("font-medium text-900",{"text-red-500":!!i.password,"text-green-500":!i.password&&r>0}),children:[e.jsx("i",{className:t("pi",{"pi-times-circle text-red-500 text-sm":!!i.password,"pi-check-circle text-green-500 text-sm":!i.password&&r>0})})," Şifre"]}),e.jsx(x,{id:"password",type:"password",autoComplete:"off",name:"password",tooltip:i==null?void 0:i.password,tooltipOptions:{position:"top"},disabled:c,onChange:p,value:m.password,className:t("w-full",{"p-invalid":!!i.password})})]}),e.jsxs("div",{className:"field mb-4 col-12 md:col-6 p-input-icon-right",children:[e.jsxs("label",{htmlFor:"password_confirmation",className:t("font-medium text-900",{"text-red-500":!!i.password_confirmation,"text-green-500":!i.password_confirmation&&r>0}),children:[e.jsx("i",{className:t("pi",{"pi-times-circle text-red-500 text-sm":!!i.password_confirmation,"pi-check-circle text-green-500 text-sm":!i.password_confirmation&&r>0})})," Şifre Tekrarı"]}),e.jsx(x,{id:"password_confirmation",type:"password",autoComplete:"off",name:"password_confirmation",tooltip:i==null?void 0:i.password_confirmation,tooltipOptions:{position:"top"},disabled:c,onChange:p,value:m.password_confirmation,className:t("w-full",{"p-invalid":!!i.password_confirmation})})]})]}),e.jsx("div",{className:"col-12",children:e.jsx(D,{label:"Kaydet",disabled:!O||!q,loading:c,size:"small",type:"submit",className:"w-auto mt-3"})})]})})})]})}),((N=s==null?void 0:s.user)==null?void 0:N.role)==="courier"&&z&&e.jsx(Q,{profilePage:!0,page:!1,profileCompleted:s==null?void 0:s.profile_completed,csrfToken:h,profileApproved:s==null?void 0:s.profile_approved})]})})};export{me as default};
