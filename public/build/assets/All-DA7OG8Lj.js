import{r as c,u as B,j as t,c as I,B as d,y as F,R as K,Y as V,a as U}from"./app-DHblIN05.js";import{P as Y,M as $}from"./PageContainer-DZjApNJ0.js";import{T as q,I as J}from"./toast.esm-CC_yrwr9.js";import Q from"./Show-C_9EF8Cy.js";import{C as W,D as X,a as Z,T as D}from"./checkbox.esm-BT6Sey2x.js";import{D as ee,M as N}from"./message.esm-Cy2t-3CF.js";import{O as k}from"./overlaypanel.esm-DUoQQBzd.js";import{s as te,g as _,d as re,a as ae,b as se,c as le,u as E}from"./orders-B-_wz1mn.js";import{T as w}from"./tag.esm-C9zwlhGp.js";import{T as ie}from"./tristatecheckbox.esm-GlLSwJNZ.js";import"./PersonalInformation-Bwaa7vNt.js";import"./inputmask.esm-Dctfdduk.js";import"./PersonalInformation-mZmVj2UJ.js";import"./styleclass.esm-BnefAR91.js";import"./avatar.esm-pB5SDBSj.js";import"./index.esm-dpZHoT5t.js";const Se=({auth:u,csrfToken:p,flash:m})=>{const[f,o]=c.useState(!0),[v,M]=c.useState([]);c.useState([]);const[i,S]=B(["name","phone","created_at","actions"],"BusinessesOrdersAllTableColumns"),[g,b]=c.useState(null),j=c.useRef(null),[R,L]=c.useState([]),[x,T]=c.useState({orderId:0,reason:""}),h=()=>{o(!0),se(p).then(e=>{e.status?(M(e.orders.map(r=>({...r,cancellation_accepted:r.cancellation_accepted===1}))),o(!1),b(null)):(b(e.message),o(!1))}).catch(e=>{b(e.message),o(!1)}).finally(()=>o(!1))};c.useEffect(()=>{var e,r,a;h(),m!=null&&m.message&&((e=l.current)==null||e.show({severity:(m==null?void 0:m.type)??"info",summary:m.title,detail:m.message??""})),(r=u==null?void 0:u.user)!=null&&r.id&&te((a=u==null?void 0:u.user)==null?void 0:a.id,s=>{s!=null&&s.reload&&h()})},[]);const z=(e,r)=>{U({target:e.currentTarget,message:"Siparişi silmek istediğinize emin misiniz?",acceptLabel:"Sil",acceptClassName:"p-button-danger",rejectLabel:"Vazgeç",accept(){o(!0),le(r,p).then(({status:a,message:s})=>{var n,y;a?(h(),(n=l.current)==null||n.show({severity:"success",summary:"Başarılı",detail:s})):(y=l.current)==null||y.show({severity:"error",summary:"Hata",detail:s})}).catch(a=>{var s;(s=l.current)==null||s.show({severity:"error",summary:"Hata",detail:a.message})}).finally(()=>o(!1))}})},A=e=>{o(!0),E(e,"opened",p).then(({status:r,message:a})=>{var s,n;r?(h(),(s=l.current)==null||s.show({severity:"success",summary:"Başarılı",detail:a})):(n=l.current)==null||n.show({severity:"error",summary:"Hata",detail:a})}).catch(r=>{var a;(a=l.current)==null||a.show({severity:"error",summary:"Hata",detail:r.message})}).finally(()=>o(!1))},G=(e,r)=>{o(!0),E(e,"canceled",p,r).then(({status:a,message:s})=>{var n,y,P;a?(h(),(n=l.current)==null||n.show({severity:"success",summary:"Başarılı",detail:s}),(y=j.current)==null||y.hide()):(P=l.current)==null||P.show({severity:"error",summary:"Hata",detail:s})}).catch(a=>{var s;(s=l.current)==null||s.show({severity:"error",summary:"Hata",detail:a.message})}).finally(()=>o(!1))};let C=[{expander:!0,style:{width:"3rem"}},{field:"customer.name",header:"Müşteri Adı Soyadı",hidden:!i.includes("customer.name"),sortable:!0,filter:!0,filterPlaceholder:"Ad'a Göre"},{field:"customer.phone",header:"Müşteri Telefon Numarası",hidden:!i.includes("customer.phone"),sortable:!0,filter:!0,filterPlaceholder:"Müşteri Telefon Numarası'na Göre"},{field:"customer_note",header:"Sipariş Notu",hidden:!i.includes("customer_note"),sortable:!0,filter:!0,filterPlaceholder:"Sipariş Notu'na Göre",body:e=>e.customer_note?t.jsx("span",{children:e.customer_note}):t.jsx("span",{children:t.jsx("i",{className:"pi pi-ban text-red-400"})})},{field:"price",header:"Paket Ücreti",hidden:!i.includes("price"),sortable:!0,filter:!0,filterPlaceholder:"Fiyata'a Göre",body:e=>t.jsxs("span",{children:[e.price," ₺"]})},{field:"status",header:"Sipariş Durumu",hidden:!i.includes("status"),sortable:!0,filter:!0,filterElement:e=>t.jsx(ee,{options:_("draft",!0),value:e.value,filter:!0,filterBy:"label,value",onChange:r=>e.filterApplyCallback(r.value),itemTemplate:r=>t.jsx(w,{value:r.label,severity:r.severity}),placeholder:"Sipariş Durumu",className:"p-column-filter w-full",showClear:!0}),body:e=>t.jsx(w,{value:String(_(e.status).label),severity:String(_(e.status).severity)})},{field:"courier_accepted_at",header:"Kurye Teslim Alma Tarihi",hidden:!i.includes("courier_accepted_at"),sortable:!0,filter:!0,filterPlaceholder:"Kurye Teslim Alma Tarihine Göre",filterType:"date",body:e=>e.courier_accepted_at?t.jsx("span",{children:new Date(e.courier_accepted_at).toLocaleString()}):t.jsxs("span",{children:[t.jsx("i",{className:"pi pi-ban text-red-400"})," Teslim Alınmadı"]})},{field:"delivered_at",header:"Teslim Tarihi",hidden:!i.includes("delivered_at"),sortable:!0,filter:!0,filterPlaceholder:"Teslim Tarihine Göre",filterType:"date",body:e=>e.delivered_at?t.jsx("span",{children:new Date(e.delivered_at).toLocaleString()}):t.jsxs("span",{children:[t.jsx("i",{className:"pi pi-ban text-red-400"})," Teslim Edilmedi"]})},{field:"cancellation_accepted",header:"İptal Onayı",hidden:!i.includes("cancellation_accepted"),sortable:!0,filter:!0,dataType:"boolean",filterElement:e=>t.jsx(ie,{value:e.value,onChange:r=>e.filterApplyCallback(r.value)}),body:e=>t.jsx("i",{className:I("pi",{"pi-check-circle text-green-400":e.cancellation_accepted,"pi-times-circle text-red-400":!e.cancellation_accepted})})},{field:"canceled_at",header:"İptal Tarihi",hidden:!i.includes("canceled_at"),sortable:!0,filter:!0,filterPlaceholder:"İptal Tarihine Göre",filterType:"date",body:e=>e.canceled_at?t.jsx("span",{children:new Date(e.canceled_at).toLocaleString()}):t.jsxs("span",{children:[t.jsx("i",{className:"pi pi-ban text-red-400"})," İptal Edilmedi"]})},{field:"created_at",header:"Eklenme Tarihi",hidden:!i.includes("created_at"),sortable:!0,filter:!0,filterPlaceholder:"Eklenme Tarihine Göre",filterType:"date",body:e=>t.jsx("span",{children:new Date(e.created_at).toLocaleString()})},{field:"updated_at",header:"Güncelleme Tarihi",hidden:!i.includes("updated_at"),sortable:!0,filter:!0,filterPlaceholder:"Güncellenme Tarihine Göre",filterType:"date",body:e=>t.jsx("span",{children:new Date(e.updated_at).toLocaleString()})},{field:"actions",header:"İşlemler",hidden:!i.includes("actions"),body:e=>t.jsxs("div",{className:"flex gap-2",children:[t.jsx(d,{icon:"pi pi-plus-circle",size:"small",tooltipOptions:{position:"top"},visible:e.status!=="canceled"&&e.status!=="deleted"&&e.status!=="delivered",onClick:()=>{o(!0),re(e.id,p).then(({status:r,message:a})=>{var s,n;r?((s=l.current)==null||s.show({severity:"success",summary:"Başarılı",detail:a}),h()):(n=l.current)==null||n.show({severity:"error",summary:"Hata",detail:a})}).catch(r=>{var a;(a=l.current)==null||a.show({severity:"error",summary:"Hata",detail:r.message})}).finally(()=>o(!1))},severity:"help",tooltip:"Konum Ekle (DEV FEATURE) Rastgele Kurye Ekler Sistemde Kurye Olmazsa Hata Verir"}),t.jsx(d,{icon:"pi pi-send",size:"small",tooltipOptions:{position:"top"},visible:e.status==="transporting",onClick:()=>{o(!0),ae(e.id,p).then(({status:r,message:a})=>{var s,n;r?((s=l.current)==null||s.show({severity:"success",summary:"Başarılı",detail:a}),h()):(n=l.current)==null||n.show({severity:"error",summary:"Hata",detail:a})}).catch(r=>{var a;(a=l.current)==null||a.show({severity:"error",summary:"Hata",detail:r.message})}).finally(()=>o(!1))},severity:"success",tooltip:"Teslimatı Tamamla (DEV FEATURE)"}),e.status==="draft"&&t.jsx(d,{size:"small",icon:"pi pi-check-circle",severity:"success",tooltip:"Yayınla",loading:f,tooltipOptions:{position:"top"},disabled:e.status!=="draft",onClick:()=>{A(e.id)}}),t.jsx(d,{size:"small",icon:"pi pi-eye",severity:"info",tooltip:"Görüntüle",loading:f,tooltipOptions:{position:"top"},onClick:()=>{F.visit(route("business.orders.show",e.id))}}),e.status==="draft"&&t.jsx(d,{size:"small",icon:"pi pi-trash",severity:"danger",tooltip:"Sil",tooltipOptions:{position:"top"},loading:f,onClick:r=>{z(r,e.id)}}),e.status!=="draft"&&e.status!=="deleted"&&e.status!=="canceled"&&t.jsx(d,{size:"small",icon:"pi pi-ban",severity:"danger",tooltip:"Siparişi İptal Et",tooltipOptions:{position:"top"},loading:f,onClick:r=>{var a;T({orderId:e.id,reason:""}),(a=j.current)==null||a.toggle(r)}})]})}];const O=c.useRef(null),H=()=>t.jsx(t.Fragment,{children:t.jsx(D,{end:t.jsxs(t.Fragment,{children:[t.jsx(d,{size:"small",icon:"pi pi-sync",severity:"help",className:"mr-2",tooltip:"Verileri Yenile",tooltipOptions:{position:"top"},onClick:()=>{h()}}),t.jsx(d,{size:"small",icon:"pi pi-bars",onClick:e=>{var r;(r=O.current)==null||r.toggle(e)}})]})})}),l=K.useRef(null);return t.jsx(Y,{auth:u,csrfToken:p,children:t.jsxs($,{children:[t.jsx(V,{title:"Siparişler"}),t.jsx(q,{ref:l}),t.jsxs(k,{ref:O,showCloseIcon:!0,style:{width:"300px"},children:[t.jsx("div",{className:"flex align-items-center justify-content-start mb-3",children:t.jsxs("span",{className:"text-900 text-lg font-bold",children:["Sütunlar (",i.length,")"]})}),t.jsx("div",{className:"flex flex-column justify-content-center gap-2",children:C.map((e,r)=>{if(e.selectionMode==="multiple"||(e==null?void 0:e.expander)!==void 0)return null;let a=e.header,s=e.field;return t.jsxs("div",{className:"flex align-items-center",children:[t.jsx(W,{inputId:`column${r}`,checked:i.includes(s),onChange:n=>{n.checked?S([...i,s]):S(i.filter(y=>y!==s))}}),t.jsx("label",{htmlFor:`column${r}`,className:"ml-2",children:a})]},r)})})]}),t.jsxs(k,{ref:j,showCloseIcon:!0,style:{width:"300px"},children:[t.jsx("h6",{children:"İptal Sebebinizi Belirterek Siparişi İptal Edebilirsiniz"}),t.jsx(J,{value:x.reason,onChange:e=>{T({...x,reason:e.target.value})},placeholder:"İptal Sebebi",className:"w-full mb-2"}),t.jsx(d,{label:"İptal Et",size:"small",className:"mt-2",severity:"danger",icon:"pi pi-ban",onClick:()=>{G(x.orderId,x.reason)}})]}),t.jsxs("div",{className:"card",children:[t.jsx("span",{className:"text-900 text-xl font-bold mb-4 block",children:"Siparişler"}),g!==null&&t.jsx(N,{className:"w-full",severity:"error",text:g}),!f&&v.length===0&&t.jsx(N,{className:"w-full",severity:"info",text:"Sipariş bulunamadı."}),t.jsx(X,{hidden:!f&&v.length===0||g!==null,loading:f,value:v,removableSort:!0,paginator:!0,filterDisplay:"row",paginatorTemplate:"RowsPerPageDropdown FirstPageLink PrevPageLink CurrentPageReport NextPageLink LastPageLink",rowsPerPageOptions:[5,10,25,50],rows:10,dataKey:"id",header:H,expandedRows:R,onRowToggle:e=>L(e==null?void 0:e.data),rowExpansionTemplate:e=>t.jsx(Q,{page:!1,order:e,orderId:e.id,csrfToken:p,auth:u}),filters:{"customer.name":{value:null,matchMode:"contains"},"customer.phone":{value:null,matchMode:"contains"},created_at:{value:null,matchMode:"contains"},updated_at:{value:null,matchMode:"contains"},status:{value:null,matchMode:"contains"},courier_accepted_at:{value:null,matchMode:"contains"},delivered_at:{value:null,matchMode:"contains"},canceled_at:{value:null,matchMode:"contains"},cancellation_reason:{value:null,matchMode:"contains"},price:{value:null,matchMode:"contains"},customer_note:{value:null,matchMode:"contains"},cancellation_accepted:{value:null,matchMode:"equals"}},emptyMessage:"Sipariş bulunamadı.",currentPageReportTemplate:"{first}. ile {last}. arası toplam {totalRecords} kayıttan",children:C.map((e,r)=>t.jsx(Z,{...e},r))})]})]})})};export{Se as default};
