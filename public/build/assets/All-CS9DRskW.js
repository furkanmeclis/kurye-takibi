import{r as o,u as I,j as t,B as p,R as H,Y as F,a as K}from"./app-D2z5Y5EK.js";import{P as Y,M as V}from"./PageContainer-CC8mNnV7.js";import{T as $,I as J}from"./toast.esm-B9aZY0UZ.js";import{O as C,C as q,D as Q,a as U,T as W}from"./checkbox.esm-BpGu7rwF.js";import{D as X,M as O}from"./message.esm-Cvx-6tOR.js";import{g as v,a as Z,d as D,u as w}from"./orders-TEM9zLaY.js";import{T as M}from"./tag.esm-uCaw0wNX.js";import"./PersonalInformation-t8ZOL2DK.js";import"./inputmask.esm-BEc1HNP7.js";import"./PersonalInformation-BtUvRPqn.js";import"./styleclass.esm-BX-6eKiv.js";import"./index.esm-BT7TWz4d.js";const me=({auth:k,csrfToken:h,flash:c})=>{const[m,i]=o.useState(!0),[y,E]=o.useState([]);o.useState([]);const[s,_]=I(["name","phone","created_at","actions"],"BusinessesOrdersAllTableColumns"),[g,j]=o.useState(null),b=o.useRef(null),[L,R]=o.useState([]),[x,S]=o.useState({orderId:0,reason:""}),f=()=>{i(!0),Z(h).then(e=>{e.status?(E(e.orders),i(!1),j(null)):(j(e.message),i(!1))}).catch(e=>{j(e.message),i(!1)}).finally(()=>i(!1))};o.useEffect(()=>{var e;f(),c!=null&&c.message&&((e=n.current)==null||e.show({severity:(c==null?void 0:c.type)??"info",summary:c.title,detail:c.message??""}))},[]);const z=(e,r)=>{K({target:e.currentTarget,message:"Siparişi silmek istediğinize emin misiniz?",acceptLabel:"Sil",acceptClassName:"p-button-danger",rejectLabel:"Vazgeç",accept(){i(!0),D(r,h).then(({status:a,message:l})=>{var d,u;a?(f(),(d=n.current)==null||d.show({severity:"success",summary:"Başarılı",detail:l})):(u=n.current)==null||u.show({severity:"error",summary:"Hata",detail:l})}).catch(a=>{var l;(l=n.current)==null||l.show({severity:"error",summary:"Hata",detail:a.message})}).finally(()=>i(!1))}})},G=e=>{i(!0),w(e,"opened",h).then(({status:r,message:a})=>{var l,d;r?(f(),(l=n.current)==null||l.show({severity:"success",summary:"Başarılı",detail:a})):(d=n.current)==null||d.show({severity:"error",summary:"Hata",detail:a})}).catch(r=>{var a;(a=n.current)==null||a.show({severity:"error",summary:"Hata",detail:r.message})}).finally(()=>i(!1))},A=(e,r)=>{i(!0),w(e,"canceled",h,r).then(({status:a,message:l})=>{var d,u,P;a?(f(),(d=n.current)==null||d.show({severity:"success",summary:"Başarılı",detail:l}),(u=b.current)==null||u.hide()):(P=n.current)==null||P.show({severity:"error",summary:"Hata",detail:l})}).catch(a=>{var l;(l=n.current)==null||l.show({severity:"error",summary:"Hata",detail:a.message})}).finally(()=>i(!1))};let T=[{expander:!0,style:{width:"3rem"}},{field:"customer.name",header:"Müşteri Adı Soyadı",hidden:!s.includes("customer.name"),sortable:!0,filter:!0,filterPlaceholder:"Ad'a Göre"},{field:"customer.phone",header:"Müşteri Telefon Numarası",hidden:!s.includes("customer.phone"),sortable:!0,filter:!0,filterPlaceholder:"Müşteri Telefon Numarası'na Göre"},{field:"customer_note",header:"Sipariş Notu",hidden:!s.includes("customer_note"),sortable:!0,filter:!0,filterPlaceholder:"Sipariş Notu'na Göre",body:e=>e.customer_note?t.jsx("span",{children:e.customer_note}):t.jsx("span",{children:t.jsx("i",{className:"pi pi-ban text-red-400"})})},{field:"status",header:"Sipariş Durumu",hidden:!s.includes("status"),sortable:!0,filter:!0,filterElement:e=>t.jsx(X,{options:v("draft",!0),value:e.value,filter:!0,filterBy:"label,value",onChange:r=>e.filterApplyCallback(r.value),itemTemplate:r=>t.jsx(M,{value:r.label,severity:r.severity}),placeholder:"Sipariş Durumu",className:"p-column-filter w-full",showClear:!0}),body:e=>t.jsx(M,{value:String(v(e.status).label),severity:String(v(e.status).severity)})},{field:"courier_accepted_at",header:"Kurye Teslim Alma Tarihi",hidden:!s.includes("courier_accepted_at"),sortable:!0,filter:!0,filterPlaceholder:"Kurye Teslim Alma Tarihine Göre",filterType:"date",body:e=>e.courier_accepted_at?t.jsx("span",{children:new Date(e.courier_accepted_at).toLocaleString()}):t.jsxs("span",{children:[t.jsx("i",{className:"pi pi-ban text-red-400"})," Teslim Alınmadı"]})},{field:"delivered_at",header:"Teslim Tarihi",hidden:!s.includes("delivered_at"),sortable:!0,filter:!0,filterPlaceholder:"Teslim Tarihine Göre",filterType:"date",body:e=>e.delivered_at?t.jsx("span",{children:new Date(e.delivered_at).toLocaleString()}):t.jsxs("span",{children:[t.jsx("i",{className:"pi pi-ban text-red-400"})," Teslim Edilmedi"]})},{field:"cancellation_reason",header:"İptal Nedeni",hidden:!s.includes("cancellation_reason"),sortable:!0,filter:!0,filterPlaceholder:"İptal Nedeni'ne Göre",body:e=>e.cancellation_reason?t.jsx("span",{children:e.cancellation_reason}):t.jsxs("span",{children:[t.jsx("i",{className:"pi pi-ban text-red-400"})," İptal Edilmedi"]})},{field:"canceled_at",header:"İptal Tarihi",hidden:!s.includes("canceled_at"),sortable:!0,filter:!0,filterPlaceholder:"İptal Tarihine Göre",filterType:"date",body:e=>e.canceled_at?t.jsx("span",{children:new Date(e.canceled_at).toLocaleString()}):t.jsxs("span",{children:[t.jsx("i",{className:"pi pi-ban text-red-400"})," İptal Edilmedi"]})},{field:"created_at",header:"Eklenme Tarihi",hidden:!s.includes("created_at"),sortable:!0,filter:!0,filterPlaceholder:"Eklenme Tarihine Göre",filterType:"date",body:e=>t.jsx("span",{children:new Date(e.created_at).toLocaleString()})},{field:"updated_at",header:"Güncelleme Tarihi",hidden:!s.includes("updated_at"),sortable:!0,filter:!0,filterPlaceholder:"Güncellenme Tarihine Göre",filterType:"date",body:e=>t.jsx("span",{children:new Date(e.updated_at).toLocaleString()})},{field:"actions",header:"İşlemler",hidden:!s.includes("actions"),body:e=>t.jsxs("div",{className:"flex gap-2",children:[e.status==="draft"&&t.jsx(p,{size:"small",icon:"pi pi-check-circle",severity:"success",tooltip:"Yayınla",loading:m,tooltipOptions:{position:"top"},disabled:e.status!=="draft",onClick:()=>{G(e.id)}}),e.status==="draft"&&t.jsx(p,{size:"small",icon:"pi pi-trash",severity:"danger",tooltip:"Sil",tooltipOptions:{position:"top"},loading:m,onClick:r=>{z(r,e.id)}}),e.status!=="draft"&&e.status!=="deleted"&&e.status!=="canceled"&&t.jsx(p,{size:"small",icon:"pi pi-ban",severity:"danger",tooltip:"Siparişi İptal Et",tooltipOptions:{position:"top"},loading:m,onClick:r=>{var a;S({orderId:e.id,reason:""}),(a=b.current)==null||a.toggle(r)}})]})}];const N=o.useRef(null),B=()=>t.jsx(t.Fragment,{children:t.jsx(W,{end:t.jsxs(t.Fragment,{children:[t.jsx(p,{size:"small",icon:"pi pi-sync",severity:"help",className:"mr-2",tooltip:"Verileri Yenile",tooltipOptions:{position:"top"},onClick:()=>{f()}}),t.jsx(p,{size:"small",icon:"pi pi-bars",onClick:e=>{var r;(r=N.current)==null||r.toggle(e)}})]})})}),n=H.useRef(null);return t.jsx(Y,{auth:k,csrfToken:h,children:t.jsxs(V,{children:[t.jsx(F,{title:"Siparişler"}),t.jsx($,{ref:n}),t.jsxs(C,{ref:N,showCloseIcon:!0,style:{width:"300px"},children:[t.jsx("div",{className:"flex align-items-center justify-content-start mb-3",children:t.jsxs("span",{className:"text-900 text-lg font-bold",children:["Sütunlar (",s.length,")"]})}),t.jsx("div",{className:"flex flex-column justify-content-center gap-2",children:T.map((e,r)=>{if(e.selectionMode==="multiple"||(e==null?void 0:e.expander)!==void 0)return null;let a=e.header,l=e.field;return t.jsxs("div",{className:"flex align-items-center",children:[t.jsx(q,{inputId:`column${r}`,checked:s.includes(l),onChange:d=>{d.checked?_([...s,l]):_(s.filter(u=>u!==l))}}),t.jsx("label",{htmlFor:`column${r}`,className:"ml-2",children:a})]},r)})})]}),t.jsxs(C,{ref:b,showCloseIcon:!0,style:{width:"300px"},children:[t.jsx("h6",{children:"İptal Sebebinizi Belirterek Siparişi İptal Edebilirsiniz"}),t.jsx(J,{value:x.reason,onChange:e=>{S({...x,reason:e.target.value})},placeholder:"İptal Sebebi",className:"w-full mb-2"}),t.jsx(p,{label:"İptal Et",size:"small",className:"mt-2",severity:"danger",icon:"pi pi-ban",onClick:()=>{A(x.orderId,x.reason)}})]}),t.jsxs("div",{className:"card",children:[t.jsx("span",{className:"text-900 text-xl font-bold mb-4 block",children:"Siparişler"}),g!==null&&t.jsx(O,{className:"w-full",severity:"error",text:g}),!m&&y.length===0&&t.jsx(O,{className:"w-full",severity:"info",text:"Sipariş bulunamadı."}),t.jsx(Q,{hidden:!m&&y.length===0||g!==null,loading:m,value:y,removableSort:!0,paginator:!0,filterDisplay:"row",paginatorTemplate:"RowsPerPageDropdown FirstPageLink PrevPageLink CurrentPageReport NextPageLink LastPageLink",rowsPerPageOptions:[5,10,25,50],rows:10,dataKey:"id",header:B,expandedRows:L,onRowToggle:e=>R(e==null?void 0:e.data),rowExpansionTemplate:e=>t.jsx("pre",{children:JSON.stringify(e,null,2)}),filters:{"customer.name":{value:null,matchMode:"contains"},"customer.phone":{value:null,matchMode:"contains"},created_at:{value:null,matchMode:"contains"},updated_at:{value:null,matchMode:"contains"},status:{value:null,matchMode:"contains"},courier_accepted_at:{value:null,matchMode:"contains"},delivered_at:{value:null,matchMode:"contains"},canceled_at:{value:null,matchMode:"contains"},cancellation_reason:{value:null,matchMode:"contains"},customer_note:{value:null,matchMode:"contains"}},emptyMessage:"Sipariş bulunamadı.",currentPageReportTemplate:"{first}. ile {last}. arası toplam {totalRecords} kayıttan",children:T.map((e,r)=>t.jsx(U,{...e},r))})]})]})})};export{me as default};
