import{r as o,L as $,j as e,T as K,B as w,b as Z}from"./app-D8E0bXJV.js";import{P as G,M as P}from"./PageContainer-CFnv4Fcw.js";import{e as S,f as H,h as W,i as q,j as F}from"./orders-BMQT8dfN.js";import{L as g,s as R,f as I,r as U,W as Y,M as k,c as T,d as z,P as A,A as a,T as J,b as B,e as Q}from"./ActiveOrder-vLbumx67.js";import{T as V}from"./toast.esm-C9nfYFuk.js";import{b as X,m as ee,c as se}from"./PersonalInformation-wTlgIpcN.js";import"./PersonalInformation-DMD9F6bw.js";import"./inputtext.esm-CmJ7BWA0.js";import"./inputmask.esm-CLw7DVsk.js";import"./message.esm-DUtwSKbY.js";import"./index.esm-v9QskdbU.js";import"./styleclass.esm-BeCxjdRT.js";import"./sidebar.esm-BYKGtC-V.js";const E=new g.Icon({iconUrl:R,iconSize:[32,32],iconAnchor:[12,41],popupAnchor:[1,-34],shadowSize:[41,41]}),L=new g.Icon({iconUrl:I,iconSize:[32,32],iconAnchor:[12,41],popupAnchor:[1,-34],shadowSize:[41,41]}),h=new g.Icon({iconUrl:U,iconSize:[16,16],iconAnchor:[12,41],popupAnchor:[1,-34],shadowSize:[41,41]}),ge=({page:d=!0,order:M={},orderId:m=0,csrfToken:u="",auth:C={}})=>{const c=o.useRef(null),[s,x]=o.useState({id:0,price:0,business_id:0,customer_id:0,courier_id:null,address_id:0,customer_note:"",status:"opened",courier:!1,start_location:{latitude:0,longitude:0},end_location:{latitude:0,longitude:0},cancellation_accepted:0,cancellation_accepted_by:null,cancellation_requested_by:null,cancellation_reason:null,marketplace:"web",marketplace_order_id:null,marketplace_order_details:null,marketplace_transactions:null,marketplace_customer:null,delivered_at:null,canceled_at:null,courier_accepted_at:null,created_at:"1970-01-01T00:00:00.000Z",updated_at:"1970-01-01T00:00:00.000Z",customer:{id:0,business_id:0,name:"",phone:"",note:null,created_at:"1970-01-01T00:00:00.000Z",updated_at:"1970-01-01T00:00:00.000Z"},address:{id:0,customer_id:0,phone:"",title:"",city:"",district:"",address:"",notes:"",created_at:"1970-01-01T00:00:00.000Z",updated_at:"1970-01-01T00:00:00.000Z"}}),[i,b]=o.useState([]),[f,y]=o.useState(!1),[le,j]=o.useState(!1),{setBreadcrumbs:D}=o.useContext($);o.useEffect(()=>{d&&D(l=>[...l,{labels:["Siparişler","Siparişi Görüntüle"],to:window.location.href}])},[]);const N=()=>{F(),y(!1)};o.useEffect(()=>{d?(j(!0),S(m,u).then(l=>{var t;if(l.status){let r=l.order;x(r)}else(t=c.current)==null||t.show({severity:"error",summary:"Hata",detail:l.message})}).catch(l=>{var t;console.log(l),(t=c.current)==null||t.show({severity:"error",summary:"Hata",detail:"Bir hata oluştu."})}).finally(()=>j(!1))):x(M)},[]),o.useEffect(()=>{if(s.id!==0&&d)return H(m,l=>{var t;(l==null?void 0:l.message)!==void 0&&((t=c.current)==null||t.show({severity:l.severity,summary:l.title,detail:l.message})),l!=null&&l.reload&&S(m,u).then(r=>{var n;r.status?x(r.order):(n=c.current)==null||n.show({severity:"error",summary:"Hata",detail:r.message})}).catch(r=>{var n;console.log(r),(n=c.current)==null||n.show({severity:"error",summary:"Hata",detail:"Bir hata oluştu."})})}),()=>N()},[s]),o.useEffect(()=>{if(s.courier!==!1&&s.courier!==null&&(W(m,u).then(l=>{var t;l.status?b(l.locations.map(r=>({latitude:r.latitude,longitude:r.longitude}))):(t=c.current)==null||t.show({severity:"error",summary:"Hata",detail:l.message})}).catch(l=>{var t;console.log(l),(t=c.current)==null||t.show({severity:"error",summary:"Hata",detail:"Bir hata oluştu."})}),s.status==="transporting"))return y(!0),q(m,l=>{b(t=>[...t,{latitude:l.latitude,longitude:l.longitude}])},!0),()=>N()},[s]);const O=l=>{let t=new Date(l.created_at),r=l.courier_accepted_at!==null?new Date(l.courier_accepted_at):null,n=l.delivered_at!==null?new Date(l.delivered_at):null,_=l.canceled_at!==null?new Date(l.canceled_at):null,p=[];return _!==null&&p.push({date:_,status:"Sipariş İptal Edildi",icon:"pi pi-times-circle",bg:"red-500"}),n!==null&&p.push({date:n,status:"Sipariş Teslim Edildi",icon:"pi pi-send",bg:"green-500"}),r!==null&&p.push({date:r,status:"Kurye Kabul Etti",icon:"pi pi-check-square",bg:"teal-500"}),p.push({date:t,status:"Sipariş Oluşturuldu",icon:"pi pi-file-import",bg:"yellow-500"}),p},v=()=>e.jsxs("div",{className:`grid ${!d&&"bg-primary-50 py-2 px-3"}`,children:[e.jsx("div",{className:"col-12 lg:col-9 md:col-8",children:e.jsxs("div",{className:`${!d&&"bg-primary-50 py-2 px-3"}`,children:[e.jsx(K,{target:"[data-pr-tooltip]",position:"bottom",className:"zoomin"}),e.jsxs("div",{className:"grid row-gap-2",children:[s.status==="transporting"&&s.courier!==!1&&s.courier!==null&&i.length>0&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"col-12",children:e.jsxs("span",{className:"text-xl font-semibold",children:["Kurye Konumu",s.status==="transporting"&&e.jsx(Y,{speed:"fast",connected:f,text:"Kurye Konumu İzleniyor"})]})}),e.jsx("div",{className:"col-12",children:s.status==="transporting"&&i.length>0&&e.jsxs(k,{center:[i[0].latitude,i[0].longitude],zoom:15,zoomControl:!0,attributionControl:!1,style:{height:"350px",borderRadius:"10px"},scrollWheelZoom:!1,children:[e.jsx(T,{url:"https://{s}.tile.openstreetmap.fr/hot/{z}/{x}/{y}.png"}),i.map((l,t)=>e.jsx(z,{position:[l.latitude,l.longitude],icon:t===0?E:t===i.length-1&&s.status==="delivered"?L:h,children:e.jsxs(A,{children:[e.jsx("span",{className:"font-semibold flex justify-content-center text-lg",children:t===0?"Başlangıç":t===i.length-1&&s.status==="delivered"?"Bitiş":"Güzergah-"+t}),e.jsx(w,{label:"Google Maps'te Aç",size:"small",icon:"pi pi-external-link",severity:"help",className:"w-full mt-2",onClick:()=>{window.open(`https://www.google.com/maps/search/?api=1&query=${l.latitude},${l.longitude}`,"_blank")}})]})},t))]})})]}),e.jsx("div",{className:"col-12",children:e.jsx("span",{className:"text-xl font-semibold",children:"Sipariş Detayları"})}),e.jsxs("div",{className:"lg:col-3 md:col-4 col-6 cursor-pointer","data-pr-tooltip":"Müşteri Adı Soyadı",children:[e.jsx(a,{icon:"pi pi-user",shape:"circle",className:"bg-primary-300 font-semibold text-primary-800"}),e.jsx(Z,{className:"font-semibold ml-2 text-color dark: text-decoration-none",href:route("business.customers.edit",s.customer.id),children:s.customer.name})]}),e.jsxs("div",{className:"lg:col-3 md:col-4 col-6 cursor-pointer","data-pr-tooltip":"Müşteri Telefon Numarası",children:[e.jsx(a,{icon:"pi pi-phone",shape:"circle",className:"bg-primary-300 font-semibold text-primary-800"}),e.jsx("a",{className:"font-semibold ml-2 text-color text-decoration-none",href:`tel:${s.customer.phone}`,children:s.customer.phone})]}),e.jsxs("div",{className:"lg:col-3 md:col-4 col-6 cursor-pointer","data-pr-tooltip":"Paket Ücreti",children:[e.jsx(a,{icon:"pi pi-turkish-lira",shape:"circle",className:"bg-primary-300 font-semibold text-primary-800"}),e.jsxs("span",{className:"font-semibold ml-2",children:[s.price," ₺"]})]}),e.jsxs("div",{className:"lg:col-3 md:col-4 col-6 cursor-pointer","data-pr-tooltip":"Sipariş Durumu",children:[e.jsx(a,{icon:"pi pi-check",shape:"circle",className:"bg-primary-300 font-semibold text-primary-800"}),e.jsx(J,{className:"ml-2",value:B(s.status).label,severity:B(s.status).severity})]}),s.status==="canceled"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"col-12",children:e.jsx("span",{className:"text-xl font-semibold",children:"İptal Bilgileri"})}),e.jsxs("div",{className:"lg:col-3 md:col-4 col-6 cursor-pointer","data-pr-tooltip":"İptal Edilme Sebebi",children:[e.jsx(a,{icon:"pi pi-file",shape:"circle",className:"bg-primary-300 font-semibold text-primary-800"}),e.jsx("span",{className:"font-semibold ml-2",children:s.cancellation_reason})]}),e.jsxs("div",{className:"lg:col-3 md:col-4 col-6 cursor-pointer","data-pr-tooltip":"İptal Edilme Sebebi",children:[e.jsx(a,{icon:`pi pi-${s.cancellation_accepted===1?"check":"times"}-circle`,shape:"circle",className:"bg-primary-300 font-semibold text-primary-800"}),e.jsx("span",{className:"font-semibold ml-2",children:s.cancellation_accepted===1?"İptal Onaylandı":"İptal İşlemi Onay Bekliyor"})]}),e.jsxs("div",{className:"lg:col-3 md:col-4 col-6 cursor-pointer","data-pr-tooltip":"İptal Edilme Tarihi",children:[e.jsx(a,{icon:"pi pi-clock",shape:"circle",className:"bg-primary-300 font-semibold text-primary-800"}),e.jsx("span",{className:"font-semibold ml-2",children:new Date(String(s.canceled_at)).toLocaleString()})]}),e.jsxs("div",{className:"lg:col-3 md:col-4 col-6 cursor-pointer","data-pr-tooltip":"Onaylayan Yetkili",children:[e.jsx(a,{icon:"pi pi-user",shape:"circle",className:"bg-primary-300 font-semibold text-primary-800"}),e.jsx("span",{className:"font-semibold ml-2",children:s.cancellation_accepted_by!==null?s.cancellation_accepted_by.name:"Onaylanmadı"})]})]}),e.jsx("div",{className:"col-12",children:e.jsx("span",{className:"text-xl font-semibold",children:"Adres Bilgileri"})}),e.jsxs("div",{className:"lg:col-3 md:col-4 col-6 cursor-pointer","data-pr-tooltip":"Adres Başlığı",children:[e.jsx(a,{icon:"pi pi-tag",shape:"circle",className:"bg-primary-300 font-semibold text-primary-800"}),e.jsx("span",{className:"font-semibold ml-2",children:s.address.title})]}),e.jsxs("div",{className:"lg:col-3 md:col-4 col-6 cursor-pointer","data-pr-tooltip":"Adres Telefon Numarası",children:[e.jsx(a,{icon:"pi pi-phone",shape:"circle",className:"bg-primary-300 font-semibold text-primary-800"}),e.jsx("a",{className:"font-semibold ml-2 text-color text-decoration-none",href:`tel:${s.address.phone}`,children:s.address.phone})]}),e.jsxs("div",{className:"lg:col-3 md:col-4 col-6 cursor-pointer","data-pr-tooltip":"İl/İlçe",children:[e.jsx(a,{icon:"pi pi-map",shape:"circle",className:"bg-primary-300 font-semibold text-primary-800"}),e.jsxs("span",{className:"font-semibold ml-2",children:[s.address.city," / ",s.address.district]})]}),e.jsxs("div",{className:"lg:col-6 md:col-6 col-12 cursor-pointer","data-pr-tooltip":"Adres",children:[e.jsx(a,{icon:"pi pi-home",shape:"circle",className:"bg-primary-300 font-semibold text-primary-800"}),e.jsx("span",{"data-pr-position":"bottom",className:"font-semibold ml-2",children:s.address.address})]}),s.address.notes!==null&&e.jsxs("div",{className:"lg:col-6 md:col-6 col-12 cursor-pointer","data-pr-tooltip":"Notlar",children:[e.jsx(a,{icon:"pi pi-info",shape:"circle",className:"bg-primary-300 font-semibold text-primary-800"}),e.jsx("span",{className:"font-semibold ml-2",children:s.address.notes})]}),s.courier!==!1&&s.courier!==null&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"col-12",children:e.jsx("span",{className:"text-xl font-semibold",children:"Kurye Bilgileri"})}),e.jsxs("div",{className:"lg:col-3 md:col-4 col-6 cursor-pointer","data-pr-tooltip":"Kurye Adı Soyadı",children:[e.jsx(a,{icon:"pi pi-user",shape:"circle",className:"bg-primary-300 font-semibold text-primary-800"}),e.jsx("span",{className:"font-semibold ml-2",children:s.courier.name})]}),e.jsxs("div",{className:"lg:col-3 md:col-4 col-6 cursor-pointer","data-pr-tooltip":"Kurye Telefon Numarası",children:[e.jsx(a,{icon:"pi pi-phone",shape:"circle",className:"bg-primary-300 font-semibold text-primary-800"}),e.jsx("a",{className:"font-semibold ml-2 text-color text-decoration-none",href:`tel:${s.courier.phone}`,children:s.courier.phone})]}),e.jsxs("div",{className:"lg:col-3 md:col-4 col-6 cursor-pointer","data-pr-tooltip":"Kurye Email Adresi",children:[e.jsx(a,{icon:"pi pi-envelope",shape:"circle",className:"bg-primary-300 font-semibold text-primary-800"}),e.jsx("a",{className:"font-semibold ml-2 text-color text-decoration-none",href:`mailto:${s.courier.email}`,children:s.courier.email})]}),e.jsxs("div",{className:"lg:col-3 md:col-4 col-6 cursor-pointer flex align-items-center","data-pr-tooltip":"Teslimat Tipi",children:[e.jsx(a,{image:s.courier.details.vehicle_type==="bicycle"?X:s.courier.details.vehicle_type==="motorcycle"?ee:se,className:"bg-primary-300 font-semibold text-primary-800 p-1"}),e.jsx("span",{className:"ml-2 font-semibold",children:s.courier.details.vehicle_type==="bicycle"?"Bisiklet":s.courier.details.vehicle_type==="motorcycle"?"Motosiklet":"Araba"})]}),e.jsxs("div",{className:"lg:col-3 md:col-4 col-6 cursor-pointer","data-pr-tooltip":"Siparişi Teslim Alma Tarihi",children:[e.jsx(a,{icon:"pi pi-clock",shape:"circle",className:"bg-primary-300 font-semibold text-primary-800"}),e.jsx("span",{className:"font-semibold ml-2",children:s.courier_accepted_at!==null?new Date(s.courier_accepted_at).toLocaleString():"-"})]}),s.delivered_at!==null&&e.jsxs("div",{className:"lg:col-3 md:col-4 col-6 cursor-pointer","data-pr-tooltip":"Siparişi Teslim Etme Tarihi",children:[e.jsx(a,{icon:"pi pi-stop-circle",shape:"circle",className:"bg-primary-300 font-semibold text-primary-800"}),e.jsx("span",{className:"font-semibold ml-2",children:new Date(s.delivered_at).toLocaleString()})]}),!f&&i.length>0&&e.jsx("div",{className:"col-12",children:e.jsxs(k,{center:[i[0].latitude,i[0].longitude],zoom:15,zoomControl:!0,attributionControl:!1,style:{height:"400px",borderRadius:"10px"},scrollWheelZoom:!1,children:[e.jsx(T,{url:"https://{s}.tile.openstreetmap.fr/hot/{z}/{x}/{y}.png"}),i.map((l,t)=>e.jsx(z,{position:[l.latitude,l.longitude],icon:t===0?E:t===i.length-1&&s.status==="delivered"?L:h,children:e.jsxs(A,{children:[e.jsx("span",{className:"font-semibold flex justify-content-center text-lg",children:t===0?"Başlangıç":t===i.length-1&&s.status==="delivered"?"Bitiş":"Güzergah-"+t}),e.jsx(w,{label:"Google Maps'te Aç",size:"small",icon:"pi pi-external-link",severity:"help",className:"w-full mt-2 zoomindown",onClick:()=>{window.open(`https://www.google.com/maps/search/?api=1&query=${l.latitude},${l.longitude}`,"_blank")}})]})},t))]})})]})]})]})}),e.jsx("div",{className:"col-12 lg:col-3 md:col-4",children:e.jsx(Q,{layout:"vertical",marker:l=>e.jsx("span",{className:`bg-${l.bg} flex w-2rem h-2rem align-items-center justify-content-center text-white border-circle z-1 shadow-1`,children:e.jsx("i",{className:l.icon})}),value:O(s),opposite:l=>l.status,content:l=>e.jsx("small",{className:"text-color-secondary",children:l.date.toLocaleString()})})})]});return e.jsxs(e.Fragment,{children:[e.jsx(V,{ref:c}),d?e.jsx(G,{auth:C,csrfToken:u,children:e.jsx(P,{children:e.jsx("div",{className:"card",children:e.jsx(v,{})})})}):e.jsx(v,{})]})};export{ge as default};
