import{r,L as $,j as e,T as K,B as w,b as O}from"./app-DfiApva1.js";import{P as Z,M as G}from"./PageContainer-CItWAE-M.js";import{b as P,c as I,e as W}from"./orders-BQDg4cK4.js";import{b as S}from"./globalHelper-B-s3UrsJ.js";import{T as q}from"./toast.esm-BUIr6eRr.js";import{L as h,s as F,f as H,r as R,W as U,M as k,b as T,c as z,P as A,A as t,T as Y,d as J}from"./ActiveOrder-BV8Zpnbj.js";import{b as Q,m as V,c as X}from"./PersonalInformation-C0LAfeiM.js";import"./PersonalInformation-D6nBh7q9.js";import"./inputtext.esm-BJSyEN0I.js";import"./inputmask.esm-D7RyYABS.js";import"./message.esm-DXuI6qyr.js";import"./index.esm-CF5HdvGh.js";import"./styleclass.esm-BYWQmj5w.js";import"./sidebar.esm-DYHP3OPq.js";const L=new h.Icon({iconUrl:F,iconSize:[32,32],iconAnchor:[12,41],popupAnchor:[1,-34],shadowSize:[41,41]}),B=new h.Icon({iconUrl:H,iconSize:[32,32],iconAnchor:[12,41],popupAnchor:[1,-34],shadowSize:[41,41]}),m=new h.Icon({iconUrl:R,iconSize:[16,16],iconAnchor:[12,41],popupAnchor:[1,-34],shadowSize:[41,41]}),xe=({page:c=!0,order:M={},orderId:p=0,csrfToken:u="",auth:E={}})=>{const n=r.useRef(null),[s,x]=r.useState({id:0,price:0,business_id:0,customer_id:0,courier_id:null,address_id:0,customer_note:"",status:"opened",courier:!1,start_location:{latitude:0,longitude:0},end_location:{latitude:0,longitude:0},cancellation_accepted:0,cancellation_accepted_by:null,cancellation_requested_by:null,cancellation_reason:null,marketplace:"web",marketplace_order_id:null,marketplace_order_details:null,marketplace_transactions:null,marketplace_customer:null,delivered_at:null,canceled_at:null,courier_accepted_at:null,created_at:"1970-01-01T00:00:00.000Z",updated_at:"1970-01-01T00:00:00.000Z",customer:{id:0,business_id:0,name:"",phone:"",note:null,created_at:"1970-01-01T00:00:00.000Z",updated_at:"1970-01-01T00:00:00.000Z"},address:{id:0,customer_id:0,phone:"",title:"",city:"",district:"",address:"",notes:"",created_at:"1970-01-01T00:00:00.000Z",updated_at:"1970-01-01T00:00:00.000Z"}}),[i,g]=r.useState([]),[b,f]=r.useState(!1),[ee,j]=r.useState(!1),{setBreadcrumbs:C}=r.useContext($);r.useEffect(()=>{c&&C(l=>[...l,{labels:["Siparişler","Siparişi Görüntüle"],to:window.location.href}])},[]);const y=()=>{f(!1)};r.useEffect(()=>{c?(j(!0),P(p,u).then(l=>{var a;if(l.status){let o=l.order;x(o)}else(a=n.current)==null||a.show({severity:"error",summary:"Hata",detail:l.message})}).catch(l=>{var a;console.log(l),(a=n.current)==null||a.show({severity:"error",summary:"Hata",detail:"Bir hata oluştu."})}).finally(()=>j(!1))):x(M)},[]),r.useEffect(()=>{if(s.id!==0&&c)return()=>y()},[s]),r.useEffect(()=>{if(s.courier!==!1&&s.courier!==null&&(I(p,u).then(l=>{var a;l.status?g(l.locations.map(o=>({latitude:o.latitude,longitude:o.longitude}))):(a=n.current)==null||a.show({severity:"error",summary:"Hata",detail:l.message})}).catch(l=>{var a;console.log(l),(a=n.current)==null||a.show({severity:"error",summary:"Hata",detail:"Bir hata oluştu."})}),s.status==="transporting"))return f(!0),W(p,l=>{g(a=>[...a,{latitude:l.latitude,longitude:l.longitude}])},!0),()=>y()},[s]);const D=l=>{let a=new Date(l.created_at),o=l.courier_accepted_at!==null?new Date(l.courier_accepted_at):null,_=l.delivered_at!==null?new Date(l.delivered_at):null,v=l.canceled_at!==null?new Date(l.canceled_at):null,d=[];return v!==null&&d.push({date:v,status:"Sipariş İptal Edildi",icon:"pi pi-times-circle",bg:"red-500"}),_!==null&&d.push({date:_,status:"Sipariş Teslim Edildi",icon:"pi pi-send",bg:"green-500"}),o!==null&&d.push({date:o,status:"Kurye Kabul Etti",icon:"pi pi-check-square",bg:"teal-500"}),d.push({date:a,status:"Sipariş Oluşturuldu",icon:"pi pi-file-import",bg:"yellow-500"}),d},N=()=>e.jsxs("div",{className:`grid ${!c&&"bg-primary-50 py-2 px-3"}`,children:[e.jsx("div",{className:"col-12 lg:col-9 md:col-8",children:e.jsxs("div",{className:`${!c&&"bg-primary-50 py-2 px-3"}`,children:[e.jsx(K,{target:"[data-pr-tooltip]",position:"bottom",className:"zoomin"}),e.jsxs("div",{className:"grid row-gap-2",children:[s.status==="transporting"&&s.courier!==!1&&s.courier!==null&&i.length>0&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"col-12",children:e.jsxs("span",{className:"text-xl font-semibold",children:["Kurye Konumu",s.status==="transporting"&&e.jsx(U,{speed:"fast",connected:b,text:"Kurye Konumu İzleniyor"})]})}),e.jsx("div",{className:"col-12",children:s.status==="transporting"&&i.length>0&&e.jsxs(k,{center:[i[0].latitude,i[0].longitude],zoom:15,zoomControl:!0,attributionControl:!1,style:{height:"350px",borderRadius:"10px"},scrollWheelZoom:!1,children:[e.jsx(T,{url:"https://{s}.tile.openstreetmap.fr/hot/{z}/{x}/{y}.png"}),i.map((l,a)=>e.jsx(z,{position:[l.latitude,l.longitude],icon:a===0?L:a===i.length-1&&s.status==="delivered"?B:m,children:e.jsxs(A,{children:[e.jsx("span",{className:"font-semibold flex justify-content-center text-lg",children:a===0?"Başlangıç":a===i.length-1&&s.status==="delivered"?"Bitiş":"Güzergah-"+a}),e.jsx(w,{label:"Google Maps'te Aç",size:"small",icon:"pi pi-external-link",severity:"help",className:"w-full mt-2",onClick:()=>{window.open(`https://www.google.com/maps/search/?api=1&query=${l.latitude},${l.longitude}`,"_blank")}})]})},a))]})})]}),e.jsx("div",{className:"col-12",children:e.jsx("span",{className:"text-xl font-semibold",children:"Sipariş Detayları"})}),e.jsxs("div",{className:"lg:col-3 md:col-4 col-6 cursor-pointer","data-pr-tooltip":"Müşteri Adı Soyadı",children:[e.jsx(t,{icon:"pi pi-user",shape:"circle",className:"bg-primary-300 font-semibold text-primary-800"}),e.jsx(O,{className:"font-semibold ml-2 text-color dark: text-decoration-none",href:route("business.customers.edit",s.customer.id),children:s.customer.name})]}),e.jsxs("div",{className:"lg:col-3 md:col-4 col-6 cursor-pointer","data-pr-tooltip":"Müşteri Telefon Numarası",children:[e.jsx(t,{icon:"pi pi-phone",shape:"circle",className:"bg-primary-300 font-semibold text-primary-800"}),e.jsx("a",{className:"font-semibold ml-2 text-color text-decoration-none",href:`tel:${s.customer.phone}`,children:s.customer.phone})]}),e.jsxs("div",{className:"lg:col-3 md:col-4 col-6 cursor-pointer","data-pr-tooltip":"Paket Ücreti",children:[e.jsx(t,{icon:"pi pi-turkish-lira",shape:"circle",className:"bg-primary-300 font-semibold text-primary-800"}),e.jsxs("span",{className:"font-semibold ml-2",children:[s.price," ₺"]})]}),e.jsxs("div",{className:"lg:col-3 md:col-4 col-6 cursor-pointer","data-pr-tooltip":"Sipariş Durumu",children:[e.jsx(t,{icon:"pi pi-check",shape:"circle",className:"bg-primary-300 font-semibold text-primary-800"}),e.jsx(Y,{className:"ml-2",value:S(s.status).label,severity:S(s.status).severity})]}),s.status==="canceled"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"col-12",children:e.jsx("span",{className:"text-xl font-semibold",children:"İptal Bilgileri"})}),e.jsxs("div",{className:"lg:col-3 md:col-4 col-6 cursor-pointer","data-pr-tooltip":"İptal Edilme Sebebi",children:[e.jsx(t,{icon:"pi pi-file",shape:"circle",className:"bg-primary-300 font-semibold text-primary-800"}),e.jsx("span",{className:"font-semibold ml-2",children:s.cancellation_reason})]}),e.jsxs("div",{className:"lg:col-3 md:col-4 col-6 cursor-pointer","data-pr-tooltip":"İptal Edilme Sebebi",children:[e.jsx(t,{icon:`pi pi-${s.cancellation_accepted===1?"check":"times"}-circle`,shape:"circle",className:"bg-primary-300 font-semibold text-primary-800"}),e.jsx("span",{className:"font-semibold ml-2",children:s.cancellation_accepted===1?"İptal Onaylandı":"İptal İşlemi Onay Bekliyor"})]}),e.jsxs("div",{className:"lg:col-3 md:col-4 col-6 cursor-pointer","data-pr-tooltip":"İptal Edilme Tarihi",children:[e.jsx(t,{icon:"pi pi-clock",shape:"circle",className:"bg-primary-300 font-semibold text-primary-800"}),e.jsx("span",{className:"font-semibold ml-2",children:new Date(String(s.canceled_at)).toLocaleString()})]}),e.jsxs("div",{className:"lg:col-3 md:col-4 col-6 cursor-pointer","data-pr-tooltip":"Onaylayan Yetkili",children:[e.jsx(t,{icon:"pi pi-user",shape:"circle",className:"bg-primary-300 font-semibold text-primary-800"}),e.jsx("span",{className:"font-semibold ml-2",children:s.cancellation_accepted_by!==null?s.cancellation_accepted_by.name:"Onaylanmadı"})]})]}),e.jsx("div",{className:"col-12",children:e.jsx("span",{className:"text-xl font-semibold",children:"Adres Bilgileri"})}),e.jsxs("div",{className:"lg:col-3 md:col-4 col-6 cursor-pointer","data-pr-tooltip":"Adres Başlığı",children:[e.jsx(t,{icon:"pi pi-tag",shape:"circle",className:"bg-primary-300 font-semibold text-primary-800"}),e.jsx("span",{className:"font-semibold ml-2",children:s.address.title})]}),e.jsxs("div",{className:"lg:col-3 md:col-4 col-6 cursor-pointer","data-pr-tooltip":"Adres Telefon Numarası",children:[e.jsx(t,{icon:"pi pi-phone",shape:"circle",className:"bg-primary-300 font-semibold text-primary-800"}),e.jsx("a",{className:"font-semibold ml-2 text-color text-decoration-none",href:`tel:${s.address.phone}`,children:s.address.phone})]}),e.jsxs("div",{className:"lg:col-3 md:col-4 col-6 cursor-pointer","data-pr-tooltip":"İl/İlçe",children:[e.jsx(t,{icon:"pi pi-map",shape:"circle",className:"bg-primary-300 font-semibold text-primary-800"}),e.jsxs("span",{className:"font-semibold ml-2",children:[s.address.city," / ",s.address.district]})]}),e.jsxs("div",{className:"lg:col-6 md:col-6 col-12 cursor-pointer","data-pr-tooltip":"Adres",children:[e.jsx(t,{icon:"pi pi-home",shape:"circle",className:"bg-primary-300 font-semibold text-primary-800"}),e.jsx("span",{"data-pr-position":"bottom",className:"font-semibold ml-2",children:s.address.address})]}),s.address.notes!==null&&e.jsxs("div",{className:"lg:col-6 md:col-6 col-12 cursor-pointer","data-pr-tooltip":"Notlar",children:[e.jsx(t,{icon:"pi pi-info",shape:"circle",className:"bg-primary-300 font-semibold text-primary-800"}),e.jsx("span",{className:"font-semibold ml-2",children:s.address.notes})]}),s.courier!==!1&&s.courier!==null&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"col-12",children:e.jsx("span",{className:"text-xl font-semibold",children:"Kurye Bilgileri"})}),e.jsxs("div",{className:"lg:col-3 md:col-4 col-6 cursor-pointer","data-pr-tooltip":"Kurye Adı Soyadı",children:[e.jsx(t,{icon:"pi pi-user",shape:"circle",className:"bg-primary-300 font-semibold text-primary-800"}),e.jsx("span",{className:"font-semibold ml-2",children:s.courier.name})]}),e.jsxs("div",{className:"lg:col-3 md:col-4 col-6 cursor-pointer","data-pr-tooltip":"Kurye Telefon Numarası",children:[e.jsx(t,{icon:"pi pi-phone",shape:"circle",className:"bg-primary-300 font-semibold text-primary-800"}),e.jsx("a",{className:"font-semibold ml-2 text-color text-decoration-none",href:`tel:${s.courier.phone}`,children:s.courier.phone})]}),e.jsxs("div",{className:"lg:col-3 md:col-4 col-6 cursor-pointer","data-pr-tooltip":"Kurye Email Adresi",children:[e.jsx(t,{icon:"pi pi-envelope",shape:"circle",className:"bg-primary-300 font-semibold text-primary-800"}),e.jsx("a",{className:"font-semibold ml-2 text-color text-decoration-none",href:`mailto:${s.courier.email}`,children:s.courier.email})]}),e.jsxs("div",{className:"lg:col-3 md:col-4 col-6 cursor-pointer flex align-items-center","data-pr-tooltip":"Teslimat Tipi",children:[e.jsx(t,{image:s.courier.details.vehicle_type==="bicycle"?Q:s.courier.details.vehicle_type==="motorcycle"?V:X,className:"bg-primary-300 font-semibold text-primary-800 p-1"}),e.jsx("span",{className:"ml-2 font-semibold",children:s.courier.details.vehicle_type==="bicycle"?"Bisiklet":s.courier.details.vehicle_type==="motorcycle"?"Motosiklet":"Araba"})]}),e.jsxs("div",{className:"lg:col-3 md:col-4 col-6 cursor-pointer","data-pr-tooltip":"Siparişi Teslim Alma Tarihi",children:[e.jsx(t,{icon:"pi pi-clock",shape:"circle",className:"bg-primary-300 font-semibold text-primary-800"}),e.jsx("span",{className:"font-semibold ml-2",children:s.courier_accepted_at!==null?new Date(s.courier_accepted_at).toLocaleString():"-"})]}),s.delivered_at!==null&&e.jsxs("div",{className:"lg:col-3 md:col-4 col-6 cursor-pointer","data-pr-tooltip":"Siparişi Teslim Etme Tarihi",children:[e.jsx(t,{icon:"pi pi-stop-circle",shape:"circle",className:"bg-primary-300 font-semibold text-primary-800"}),e.jsx("span",{className:"font-semibold ml-2",children:new Date(s.delivered_at).toLocaleString()})]}),!b&&i.length>0&&e.jsx("div",{className:"col-12",children:e.jsxs(k,{center:[i[0].latitude,i[0].longitude],zoom:15,zoomControl:!0,attributionControl:!1,style:{height:"400px",borderRadius:"10px"},scrollWheelZoom:!1,children:[e.jsx(T,{url:"https://{s}.tile.openstreetmap.fr/hot/{z}/{x}/{y}.png"}),i.map((l,a)=>e.jsx(z,{position:[l.latitude,l.longitude],icon:a===0?L:a===i.length-1&&s.status==="delivered"?B:m,children:e.jsxs(A,{children:[e.jsx("span",{className:"font-semibold flex justify-content-center text-lg",children:a===0?"Başlangıç":a===i.length-1&&s.status==="delivered"?"Bitiş":"Güzergah-"+a}),e.jsx(w,{label:"Google Maps'te Aç",size:"small",icon:"pi pi-external-link",severity:"help",className:"w-full mt-2 zoomindown",onClick:()=>{window.open(`https://www.google.com/maps/search/?api=1&query=${l.latitude},${l.longitude}`,"_blank")}})]})},a))]})})]})]})]})}),e.jsx("div",{className:"col-12 lg:col-3 md:col-4",children:e.jsx(J,{layout:"vertical",marker:l=>e.jsx("span",{className:`bg-${l.bg} flex w-2rem h-2rem align-items-center justify-content-center text-white border-circle z-1 shadow-1`,children:e.jsx("i",{className:l.icon})}),value:D(s),opposite:l=>l.status,content:l=>e.jsx("small",{className:"text-color-secondary",children:l.date.toLocaleString()})})})]});return e.jsxs(e.Fragment,{children:[e.jsx(q,{ref:n}),c?e.jsx(Z,{auth:E,csrfToken:u,children:e.jsx(G,{children:e.jsx("div",{className:"card",children:e.jsx(N,{})})})}):e.jsx(N,{})]})};export{xe as default};
