import{r as o,L as Z,j as e,T as G,B as w,b as P}from"./app-Dbk8n-uA.js";import{P as H,M as I}from"./PageContainer-YNtSeWPm.js";import{b as S,c as U,e as W,f as q,h as F}from"./orders-DE8j8wTZ.js";import{b as k}from"./globalHelper-DC93hlCg.js";import{T as R}from"./toast.esm-sRjLTCIT.js";import{L as m,s as Y,f as J,r as Q,W as V,M as z,a as A,b as T,P as M,A as t,T as X,c as ee}from"./ActiveOrder-CeIhvmYC.js";import{b as E,m as L,c as C}from"./PersonalInformation-CqC-Xqpm.js";import"./PersonalInformation-DEFbDOaG.js";import"./inputtext.esm-EYuhZLNa.js";import"./inputmask.esm-C7qk58Dg.js";import"./message.esm-BokLF7E4.js";import"./index.esm-Bslw2tBS.js";import"./styleclass.esm-B7AWbbFe.js";import"./sidebar.esm-BTFoFMI-.js";const B=new m.Icon({iconUrl:Y,iconSize:[32,32],iconAnchor:[12,41],popupAnchor:[1,-34],shadowSize:[41,41]}),se=new m.Icon({iconUrl:J,iconSize:[32,32],iconAnchor:[12,41],popupAnchor:[1,-34],shadowSize:[41,41]}),g=new m.Icon({iconUrl:Q,iconSize:[16,16],iconAnchor:[12,41],popupAnchor:[1,-34],shadowSize:[41,41]}),le=new m.Icon({iconUrl:E,iconSize:[32,32],iconAnchor:[12,41],popupAnchor:[1,-34],shadowSize:[41,41]}),ae=new m.Icon({iconUrl:L,iconSize:[32,32],iconAnchor:[12,41],popupAnchor:[1,-34],shadowSize:[41,41]}),te=new m.Icon({iconUrl:C,iconSize:[32,32],iconAnchor:[12,41],popupAnchor:[1,-34],shadowSize:[41,41]}),je=({page:d=!0,order:D={},orderId:p=0,csrfToken:h="",auth:O={}})=>{const c=o.useRef(null),[s,x]=o.useState({id:0,price:0,business_id:0,customer_id:0,courier_id:null,address_id:0,customer_note:"",status:"opened",courier:!1,start_location:{latitude:0,longitude:0},end_location:{latitude:0,longitude:0},cancellation_accepted:0,cancellation_accepted_by:null,cancellation_requested_by:null,cancellation_reason:null,marketplace:"web",marketplace_order_id:null,marketplace_order_details:null,marketplace_transactions:null,marketplace_customer:null,delivered_at:null,canceled_at:null,courier_accepted_at:null,created_at:"1970-01-01T00:00:00.000Z",updated_at:"1970-01-01T00:00:00.000Z",customer:{id:0,business_id:0,name:"",phone:"",note:null,created_at:"1970-01-01T00:00:00.000Z",updated_at:"1970-01-01T00:00:00.000Z"},address:{id:0,customer_id:0,phone:"",title:"",city:"",district:"",address:"",notes:"",created_at:"1970-01-01T00:00:00.000Z",updated_at:"1970-01-01T00:00:00.000Z"}}),[i,b]=o.useState([]),[y,f]=o.useState(!1),[ie,j]=o.useState(!1),{setBreadcrumbs:$}=o.useContext(Z);o.useEffect(()=>{d&&$(l=>[...l,{labels:["Siparişler","Siparişi Görüntüle"],to:window.location.href}])},[]);const N=()=>{F(),f(!1)};o.useEffect(()=>{d?(j(!0),S(p,h).then(l=>{var a;if(l.status){let r=l.order;x(r)}else(a=c.current)==null||a.show({severity:"error",summary:"Hata",detail:l.message})}).catch(l=>{var a;console.log(l),(a=c.current)==null||a.show({severity:"error",summary:"Hata",detail:"Bir hata oluştu."})}).finally(()=>j(!1))):x(D)},[]),o.useEffect(()=>{if(s.id!==0&&d)return U(p,l=>{var a;(l==null?void 0:l.message)!==void 0&&((a=c.current)==null||a.show({severity:l.severity,summary:l.title,detail:l.message})),l!=null&&l.reload&&S(p,h).then(r=>{var n;r.status?x(r.order):(n=c.current)==null||n.show({severity:"error",summary:"Hata",detail:r.message})}).catch(r=>{var n;console.log(r),(n=c.current)==null||n.show({severity:"error",summary:"Hata",detail:"Bir hata oluştu."})})}),()=>N()},[s]),o.useEffect(()=>{if(s.courier!==!1&&s.courier!==null&&(W(p,h).then(l=>{var a;l.status?b(l.locations.map(r=>({latitude:r.latitude,longitude:r.longitude}))):(a=c.current)==null||a.show({severity:"error",summary:"Hata",detail:l.message})}).catch(l=>{var a;console.log(l),(a=c.current)==null||a.show({severity:"error",summary:"Hata",detail:"Bir hata oluştu."})}),s.status==="transporting"))return f(!0),q(p,l=>{b(a=>[...a,{latitude:l.latitude,longitude:l.longitude}])},!0),()=>N()},[s]);const K=l=>{let a=new Date(l.created_at),r=l.courier_accepted_at!==null?new Date(l.courier_accepted_at):null,n=l.delivered_at!==null?new Date(l.delivered_at):null,v=l.canceled_at!==null?new Date(l.canceled_at):null,u=[];return v!==null&&u.push({date:v,status:"Sipariş İptal Edildi",icon:"pi pi-times-circle",bg:"red-500"}),n!==null&&u.push({date:n,status:"Sipariş Teslim Edildi",icon:"pi pi-send",bg:"green-500"}),r!==null&&u.push({date:r,status:"Kurye Kabul Etti",icon:"pi pi-check-square",bg:"teal-500"}),u.push({date:a,status:"Sipariş Oluşturuldu",icon:"pi pi-file-import",bg:"yellow-500"}),u},_=()=>e.jsxs("div",{className:`grid ${!d&&"bg-primary-50 py-2 px-3"}`,children:[e.jsx("div",{className:"col-12 lg:col-9 md:col-8",children:e.jsxs("div",{className:`${!d&&"bg-primary-50 py-2 px-3"}`,children:[e.jsx(G,{target:"[data-pr-tooltip]",position:"bottom",className:"zoomin"}),e.jsxs("div",{className:"grid row-gap-2",children:[s.status==="transporting"&&s.courier!==!1&&s.courier!==null&&i.length>0&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"col-12",children:e.jsxs("span",{className:"text-xl font-semibold",children:["Kurye Konumu",s.status==="transporting"&&e.jsx(V,{speed:"fast",connected:y,text:"Kurye Konumu İzleniyor"})]})}),e.jsx("div",{className:"col-12",children:s.status==="transporting"&&i.length>0&&e.jsxs(z,{center:[i[0].latitude,i[0].longitude],zoom:15,zoomControl:!0,attributionControl:!1,style:{height:"350px",borderRadius:"10px"},scrollWheelZoom:!1,children:[e.jsx(A,{url:"https://{s}.tile.openstreetmap.fr/hot/{z}/{x}/{y}.png"}),i.map((l,a)=>e.jsx(T,{position:[l.latitude,l.longitude],icon:a===0?B:a===i.length-1?s.courier.details.vehicle_type==="bicycle"?le:s.courier.details.vehicle_type==="motorcycle"?ae:te:g,children:e.jsxs(M,{children:[e.jsx("span",{className:"font-semibold flex justify-content-center text-lg",children:a===0?"Başlangıç":a===i.length-1&&s.status==="delivered"?"Bitiş":"Güzergah-"+a}),e.jsx(w,{label:"Google Maps'te Aç",size:"small",icon:"pi pi-external-link",severity:"help",className:"w-full mt-2",onClick:()=>{window.open(`https://www.google.com/maps/search/?api=1&query=${l.latitude},${l.longitude}`,"_blank")}})]})},a))]})})]}),e.jsx("div",{className:"col-12",children:e.jsx("span",{className:"text-xl font-semibold",children:"Sipariş Detayları"})}),e.jsxs("div",{className:"lg:col-3 md:col-4 col-6 cursor-pointer","data-pr-tooltip":"Müşteri Adı Soyadı",children:[e.jsx(t,{icon:"pi pi-user",shape:"circle",className:"bg-primary-300 font-semibold text-primary-800"}),e.jsx(P,{className:"font-semibold ml-2 text-color dark: text-decoration-none",href:route("business.customers.edit",s.customer.id),children:s.customer.name})]}),e.jsxs("div",{className:"lg:col-3 md:col-4 col-6 cursor-pointer","data-pr-tooltip":"Müşteri Telefon Numarası",children:[e.jsx(t,{icon:"pi pi-phone",shape:"circle",className:"bg-primary-300 font-semibold text-primary-800"}),e.jsx("a",{className:"font-semibold ml-2 text-color text-decoration-none",href:`tel:${s.customer.phone}`,children:s.customer.phone})]}),e.jsxs("div",{className:"lg:col-3 md:col-4 col-6 cursor-pointer","data-pr-tooltip":"Paket Ücreti",children:[e.jsx(t,{icon:"pi pi-turkish-lira",shape:"circle",className:"bg-primary-300 font-semibold text-primary-800"}),e.jsxs("span",{className:"font-semibold ml-2",children:[s.price," ₺"]})]}),e.jsxs("div",{className:"lg:col-3 md:col-4 col-6 cursor-pointer","data-pr-tooltip":"Sipariş Durumu",children:[e.jsx(t,{icon:"pi pi-check",shape:"circle",className:"bg-primary-300 font-semibold text-primary-800"}),e.jsx(X,{className:"ml-2",value:k(s.status,!1,s.cancellation_accepted===1,s.cancellation_rejected===1).label,severity:k(s.status,!1,s.cancellation_accepted===1,s.cancellation_rejected===1).severity})]}),s.status==="canceled"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"col-12",children:e.jsx("span",{className:"text-xl font-semibold",children:"İptal Bilgileri"})}),e.jsxs("div",{className:"lg:col-3 md:col-4 col-6 cursor-pointer","data-pr-tooltip":"İptal Edilme Sebebi",children:[e.jsx(t,{icon:"pi pi-file",shape:"circle",className:"bg-primary-300 font-semibold text-primary-800"}),e.jsx("span",{className:"font-semibold ml-2",children:s.cancellation_reason})]}),e.jsxs("div",{className:"lg:col-3 md:col-4 col-6 cursor-pointer","data-pr-tooltip":"İptal Edilme Sebebi",children:[e.jsx(t,{icon:`pi pi-${s.cancellation_accepted===1?"check":"times"}-circle`,shape:"circle",className:"bg-primary-300 font-semibold text-primary-800"}),e.jsx("span",{className:"font-semibold ml-2",children:s.cancellation_accepted===1?"İptal Onaylandı":"İptal İşlemi Onay Bekliyor"})]}),e.jsxs("div",{className:"lg:col-3 md:col-4 col-6 cursor-pointer","data-pr-tooltip":"İptal Edilme Tarihi",children:[e.jsx(t,{icon:"pi pi-clock",shape:"circle",className:"bg-primary-300 font-semibold text-primary-800"}),e.jsx("span",{className:"font-semibold ml-2",children:new Date(String(s.canceled_at)).toLocaleString()})]}),e.jsxs("div",{className:"lg:col-3 md:col-4 col-6 cursor-pointer","data-pr-tooltip":"Onaylayan Yetkili",children:[e.jsx(t,{icon:"pi pi-user",shape:"circle",className:"bg-primary-300 font-semibold text-primary-800"}),e.jsx("span",{className:"font-semibold ml-2",children:s.cancellation_accepted_by!==null?s.cancellation_accepted_by.name:"Onaylanmadı"})]})]}),e.jsx("div",{className:"col-12",children:e.jsx("span",{className:"text-xl font-semibold",children:"Adres Bilgileri"})}),e.jsxs("div",{className:"lg:col-3 md:col-4 col-6 cursor-pointer","data-pr-tooltip":"Adres Başlığı",children:[e.jsx(t,{icon:"pi pi-tag",shape:"circle",className:"bg-primary-300 font-semibold text-primary-800"}),e.jsx("span",{className:"font-semibold ml-2",children:s.address.title})]}),e.jsxs("div",{className:"lg:col-3 md:col-4 col-6 cursor-pointer","data-pr-tooltip":"Adres Telefon Numarası",children:[e.jsx(t,{icon:"pi pi-phone",shape:"circle",className:"bg-primary-300 font-semibold text-primary-800"}),e.jsx("a",{className:"font-semibold ml-2 text-color text-decoration-none",href:`tel:${s.address.phone}`,children:s.address.phone})]}),e.jsxs("div",{className:"lg:col-3 md:col-4 col-6 cursor-pointer","data-pr-tooltip":"İl/İlçe",children:[e.jsx(t,{icon:"pi pi-map",shape:"circle",className:"bg-primary-300 font-semibold text-primary-800"}),e.jsxs("span",{className:"font-semibold ml-2",children:[s.address.city," / ",s.address.district]})]}),e.jsxs("div",{className:"lg:col-6 md:col-6 col-12 cursor-pointer","data-pr-tooltip":"Adres",children:[e.jsx(t,{icon:"pi pi-home",shape:"circle",className:"bg-primary-300 font-semibold text-primary-800"}),e.jsx("span",{"data-pr-position":"bottom",className:"font-semibold ml-2",children:s.address.address})]}),s.address.notes!==null&&e.jsxs("div",{className:"lg:col-6 md:col-6 col-12 cursor-pointer","data-pr-tooltip":"Notlar",children:[e.jsx(t,{icon:"pi pi-info",shape:"circle",className:"bg-primary-300 font-semibold text-primary-800"}),e.jsx("span",{className:"font-semibold ml-2",children:s.address.notes})]}),s.courier!==!1&&s.courier!==null&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"col-12",children:e.jsx("span",{className:"text-xl font-semibold",children:"Kurye Bilgileri"})}),e.jsxs("div",{className:"lg:col-3 md:col-4 col-6 cursor-pointer","data-pr-tooltip":"Kurye Adı Soyadı",children:[e.jsx(t,{icon:"pi pi-user",shape:"circle",className:"bg-primary-300 font-semibold text-primary-800"}),e.jsx("span",{className:"font-semibold ml-2",children:s.courier.name})]}),e.jsxs("div",{className:"lg:col-3 md:col-4 col-6 cursor-pointer","data-pr-tooltip":"Kurye Telefon Numarası",children:[e.jsx(t,{icon:"pi pi-phone",shape:"circle",className:"bg-primary-300 font-semibold text-primary-800"}),e.jsx("a",{className:"font-semibold ml-2 text-color text-decoration-none",href:`tel:${s.courier.phone}`,children:s.courier.phone})]}),e.jsxs("div",{className:"lg:col-3 md:col-4 col-6 cursor-pointer","data-pr-tooltip":"Kurye Email Adresi",children:[e.jsx(t,{icon:"pi pi-envelope",shape:"circle",className:"bg-primary-300 font-semibold text-primary-800"}),e.jsx("a",{className:"font-semibold ml-2 text-color text-decoration-none",href:`mailto:${s.courier.email}`,children:s.courier.email})]}),e.jsxs("div",{className:"lg:col-3 md:col-4 col-6 cursor-pointer flex align-items-center","data-pr-tooltip":"Teslimat Tipi",children:[e.jsx(t,{image:s.courier.details.vehicle_type==="bicycle"?E:s.courier.details.vehicle_type==="motorcycle"?L:C,className:"bg-primary-300 font-semibold text-primary-800 p-1"}),e.jsx("span",{className:"ml-2 font-semibold",children:s.courier.details.vehicle_type==="bicycle"?"Bisiklet":s.courier.details.vehicle_type==="motorcycle"?"Motosiklet":"Araba"})]}),e.jsxs("div",{className:"lg:col-3 md:col-4 col-6 cursor-pointer","data-pr-tooltip":"Siparişi Teslim Alma Tarihi",children:[e.jsx(t,{icon:"pi pi-clock",shape:"circle",className:"bg-primary-300 font-semibold text-primary-800"}),e.jsx("span",{className:"font-semibold ml-2",children:s.courier_accepted_at!==null?new Date(s.courier_accepted_at).toLocaleString():"-"})]}),s.delivered_at!==null&&e.jsxs("div",{className:"lg:col-3 md:col-4 col-6 cursor-pointer","data-pr-tooltip":"Siparişi Teslim Etme Tarihi",children:[e.jsx(t,{icon:"pi pi-stop-circle",shape:"circle",className:"bg-primary-300 font-semibold text-primary-800"}),e.jsx("span",{className:"font-semibold ml-2",children:new Date(s.delivered_at).toLocaleString()})]}),!y&&i.length>0&&e.jsx("div",{className:"col-12",children:e.jsxs(z,{center:[i[0].latitude,i[0].longitude],zoom:15,zoomControl:!0,attributionControl:!1,style:{height:"400px",borderRadius:"10px"},scrollWheelZoom:!1,children:[e.jsx(A,{url:"https://{s}.tile.openstreetmap.fr/hot/{z}/{x}/{y}.png"}),i.map((l,a)=>e.jsx(T,{position:[l.latitude,l.longitude],icon:a===0?B:a===i.length-1&&s.status==="delivered"?se:g,children:e.jsxs(M,{children:[e.jsx("span",{className:"font-semibold flex justify-content-center text-lg",children:a===0?"Başlangıç":a===i.length-1&&s.status==="delivered"?"Bitiş":"Güzergah-"+a}),e.jsx(w,{label:"Google Maps'te Aç",size:"small",icon:"pi pi-external-link",severity:"help",className:"w-full mt-2 zoomindown",onClick:()=>{window.open(`https://www.google.com/maps/search/?api=1&query=${l.latitude},${l.longitude}`,"_blank")}})]})},a))]})})]})]})]})}),e.jsx("div",{className:"col-12 lg:col-3 md:col-4",children:e.jsx(ee,{layout:"vertical",marker:l=>e.jsx("span",{className:`bg-${l.bg} flex w-2rem h-2rem align-items-center justify-content-center text-white border-circle z-1 shadow-1`,children:e.jsx("i",{className:l.icon})}),value:K(s),opposite:l=>l.status,content:l=>e.jsx("small",{className:"text-color-secondary",children:l.date.toLocaleString()})})})]});return e.jsxs(e.Fragment,{children:[e.jsx(R,{ref:c}),d?e.jsx(H,{auth:O,csrfToken:h,children:e.jsx(I,{children:e.jsx("div",{className:"card",children:e.jsx(_,{})})})}):e.jsx(_,{})]})};export{je as default};
