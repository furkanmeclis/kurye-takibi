import{r as i,u as J,j as e,B as o,c as Q,R as U,Y as W}from"./app-C7KCH85h.js";import{t as X,P as Z,M as D}from"./PageContainer-cZa-KtPx.js";import{T as B}from"./toast.esm-ChJ7o9Yf.js";import ee from"./Show-C20OI61h.js";import{D as le,C as te}from"./column.esm-C13OPihq.js";import{D as ae,M as G}from"./message.esm-Can9Yc15.js";import{C as re,T as se}from"./checkbox.esm-DlH0RndG.js";import{T as F,O as j}from"./ActiveOrder-BzF7Xial.js";import{g as ie}from"./orders-BrC4TbtR.js";import{b}from"./globalHelper-DC93hlCg.js";import{T as ne}from"./tristatecheckbox.esm-_VVYfpDr.js";import"./PersonalInformation-CFPCs-iQ.js";import"./inputtext.esm-KLIqssz8.js";import"./inputmask.esm-CPoZMXYd.js";import"./PersonalInformation-korKsWPp.js";import"./styleclass.esm-BpUyAfSu.js";import"./sidebar.esm-t1zv9ION.js";import"./index.esm-BtriMSeC.js";import"./orders-D-7QDmEQ.js";import"./index.esm-D7k15QPm.js";const Pe=({auth:g,csrfToken:u,flash:n})=>{var M,P,w,C,A,R,O,L,E;const[m,c]=i.useState(!0),[p,I]=i.useState([]),[s,y]=J(["name","phone","created_at","actions"],"BusinessesOrdersAllTableColumns"),[h,x]=i.useState(null),[z,K]=i.useState([]),_=i.useRef(null),v=i.useRef(null),[a,$]=i.useState(null),[r,q]=i.useState(null),N=()=>{c(!0),ie(u).then(l=>{l.status?(I(l.orders.map(t=>({...t,cancellation_accepted:t.cancellation_accepted===1}))),c(!1),x(null)):(x(l.message),c(!1))}).catch(l=>{x(l.message),c(!1)}).finally(()=>c(!1))};i.useEffect(()=>{var l;N(),n!=null&&n.message&&((l=k.current)==null||l.show({severity:(n==null?void 0:n.type)??"info",summary:n.title,detail:n.message??""}))},[]);let T=[{expander:!0,style:{width:"3rem"}},{field:"id",header:"Sipariş ID",hidden:!s.includes("id")},{field:"customer.name",header:"Müşteri",hidden:!s.includes("customer.name"),sortable:!0,filter:!0,filterPlaceholder:"Ad'a Göre",body:l=>e.jsx(o,{label:l.customer.name,link:!0,size:"small",severity:"info",onClick:t=>{var d;q(l),(d=v.current)==null||d.toggle(t)}})},{field:"business.name",header:"İşletme",hidden:!s.includes("business.name"),sortable:!0,filter:!0,filterPlaceholder:"İşletmeye'a Göre",body:l=>e.jsx(o,{label:l.business.name,link:!0,size:"small",severity:"help",onClick:t=>{var d;$(l.business),(d=_.current)==null||d.toggle(t)}})},{field:"customer_note",header:"Sipariş Notu",hidden:!s.includes("customer_note"),sortable:!0,filter:!0,filterPlaceholder:"Sipariş Notu'na Göre",body:l=>l.customer_note?e.jsx("span",{children:l.customer_note}):e.jsx("span",{children:e.jsx("i",{className:"pi pi-ban text-red-400"})})},{field:"price",header:"Paket Ücreti",hidden:!s.includes("price"),sortable:!0,filter:!0,filterPlaceholder:"Fiyata'a Göre",body:l=>e.jsxs("span",{children:[l.price," ₺"]})},{field:"marketplace",header:"Sipariş Kaynağı",hidden:!s.includes("marketplace"),sortable:!0,body:l=>e.jsx("span",{children:l.marketplace==="trendyol"?e.jsx("img",{src:X,alt:"Trendyol"}):e.jsx("i",{className:"pi pi-home"})})},{field:"status",header:"Sipariş Durumu",hidden:!s.includes("status"),sortable:!0,filter:!0,filterElement:l=>e.jsx(ae,{options:b("draft",!0),value:l.value,filter:!0,filterBy:"label,value",onChange:t=>l.filterApplyCallback(t.value),itemTemplate:t=>e.jsx(F,{value:t.label,severity:t.severity}),placeholder:"Sipariş Durumu",className:"p-column-filter w-full",showClear:!0}),body:l=>e.jsx(F,{value:String(b(l.status,!1,l.cancellation_accepted===1,l.cancellation_rejected===1).label),severity:String(b(l.status,!1,l.cancellation_accepted===1,l.cancellation_rejected===1).severity)})},{field:"courier_accepted_at",header:"Kurye Teslim Alma Tarihi",hidden:!s.includes("courier_accepted_at"),sortable:!0,filter:!0,filterPlaceholder:"Kurye Teslim Alma Tarihine Göre",filterType:"date",body:l=>l.courier_accepted_at?e.jsx("span",{children:new Date(l.courier_accepted_at).toLocaleString()}):e.jsxs("span",{children:[e.jsx("i",{className:"pi pi-ban text-red-400"})," Teslim Alınmadı"]})},{field:"delivered_at",header:"Teslim Tarihi",hidden:!s.includes("delivered_at"),sortable:!0,filter:!0,filterPlaceholder:"Teslim Tarihine Göre",filterType:"date",body:l=>l.delivered_at?e.jsx("span",{children:new Date(l.delivered_at).toLocaleString()}):e.jsxs("span",{children:[e.jsx("i",{className:"pi pi-ban text-red-400"})," Teslim Edilmedi"]})},{field:"cancellation_accepted",header:"İptal Onayı",hidden:!s.includes("cancellation_accepted"),sortable:!0,filter:!0,dataType:"boolean",filterElement:l=>e.jsx(ne,{value:l.value,onChange:t=>l.filterApplyCallback(t.value)}),body:l=>e.jsx("i",{className:Q("pi",{"pi-check-circle text-green-400":l.cancellation_accepted&&l.status==="canceled","pi-times-circle text-red-400":!l.cancellation_accepted&&l.status==="canceled"&&l.cancellation_rejected,"pi-hourglass text-yellow-400":l.status==="canceled"&&!l.cancellation_rejected&&!l.cancellation_accepted})})},{field:"canceled_at",header:"İptal Tarihi",hidden:!s.includes("canceled_at"),sortable:!0,filter:!0,filterPlaceholder:"İptal Tarihine Göre",filterType:"date",body:l=>l.canceled_at?e.jsx("span",{children:new Date(l.canceled_at).toLocaleString()}):e.jsxs("span",{children:[e.jsx("i",{className:"pi pi-ban text-red-400"})," İptal Edilmedi"]})},{field:"created_at",header:"Eklenme Tarihi",hidden:!s.includes("created_at"),sortable:!0,filter:!0,filterPlaceholder:"Eklenme Tarihine Göre",filterType:"date",body:l=>e.jsx("span",{children:new Date(l.created_at).toLocaleString()})},{field:"updated_at",header:"Güncelleme Tarihi",hidden:!s.includes("updated_at"),sortable:!0,filter:!0,filterPlaceholder:"Güncellenme Tarihine Göre",filterType:"date",body:l=>e.jsx("span",{children:new Date(l.updated_at).toLocaleString()})}];const S=i.useRef(null),Y=()=>e.jsx(e.Fragment,{children:e.jsx(se,{end:e.jsxs(e.Fragment,{children:[e.jsx(o,{size:"small",icon:"pi pi-sync",severity:"help",className:"mr-2",tooltip:"Verileri Yenile",tooltipOptions:{position:"top"},onClick:()=>{N()}}),e.jsx(o,{size:"small",icon:"pi pi-bars",onClick:l=>{var t;(t=S.current)==null||t.toggle(l)}})]})})}),k=U.useRef(null);return e.jsx(Z,{auth:g,csrfToken:u,children:e.jsxs(D,{children:[e.jsx(W,{title:"Siparişler"}),e.jsx(B,{ref:k}),e.jsxs(j,{ref:S,showCloseIcon:!0,style:{width:"300px"},children:[e.jsx("div",{className:"flex align-items-center justify-content-start mb-3",children:e.jsxs("span",{className:"text-900 text-lg font-bold",children:["Sütunlar (",s.length,")"]})}),e.jsx("div",{className:"flex flex-column justify-content-center gap-2",children:T.map((l,t)=>{if(l.selectionMode==="multiple"||(l==null?void 0:l.expander)!==void 0)return null;let d=l.header,f=l.field;return e.jsxs("div",{className:"flex align-items-center",children:[e.jsx(re,{inputId:`column${t}`,checked:s.includes(f),onChange:H=>{H.checked?y([...s,f]):y(s.filter(V=>V!==f))}}),e.jsx("label",{htmlFor:`column${t}`,className:"ml-2",children:d})]},t)})})]}),e.jsx(j,{ref:_,showCloseIcon:!0,style:{width:300},children:a!==null&&e.jsxs(e.Fragment,{children:[e.jsxs("ul",{className:"m-0 px-3 list-none",children:[e.jsxs("li",{children:["İşletme Adı: ",e.jsx("span",{className:"font-semibold",children:a==null?void 0:a.name})]}),e.jsxs("li",{children:["İşletme Telefon No: ",e.jsx("span",{className:"font-semibold",children:a==null?void 0:a.phone})]}),e.jsxs("li",{children:["İşletme İl: ",e.jsx("span",{className:"font-semibold",children:(M=a==null?void 0:a.details)==null?void 0:M.city})]}),e.jsxs("li",{children:["İşletme İlçe: ",e.jsx("span",{className:"font-semibold",children:(P=a==null?void 0:a.details)==null?void 0:P.state})]}),e.jsxs("li",{children:["İşletme Adres: ",e.jsx("span",{className:"font-semibold",children:(w=a==null?void 0:a.details)==null?void 0:w.address})]})]}),e.jsx(o,{label:"Google Maps'te Aç",size:"small",icon:"pi pi-external-link",severity:"help",className:"w-full mt-2",onClick:()=>{var l,t;window.open(`https://www.google.com/maps/search/?api=1&query=${(l=a==null?void 0:a.details)==null?void 0:l.latitude},${(t=a==null?void 0:a.details)==null?void 0:t.longitude}`,"_blank")}})]})}),e.jsx(j,{ref:v,showCloseIcon:!0,style:{width:300},children:r!==null&&e.jsx(e.Fragment,{children:e.jsxs("ul",{className:"m-0 px-3 list-none",children:[e.jsxs("li",{children:["Müşteri Adı: ",e.jsx("span",{className:"font-semibold",children:(C=r==null?void 0:r.customer)==null?void 0:C.name})]}),e.jsxs("li",{children:["Müşteri Telefon No: ",e.jsx("span",{className:"font-semibold",children:(A=r==null?void 0:r.address)==null?void 0:A.phone})]}),e.jsxs("li",{children:["Müşteri İl: ",e.jsx("span",{className:"font-semibold",children:(R=r==null?void 0:r.address)==null?void 0:R.city})]}),e.jsxs("li",{children:["Müşteri İlçe: ",e.jsx("span",{className:"font-semibold",children:(O=r==null?void 0:r.address)==null?void 0:O.district})]}),e.jsxs("li",{children:["Müşteri Adres: ",e.jsx("span",{className:"font-semibold",children:(L=r==null?void 0:r.address)==null?void 0:L.address})]}),e.jsxs("li",{children:["Müşteri Adres Notu: ",e.jsx("span",{className:"font-semibold",children:(E=r==null?void 0:r.address)==null?void 0:E.notes})]})]})})}),e.jsxs("div",{className:"card",children:[e.jsx("span",{className:"text-900 text-xl font-bold mb-4 block",children:"Siparişler"}),h!==null&&e.jsx(G,{className:"w-full",severity:"error",text:h}),!m&&p.length===0&&e.jsx(G,{className:"w-full",severity:"info",text:"Sipariş bulunamadı."}),e.jsx(le,{hidden:!m&&p.length===0||h!==null,loading:m,value:p,removableSort:!0,paginator:!0,filterDisplay:"row",paginatorTemplate:"RowsPerPageDropdown FirstPageLink PrevPageLink CurrentPageReport NextPageLink LastPageLink",rowsPerPageOptions:[5,10,25,50],rows:10,dataKey:"id",header:Y,expandedRows:z,onRowToggle:l=>K(l==null?void 0:l.data),rowExpansionTemplate:l=>e.jsx(ee,{page:!1,order:l,orderId:l.id,csrfToken:u,auth:g}),filters:{"customer.name":{value:null,matchMode:"contains"},"customer.phone":{value:null,matchMode:"contains"},created_at:{value:null,matchMode:"contains"},updated_at:{value:null,matchMode:"contains"},status:{value:null,matchMode:"contains"},courier_accepted_at:{value:null,matchMode:"contains"},delivered_at:{value:null,matchMode:"contains"},canceled_at:{value:null,matchMode:"contains"},cancellation_reason:{value:null,matchMode:"contains"},price:{value:null,matchMode:"contains"},customer_note:{value:null,matchMode:"contains"},cancellation_accepted:{value:null,matchMode:"equals"}},emptyMessage:"Sipariş bulunamadı.",currentPageReportTemplate:"{first}. ile {last}. arası toplam {totalRecords} kayıttan",children:T.map((l,t)=>e.jsx(te,{...l},t))})]})]})})};export{Pe as default};
