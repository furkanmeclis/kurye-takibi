import{r as o,L as de,R as ce,j as e,Y as me,c as l,B as S,a as ue}from"./app-Q7AXU0aI.js";import{a as pe,b as I,P as he,M as xe,A as fe,c as ge,u as be,s as ye,e as ve,f as je}from"./PageContainer-BIYmXk4n.js";import{c as $,b as p,u as R,I as Y}from"./inputtext.esm-DYxVi6bR.js";import{T as Ne}from"./toast.esm-CfmbWQEZ.js";import{I as Z}from"./inputmask.esm-DFOdfNHf.js";import{I as M,c as v,D as K}from"./message.esm-BdhDmTuC.js";import{B as U,D as Ce}from"./ActiveOrder-CRyMwc2f.js";import"./PersonalInformation-BeSBW7zC.js";import"./car-BnQ5UupV.js";import"./PersonalInformation-CbdU5Zyv.js";import"./globalHelper-DmSEk4ia.js";import"./styleclass.esm-D-qKL6b3.js";import"./sidebar.esm-DXtzmneN.js";import"./index.esm-De60uoIs.js";import"./inputswitch.esm-BN_GMhiZ.js";const Pe=({auth:J,csrfToken:h,customerId:b})=>{const{setBreadcrumbs:Q}=o.useContext(de),d=ce.useRef(null),[j,g]=o.useState(!0),[c,W]=o.useState({}),[C,k]=o.useState([]),[_,X]=o.useState(!1),ee=$().shape({name:p().required("Ad soyad giriniz").min(3,"Ad Soyad en az 3 karakter olmalıdır"),phone:p().required("Telefon numarası giriniz").matches(/^\(\d{3}\)-\d{3}-\d{4}$/,"Geçerli bir telefon numarası giriniz"),note:p().nullable().min(3,"Müşteri notu en az 3 karakter olmalıdır")}),{values:A,resetForm:D,submitCount:m,handleChange:B,handleSubmit:te,errors:s,isValid:ie,dirty:se}=R({initialValues:{name:"",phone:"",note:""},validationSchema:ee,validateOnChange:_,validateOnBlur:_,onSubmit:a=>{g(!0),be(b,a,h).then(r=>{var y,i;if(r.status){(y=d.current)==null||y.show({severity:"success",summary:"Başarılı",detail:r.message});let N={values:{name:a.name,phone:a.phone,note:a.note??""}};D(N)}else(i=d.current)==null||i.show({severity:"error",summary:"Hata",detail:r.message})}).catch(()=>{var r;(r=d.current)==null||r.show({severity:"error",summary:"Hata",detail:"Bir hata oluştu lütfen tekrar deneyiniz."})}).finally(()=>{g(!1)})}});o.useEffect(()=>{m>0&&X(!0)},[m]),o.useEffect(()=>{pe(b,h).then(a=>{var r;if(a.status){let y={name:a.customer.name,phone:a.customer.phone,note:a.customer.note??""};W(a.customer),D({values:y}),I(b,h).then(i=>{i.status&&k(i.addresses)}).catch(i=>{var N;console.error(i),(N=d.current)==null||N.show({severity:"error",summary:"Hata",detail:"Adresler alınamadı"})}).finally(()=>{g(!1)})}else g(!1),(r=d.current)==null||r.show({severity:"error",summary:"Hata",detail:a.message})}).catch(a=>{var r;console.error(a),g(!1),(r=d.current)==null||r.show({severity:"error",summary:"Hata",detail:"İşletme bilgileri alınamadı"})})},[b]),o.useEffect(()=>{Q(a=>[...a,{labels:["Müşteriler","Müşteriyi Düzenle"],to:window.location.href}])},[c]);const ae=()=>{g(!0),I(b,h).then(a=>{a.status&&k(a.addresses)}).catch(a=>{var r;console.error(a),(r=d.current)==null||r.show({severity:"error",summary:"Hata",detail:"Adresler alınamadı"})}).finally(()=>{g(!1)})},[le,F]=o.useState(!1),L=({addressProp:a,newAddress:r=!1,deleteBlocked:y=!1})=>{var H,q,P,T,G;const[i,N]=o.useState(a),[u,O]=o.useState(!1),[V,re]=o.useState(!1),[E,we]=o.useState(v.find(n=>String(n.il_adi).toLowerCase()===String(i.city).toLowerCase()));let ne=r?{title:"",city:v[0].il_adi,district:v[0].ilceler[0].ilce_adi,address:"",phone:"",notes:"",selectedCity:v[0],selectedDistrict:v[0].ilceler[0]}:{title:i.title,city:i.city,district:i.district,address:i.address,phone:i.phone,notes:i.notes??"",selectedCity:E,selectedDistrict:E.ilceler.find(n=>String(n.ilce_adi).toLocaleLowerCase()===String(i.district).toLocaleLowerCase())},t=R({initialValues:ne,validationSchema:$().shape({title:p().required("Adres başlığı giriniz").min(2,"Adres başlığı en az 2 karakter olmalıdır"),phone:p().required("Adres telefon numarası giriniz").matches(/^\(\d{3}\)-\d{3}-\d{4}$/,"Geçerli bir adres telefon numarası giriniz"),city:p().required("Şehir seçiniz"),district:p().required("İlçe seçiniz"),address:p().required("Adres giriniz").min(5,"Adres en az 5 karakter olmalıdır"),notes:p().nullable().min(3,"Adres notu en az 3 karakter olmalıdır")}),validateOnChange:V,validateOnBlur:V,onSubmit:n=>{O(!0),(r?ye(b,n,h):ve(i.id,n,h)).then(x=>{var f,z;x.status?(ae(),(f=d.current)==null||f.show({severity:"success",summary:"Başarılı",detail:x.message})):(z=d.current)==null||z.show({severity:"error",summary:"Hata",detail:x.message})}).catch(x=>{var f;console.error("Adresler",i.id,x),(f=d.current)==null||f.show({severity:"error",summary:"Hata",detail:"Bir hata oluştu lütfen tekrar deneyiniz."})}).finally(()=>{O(!1),F(!1)})}});return o.useEffect(()=>{t.submitCount>0&&re(!0)},[t.submitCount]),e.jsx(U,{blocked:u,template:e.jsxs("div",{className:"flex align-items-center  flex-column text-white font-semibold justify-center",children:[e.jsx("i",{className:"pi pi-spin pi-spinner text-white mb-3",style:{fontSize:"3rem"}}),"Adres Bilgileri Kaydediliyor..."]}),children:e.jsxs("form",{onSubmit:t.handleSubmit,className:"grid formgrid p-fluid",children:[e.jsxs("div",{className:"field mb-4 col-12 md:col-6 p-input-icon-right",children:[e.jsxs("label",{htmlFor:"addresss_title"+i.id,className:l("font-medium text-900",{"text-red-500":!!t.errors.title,"text-green-500":!t.errors.title&&t.submitCount>0}),children:[e.jsx("i",{className:l("pi",{"pi-times-circle text-red-500 text-sm":!!t.errors.title,"pi-check-circle text-green-500 text-sm":!t.errors.title&&t.submitCount>0})})," Adres Başlığı"]}),e.jsx(Y,{id:"addresss_title"+i.id,type:"text",autoComplete:"off",name:"title",tooltip:(H=t.errors)!=null&&H.title?String(t.errors.title):void 0,tooltipOptions:{position:"top"},disabled:u,onChange:t.handleChange,value:t.values.title,className:l("w-full",{"p-invalid":!!t.errors.title})})]}),e.jsxs("div",{className:"field mb-4 col-12 md:col-6 p-input-icon-right",children:[e.jsxs("label",{htmlFor:"address_phone",className:l("font-medium text-900",{"text-red-500":!!t.errors.phone,"text-green-500":!t.errors.phone&&t.submitCount>0}),children:[e.jsx("i",{className:l("pi",{"pi-times-circle text-red-500 text-sm":!!t.errors.phone,"pi-check-circle text-green-500 text-sm":!t.errors.phone&&t.submitCount>0})})," Adres Telefon Numarası"]}),e.jsx(Z,{autoComplete:"off",name:"phone",tooltip:(q=t.errors)!=null&&q.phone?String(t.errors.phone):void 0,tooltipOptions:{position:"top",event:"focus",className:"text-red-500"},disabled:u,onChange:t.handleChange,value:t.values.phone,mask:"(999)-999-9999",className:l("w-full",{"p-invalid":!!t.errors.phone})})]}),e.jsxs("div",{className:"field mb-4 col-12 md:col-6 p-input-icon-right",children:[e.jsxs("label",{htmlFor:"address_city"+i.id,className:l("font-medium text-900",{"text-red-500":!!t.errors.city,"text-green-500":!t.errors.city&&m>0}),children:[e.jsx("i",{className:l("pi",{"pi-times-circle text-red-500 text-sm":!!t.errors.city,"pi-check-circle text-green-500 text-sm":!t.errors.city&&t.submitCount>0})})," İl"]}),e.jsx(K,{value:t.values.selectedCity,onChange:n=>{t.setFieldValue("city",n.value.il_adi),t.setFieldValue("selectedCity",n.value),t.setFieldValue("district",n.value.ilceler[0].ilce_adi),t.setFieldValue("selectedDistrict",n.value.ilceler[0])},options:v,optionLabel:"il_adi",inputId:"address_city"+i.id,placeholder:"Şehir Seçiniz",className:l("w-full",{"p-invalid":!!t.errors.city}),filter:!0,disabled:u,virtualScrollerOptions:{itemSize:38},emptyMessage:"Şehir Bulunamadı",emptyFilterMessage:"Şehir Bulunamadı",filterBy:"il_adi"})]}),e.jsxs("div",{className:"field mb-4 col-12 md:col-6 p-input-icon-right",children:[e.jsxs("label",{htmlFor:"address_district"+i.id,className:l("font-medium text-900",{"text-red-500":!!t.errors.district,"text-green-500":!t.errors.district&&t.submitCount>0}),children:[e.jsx("i",{className:l("pi",{"pi-times-circle text-red-500 text-sm":!!t.errors.district,"pi-check-circle text-green-500 text-sm":!t.errors.district&&t.submitCount>0})})," İlçe"]}),e.jsx(K,{value:t.values.selectedDistrict,inputId:"address_district"+i.id,disabled:t.values.selectedCity===null||u,onChange:n=>{t.setFieldValue("district",n.value.ilce_adi),t.setFieldValue("selectedDistrict",n.value)},options:(P=t.values.selectedCity)==null?void 0:P.ilceler,optionLabel:"ilce_adi",placeholder:"İlçe Seçiniz",className:l("w-full",{"p-invalid":!!t.errors.district}),filter:!0,virtualScrollerOptions:{itemSize:38},emptyMessage:"İlçe Bulunamadı",emptyFilterMessage:"İlçe Bulunamadı",filterBy:"ilce_adi"})]}),e.jsxs("div",{className:"field mb-4 col-12 p-input-icon-right",children:[e.jsxs("label",{htmlFor:"address"+i.id,className:l("font-medium text-900",{"text-red-500":!!t.errors.address,"text-green-500":!t.errors.address&&t.submitCount>0}),children:[e.jsx("i",{className:l("pi",{"pi-times-circle text-red-500 text-sm":!!t.errors.address,"pi-check-circle text-green-500 text-sm":!t.errors.address&&t.submitCount>0})})," Adres"]}),e.jsx(M,{autoComplete:"off",name:"address",id:"address"+i.id,tooltip:(T=t.errors)!=null&&T.address?String(t.errors.address):void 0,tooltipOptions:{position:"top",event:"focus"},placeholder:"Müşteri adresi",disabled:u,onChange:t.handleChange,value:t.values.address,className:l("w-full",{"p-invalid":!!t.errors.address})})]}),e.jsxs("div",{className:"field mb-4 col-12 p-input-icon-right",children:[e.jsxs("label",{htmlFor:"address_notes"+i.id,className:l("font-medium text-900",{"text-red-500":!!t.errors.notes,"text-green-500":!t.errors.notes&&t.submitCount>0}),children:[e.jsx("i",{className:l("pi",{"pi-times-circle text-red-500 text-sm":!!t.errors.notes,"pi-check-circle text-green-500 text-sm":!t.errors.notes&&t.submitCount>0})})," Adres Notu"]}),e.jsx(M,{autoComplete:"off",name:"notes",id:"address_notes"+i.id,tooltip:(G=t.errors)!=null&&G.notes?String(t.errors.notes):void 0,tooltipOptions:{position:"top",event:"focus"},placeholder:"Adres Notu (Zorunlu Değil)",disabled:u,onChange:t.handleChange,value:t.values.notes,className:l("w-full",{"p-invalid":!!t.errors.notes})})]}),e.jsxs("div",{className:"col-12 flex justify-content-between",children:[e.jsx(S,{label:r?"Ekle":"Güncelle",disabled:!t.isValid||!t.dirty,loading:u,type:"submit",size:"small",className:"w-auto mt-3"}),!r&&e.jsx(S,{label:"Sil",severity:"danger",icon:"pi pi-trash",visible:!y,loading:u,type:"button",size:"small",onClick:n=>{ue({target:n.currentTarget,message:"Adresi silmek istediğinize emin misiniz?",icon:"pi pi-exclamation-triangle",acceptClassName:"p-button-danger",acceptLabel:"Sil",rejectLabel:"Vazgeç",accept(){je(i.id,h).then(w=>{var x,f;w.status?((x=d.current)==null||x.show({severity:"success",summary:"Başarılı",detail:w.message}),k(z=>z.filter(oe=>oe.id!==i.id))):(f=d.current)==null||f.show({severity:"error",summary:"Hata",detail:w.message})})}})},className:"w-auto mt-3"})]})]})})};return e.jsx(he,{auth:J,csrfToken:h,children:e.jsx(xe,{children:e.jsxs(U,{blocked:j,baseZIndex:1e3,template:e.jsxs("div",{className:"flex align-items-center  flex-column text-white font-semibold justify-center",children:[e.jsx("i",{className:"pi pi-spin pi-spinner text-white mb-3",style:{fontSize:"3rem"}}),"Müşteri Bilgileri Yükleniyor"]}),children:[e.jsx(me,{title:(c==null?void 0:c.name)!==""?"'"+(c==null?void 0:c.name)+"' Adlı Müşteriyi Düzenle":""}),e.jsx(Ne,{ref:d}),e.jsxs("div",{className:"card",children:[e.jsxs("span",{className:"text-900 text-xl font-bold mb-4 block",children:[(c==null?void 0:c.name)!==""?"'"+(c==null?void 0:c.name)+"' Adlı Müşteriyi Düzenle":""," "]}),e.jsxs("div",{className:"grid",children:[e.jsxs("div",{className:"col-12 lg:col-2",children:[e.jsx("div",{className:"text-900 font-medium text-xl mb-3",children:"Müşteri Bilgileri"}),e.jsxs("p",{className:"m-0 p-0 text-600 line-height-3 mr-3",children:["Güncellemek İstediğiniz Müşteri Bilgilerini Aşağıdaki Formu Doldurarak Güncelleyebilirsiniz.",s&&Object.keys(s).length>0&&e.jsx(e.Fragment,{children:e.jsx("ul",{className:"mt-3",children:Object.keys(s).map((a,r)=>e.jsx("li",{className:"text-red-500 text-sm",children:s[a]},r))})})]})]}),e.jsx("div",{className:"col-12 lg:col-10",children:e.jsxs("form",{onSubmit:te,className:"grid formgrid p-fluid",children:[e.jsxs("div",{className:"field mb-4 col-12 md:col-6 p-input-icon-right",children:[e.jsxs("label",{htmlFor:"name",className:l("font-medium text-900",{"text-red-500":!!s.name,"text-green-500":!s.name&&m>0}),children:[e.jsx("i",{className:l("pi",{"pi-times-circle text-red-500 text-sm":!!s.name,"pi-check-circle text-green-500 text-sm":!s.name&&m>0})})," Müşteri Ad Soyad"]}),e.jsx(Y,{id:"name",type:"text",autoComplete:"off",name:"name",tooltip:s==null?void 0:s.name,tooltipOptions:{position:"top"},disabled:j,onChange:B,value:A.name,className:l("w-full",{"p-invalid":!!s.name})})]}),e.jsxs("div",{className:"field mb-4 col-12 md:col-6 p-input-icon-right",children:[e.jsxs("label",{htmlFor:"phone",className:l("font-medium text-900",{"text-red-500":!!s.phone,"text-green-500":!s.phone&&m>0}),children:[e.jsx("i",{className:l("pi",{"pi-times-circle text-red-500 text-sm":!!s.phone,"pi-check-circle text-green-500 text-sm":!s.phone&&m>0})})," Telefon Numarası"]}),e.jsx(Z,{autoComplete:"off",name:"phone",tooltip:s==null?void 0:s.phone,tooltipOptions:{position:"top",event:"focus",className:"text-red-500"},disabled:j,onChange:B,value:A.phone,mask:"(999)-999-9999",className:l("w-full",{"p-invalid":!!s.phone})})]}),e.jsxs("div",{className:"field mb-4 col-12 p-input-icon-right",children:[e.jsxs("label",{htmlFor:"note",className:l("font-medium text-900",{"text-red-500":!!s.note,"text-green-500":!s.note&&m>0}),children:[e.jsx("i",{className:l("pi",{"pi-times-circle text-red-500 text-sm":!!s.note,"pi-check-circle text-green-500 text-sm":!s.note&&m>0})})," Müşteri Notu"]}),e.jsx(M,{autoComplete:"off",name:"note",id:"note",tooltip:s==null?void 0:s.note,tooltipOptions:{position:"top"},placeholder:"Bu alanı sadece işletme sahibi olarak siz görebilirsiniz.Zorunlu değildir.",disabled:j,onChange:B,value:A.note,className:l("w-full",{"p-invalid":!!s.note})})]}),e.jsx("div",{className:"col-12",children:e.jsx(S,{label:"Kaydet",disabled:!ie||!se,loading:j,type:"submit",size:"small",className:"w-auto mt-3"})})]})})]})]}),e.jsx("div",{className:"card",children:e.jsxs("div",{className:"grid",children:[e.jsxs("div",{className:"col-12 lg:col-2",children:[e.jsx("div",{className:"text-900 font-medium text-xl mb-3",children:"Müşteri Adresleri"}),e.jsx("p",{className:"m-0 p-0 text-600 line-height-3 mr-3 mb-3",children:"Müşteriye ait adresleri aşağıdaki listeden görebilir ve düzenleyebilirsiniz."}),e.jsx("div",{children:e.jsx(S,{label:"Yeni Adres Ekle",size:"small",icon:"pi pi-plus",onClick:()=>{F(!0)}})})]}),e.jsxs("div",{className:"col-12 lg:col-10",children:[e.jsx(fe,{children:C==null?void 0:C.map((a,r)=>e.jsx(ge,{header:`Adres Başlığı : ${a.title}`,children:e.jsx(L,{addressProp:a,deleteBlocked:C.length===1})},r))}),e.jsx(Ce,{onHide:()=>F(!1),visible:le,header:"Yeni Adres Ekle",style:{width:"50vw"},draggable:!1,resizable:!1,className:"mx-3 sm:mx-0 sm:w-full md:w-8 lg:w-6 p-fluid",modal:!0,children:e.jsx(L,{addressProp:{},newAddress:!0})})]})]})})]})})})};export{Pe as default};
